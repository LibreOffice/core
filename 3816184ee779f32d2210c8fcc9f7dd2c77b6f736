{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e95be66c_13b984b4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2022-05-24T11:46:19Z",
      "side": 1,
      "message": "when running parallelized `make check` in my local ASan+UBSan build under load, various UITests keep failing randomly as below.  Running each test alone does not fail, so it smells like some timing issue.  Locally reverting this change makes `make check` work reliably again.\n\ne.g. during UITest_conditional_format:\n  \u003d\u003d2385063\u003d\u003dERROR: AddressSanitizer: heap-use-after-free on address 0x6060004c2fb8 at pc 0x7f9d9ddf9066 bp 0x7ffc67937ca0 sp 0x7ffc67937c98\n  READ of size 8 at 0x6060004c2fb8 thread T0\n   #0 in o3tl::UnsafeRefCountingPolicy::incrementCount(unsigned long\u0026) at include/o3tl/cow_wrapper.hxx:39:61\n   #1 in o3tl::cow_wrapper\u003cstd::__debug::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e\u003e\u003e, o3tl::UnsafeRefCountingPolicy\u003e::cow_wrapper(o3tl::cow_wrapper\u003cstd::__debug::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e\u003e\u003e, o3tl::UnsafeRefCountingPolicy\u003e const\u0026) at include/o3tl/cow_wrapper.hxx:244:13\n   #2 in comphelper::OInterfaceContainerHelper4\u003ccom::sun::star::ucb::XContentEventListener\u003e::OInterfaceContainerHelper4() at include/comphelper/interfacecontainer4.hxx:265:7\n   #3 in fileaccess::BaseContent::BaseContent(fileaccess::TaskManager*, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026, rtl::OUString const\u0026) at ucb/source/ucp/file/bc.cxx:125:14\n   #4 in fileaccess::FileProvider::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/ucp/file/prov.cxx:125:39\n   #5 in non-virtual thunk to fileaccess::FileProvider::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/ucp/file/prov.cxx\n   #6 in UniversalContentBroker::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/core/ucb.cxx:477:24\n   #7 in non-virtual thunk to UniversalContentBroker::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/core/ucb.cxx\n   #8 in ucbhelper::getContentThrow(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XUniversalContentBroker\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucbhelper/source/client/content.cxx:252:29\n   #9 in ucbhelper::Content::Content(rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XCommandEnvironment\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026) at ucbhelper/source/client/content.cxx:311:38\n   #10 in (anonymous namespace)::OFileAccess::isFolder(rtl::OUString const\u0026) at ucb/source/core/FileAccess.cxx:305:28\n   #11 in (anonymous namespace)::OFileAccess::exists(rtl::OUString const\u0026) at ucb/source/core/FileAccess.cxx:459:16\n   #12 in SpellChecker::getLocales() at lingucomponent/source/spellcheck/spell/sspellimp.cxx:157:50\n   #13 in non-virtual thunk to SpellChecker::getLocales() at lingucomponent/source/spellcheck/spell/sspellimp.cxx\n   #14 in LngSvcMgr::GetAvailableSpellSvcs_Impl() at linguistic/source/lngsvcmgr.cxx:963:67\n   #15 in LngSvcMgr::getAvailableServices(rtl::OUString const\u0026, com::sun::star::lang::Locale const\u0026) at linguistic/source/lngsvcmgr.cxx:1381:9\n   #16 in LngSvcMgr::UpdateAll() at linguistic/source/lngsvcmgr.cxx:645:46\n   #17 in LngSvcMgr::LngSvcMgr() at linguistic/source/lngsvcmgr.cxx:414:5\n   #18 in linguistic_LngSvcMgr_get_implementation at linguistic/source/lngsvcmgr.cxx:1826:30\n   #19 in com::sun::star::uno::XInterface* std::__invoke_impl\u003ccom::sun::star::uno::XInterface*, com::sun::star::uno::XInterface* (*\u0026)(com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026), com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026\u003e(std::__invoke_other, com::sun::star::uno::XInterface* (*\u0026)(com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026), com::sun::star::uno::XComponentContext*\u0026\u0026, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026) at /home/sbergman/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/13.0.0/../../../../include/c++/13.0.0/bits/invoke.h:61:14\n   #20 in std::enable_if\u003cis_invocable_r_v\u003ccom::sun::star::uno::XInterface*, com::sun::star::uno::XInterface* (*\u0026)(com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026), com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026\u003e, com::sun::star::uno::XInterface*\u003e::type std::__invoke_r\u003ccom::sun::star::uno::XInterface*, com::sun::star::uno::XInterface* (*\u0026)(com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026), com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026\u003e(com::sun::star::uno::XInterface* (*\u0026)(com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026), com::sun::star::uno::XComponentContext*\u0026\u0026, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026) at /home/sbergman/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/13.0.0/../../../../include/c++/13.0.0/bits/invoke.h:114:9\n   #21 in std::_Function_handler\u003ccom::sun::star::uno::XInterface* (com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026), com::sun::star::uno::XInterface* (*)(com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026)\u003e::_M_invoke(std::_Any_data const\u0026, com::sun::star::uno::XComponentContext*\u0026\u0026, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026) at /home/sbergman/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/13.0.0/../../../../include/c++/13.0.0/bits/std_function.h:290:9\n   #22 in std::function\u003ccom::sun::star::uno::XInterface* (com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026)\u003e::operator()(com::sun::star::uno::XComponentContext*, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e const\u0026) const at /home/sbergman/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/13.0.0/../../../../include/c++/13.0.0/bits/std_function.h:591:9\n   #23 in cppuhelper::ServiceManager::Data::Implementation::doCreateInstance(com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026) at cppuhelper/source/servicemanager.cxx:705:13\n   #24 in cppuhelper::ServiceManager::Data::Implementation::createInstance(com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026, bool) at cppuhelper/source/servicemanager.cxx:670:30\n   #25 in cppuhelper::ServiceManager::createInstanceWithContext(rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026) at cppuhelper/source/servicemanager.cxx:1005:36\n   #26 in non-virtual thunk to cppuhelper::ServiceManager::createInstanceWithContext(rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026) at cppuhelper/source/servicemanager.cxx\n   #27 in com::sun::star::linguistic2::LinguServiceManager::create(com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026) at workdir/UnoApiHeadersTarget/offapi/normal/com/sun/star/linguistic2/LinguServiceManager.hpp:38:129\n   #28 in GetLngSvcMgr_Impl() at editeng/source/misc/unolingu.cxx:59:52\n   #29 in (anonymous namespace)::SpellDummy_Impl::GetSpell_Impl() at editeng/source/misc/unolingu.cxx:215:61\n   #30 in (anonymous namespace)::SpellDummy_Impl::isValid(rtl::OUString const\u0026, short, com::sun::star::uno::Sequence\u003ccom::sun::star::beans::PropertyValue\u003e const\u0026) at editeng/source/misc/unolingu.cxx:247:5\n   #31 in ImpEditEngine::DoOnlineSpelling(ContentNode*, bool, bool) at editeng/source/editeng/impedit4.cxx:2268:37\n   #32 in EditEngine::CompleteOnlineSpelling() at editeng/source/editeng/editeng.cxx:2393:25\n   #33 in sc::SpellCheckContext::ensureResults(short, int) at sc/source/ui/view/spellcheckcontext.cxx:339:15\n[...]\n   #57 in Scheduler::CallbackTaskScheduling() at vcl/source/app/scheduler.cxx:472:16\n   #58 in SalTimer::CallCallback() at vcl/inc/saltimer.hxx:54:13\n   #59 in SvpSalInstance::CheckTimeout(bool) at vcl/headless/svpinst.cxx:212:53\n   #60 in SvpSalInstance::ImplYield(bool, bool) at vcl/headless/svpinst.cxx:452:17\n   #61 in SvpSalInstance::DoYield(bool, bool) at vcl/headless/svpinst.cxx:524:21\n   #62 in ImplYield(bool, bool) at vcl/source/app/svapp.cxx:474:48\n   #63 in Application::Yield() at vcl/source/app/svapp.cxx:558:5\n   #64 in Application::Execute() at vcl/source/app/svapp.cxx:452:13\n   #65 in desktop::Desktop::Main() at desktop/source/app/app.cxx:1600:13\n  \n  0x6060004c2fb8 is located 56 bytes inside of 64-byte region [0x6060004c2f80,0x6060004c2fc0)\n  freed by thread T0 here:\n   #0 in operator delete(void*, unsigned long) at /home/sbergman/github.com/llvm/llvm-project/compiler-rt/lib/asan/asan_new_delete.cpp:164:3\n   #1 in o3tl::cow_wrapper\u003cstd::__debug::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e\u003e\u003e, o3tl::UnsafeRefCountingPolicy\u003e::release() at include/o3tl/cow_wrapper.hxx:207:17\n   #2 in o3tl::cow_wrapper\u003cstd::__debug::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e\u003e\u003e, o3tl::UnsafeRefCountingPolicy\u003e::~cow_wrapper() at include/o3tl/cow_wrapper.hxx:271:13\n   #3 in comphelper::OInterfaceContainerHelper4\u003ccom::sun::star::ucb::XContentEventListener\u003e::~OInterfaceContainerHelper4() at include/comphelper/interfacecontainer4.hxx:121:34\n   #4 in fileaccess::BaseContent::~BaseContent() at ucb/source/ucp/file/bc.cxx:147:1\n   #5 in fileaccess::BaseContent::~BaseContent() at ucb/source/ucp/file/bc.cxx:141:1\n   #6 in cppu::OWeakObject::release() at cppuhelper/source/weak.cxx:230:9\n   #7 in cppu::WeakImplHelper\u003ccom::sun::star::lang::XComponent, com::sun::star::lang::XServiceInfo, com::sun::star::ucb::XCommandProcessor, com::sun::star::beans::XPropertiesChangeNotifier, com::sun::star::beans::XPropertyContainer, com::sun::star::beans::XPropertySetInfoChangeNotifier, com::sun::star::ucb::XContentCreator, com::sun::star::container::XChild, com::sun::star::ucb::XContent\u003e::release() at include/cppuhelper/implbase.hxx:115:66\n   #8 in com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContent\u003e::~Reference() at include/com/sun/star/uno/Reference.hxx:114:22\n   #9 in ucbhelper::Content_Impl::~Content_Impl() at ucbhelper/source/client/content.cxx:1147:1\n   #10 in ucbhelper::Content_Impl::~Content_Impl() at ucbhelper/source/client/content.cxx:1136:1\n   #11 in salhelper::SimpleReferenceObject::release() at include/salhelper/simplereferenceobject.hxx:76:49\n   #12 in rtl::Reference\u003cucbhelper::Content_Impl\u003e::~Reference() at include/rtl/ref.hxx:129:22\n   #13 in ucbhelper::Content::~Content() at ucbhelper/source/client/content.cxx:362:1\n   #14 in (anonymous namespace)::OFileAccess::openFileRead(rtl::OUString const\u0026) at ucb/source/core/FileAccess.cxx:492:1\n   #15 in (anonymous namespace)::OFileAccess::exists(rtl::OUString const\u0026) at ucb/source/core/FileAccess.cxx:462:49\n   #16 in SpellChecker::getLocales() at lingucomponent/source/spellcheck/spell/sspellimp.cxx:157:50\n   #17 in non-virtual thunk to SpellChecker::getLocales() at lingucomponent/source/spellcheck/spell/sspellimp.cxx\n   #18 in LngSvcMgr::GetAvailableSpellSvcs_Impl() at linguistic/source/lngsvcmgr.cxx:963:67\n   #19 in LngSvcMgr::getAvailableServices(rtl::OUString const\u0026, com::sun::star::lang::Locale const\u0026) at linguistic/source/lngsvcmgr.cxx:1381:9\n  \n  previously allocated by thread T0 here:\n   #0 in operator new(unsigned long) at /home/sbergman/github.com/llvm/llvm-project/compiler-rt/lib/asan/asan_new_delete.cpp:95:3\n   #1 in o3tl::cow_wrapper\u003cstd::__debug::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentEventListener\u003e\u003e\u003e, o3tl::UnsafeRefCountingPolicy\u003e::cow_wrapper() at include/o3tl/cow_wrapper.hxx:221:22\n   #2 in comphelper::OInterfaceContainerHelper4\u003ccom::sun::star::ucb::XContentEventListener\u003e::DEFAULT() at include/comphelper/interfacecontainer4.hxx:237:79\n   #3 in comphelper::OInterfaceContainerHelper4\u003ccom::sun::star::ucb::XContentEventListener\u003e::OInterfaceContainerHelper4() at include/comphelper/interfacecontainer4.hxx:265:14\n   #4 in fileaccess::BaseContent::BaseContent(fileaccess::TaskManager*, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026, rtl::OUString const\u0026) at ucb/source/ucp/file/bc.cxx:125:14\n   #5 in fileaccess::FileProvider::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/ucp/file/prov.cxx:125:39\n   #6 in non-virtual thunk to fileaccess::FileProvider::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/ucp/file/prov.cxx\n   #7 in UniversalContentBroker::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/core/ucb.cxx:477:24\n   #8 in non-virtual thunk to UniversalContentBroker::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/core/ucb.cxx\n   #9 in ucbhelper::getContentNoThrow(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XUniversalContentBroker\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucbhelper/source/client/content.cxx:281:29\n   #10 in ucbhelper::Content::create(rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XCommandEnvironment\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026, ucbhelper::Content\u0026) at ucbhelper/source/client/content.cxx:349:38\n   #11 in (anonymous namespace)::ExpandContentProviderImpl::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/ucp/expand/ucpexpand.cxx:142:9\n   #12 in non-virtual thunk to (anonymous namespace)::ExpandContentProviderImpl::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/ucp/expand/ucpexpand.cxx\n   #13 in UniversalContentBroker::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/core/ucb.cxx:477:24\n   #14 in non-virtual thunk to UniversalContentBroker::queryContent(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucb/source/core/ucb.cxx\n   #15 in ucbhelper::getContentThrow(com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XUniversalContentBroker\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XContentIdentifier\u003e const\u0026) at ucbhelper/source/client/content.cxx:252:29\n   #16 in ucbhelper::Content::Content(rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XCommandEnvironment\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::uno::XComponentContext\u003e const\u0026) at ucbhelper/source/client/content.cxx:311:38\n   #17 in dp_misc::create_ucb_content(ucbhelper::Content*, rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XCommandEnvironment\u003e const\u0026, bool) at desktop/source/deployment/misc/dp_ucb.cxx:56:30\n   #18 in dp_misc::create_folder(ucbhelper::Content*, rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::ucb::XCommandEnvironment\u003e const\u0026, bool) at desktop/source/deployment/misc/dp_ucb.cxx:85:9\n   #19 in dp_manager::PackageManagerImpl::initRegistryBackends() at desktop/source/deployment/manager/dp_manager.cxx:280:9\n",
      "revId": "3816184ee779f32d2210c8fcc9f7dd2c77b6f736",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    }
  ]
}