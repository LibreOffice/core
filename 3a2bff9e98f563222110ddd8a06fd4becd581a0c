{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "02d1c612_34e7a06a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000562
      },
      "writtenOn": "2021-10-12T08:48:53Z",
      "side": 1,
      "message": "I doubt anything else can be done easily to prevent this kind of bug :-(",
      "revId": "3a2bff9e98f563222110ddd8a06fd4becd581a0c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "39637fa9_8db59e00",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000821
      },
      "writtenOn": "2021-10-12T13:24:00Z",
      "side": 1,
      "message": "Maybe it\u0027s feasible to create a wrapper class for DC ( like CompatibleDC in salgdi.cxx ), restore the defaults in the destructor, and let both WinSalGraphics and WinSalPrinter store shared_ptr to that ( to make the order of destruction irrelevant. )? But it\u0027s always worthy to write good document.",
      "revId": "3a2bff9e98f563222110ddd8a06fd4becd581a0c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4f5ef2dd_5dfa730e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000562
      },
      "writtenOn": "2021-10-14T10:15:53Z",
      "side": 1,
      "message": "There are two / three problems to solve:\n1. Restoring the default values before \"deletion\"\n2.1 Use the correct function to free the HDC (DeleteDC or ReleaseDC)\n(2.2 \"create\" and \"delete\" in the same thread / window \"context\"; not sure about it, but we have SAL_MSG_RELEASEDC for cached DCs)\n\nTo solve 1, we could wrap all DCs in a class, which restores the defaults (basically using the existing code from WinSalGraphics) and no more direct manipulation of the HDC, and to solve 2 we provide a Deleter to the correct method to the std::shared_ptr. Feels like a lot of work.",
      "parentUuid": "39637fa9_8db59e00",
      "revId": "3a2bff9e98f563222110ddd8a06fd4becd581a0c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb9db0e2_66f05308",
        "filename": "vcl/win/gdi/salprn.cxx",
        "patchSetId": 1
      },
      "lineNbr": 1377,
      "author": {
        "id": 1000821
      },
      "writtenOn": "2021-10-12T13:24:00Z",
      "side": 1,
      "message": "Just my two cents: I felt confused when reading \"so needs to apply the defaults before deletion.\" Then I digged into WinSalGraphics::~WinSalGraphics and WinSalGraphics::DeInitGraphics() and realized what you mean. I think maybe it\u0027s just enough to say WinSalGraphics destructor has to be called first because hDC has been borrowed / referred in the object.",
      "range": {
        "startLine": 1377,
        "startChar": 0,
        "endLine": 1377,
        "endChar": 49
      },
      "revId": "3a2bff9e98f563222110ddd8a06fd4becd581a0c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    }
  ]
}