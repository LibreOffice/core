{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f2861e7c_e5fa15ee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 20
      },
      "lineNbr": 0,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2021-11-25T13:25:56Z",
      "side": 1,
      "message": "this causes UITest_writer_tests4 to fail in an ASan build with\n  \u003d\u003d2987325\u003d\u003dERROR: AddressSanitizer: heap-use-after-free on address 0x6130000e5048 at pc 0x7f20cb3112ac bp 0x7f1e62de92d0 sp 0x7f1e62de92c8\n  WRITE of size 8 at 0x6130000e5048 thread T47\n   #0 in SwFrameFormat::SetOtherTextBoxFormat(SwTextBoxNode*) at sw/inc/frmfmt.hxx:106:77\n   #1 in SwTextBoxNode::~SwTextBoxNode() at sw/source/core/doc/textboxhelper.cxx:1680:30\n   #2 in SwFrameFormat::~SwFrameFormat() at sw/source/core/layout/atrfrm.cxx:2564:9\n   #3 in SwDrawFrameFormat::~SwDrawFrameFormat() at sw/source/core/layout/atrfrm.cxx:3455:1\n   #4 in SwDrawFrameFormat::~SwDrawFrameFormat() at sw/source/core/layout/atrfrm.cxx:3453:1\n   #5 in SwFrameFormats::DeleteAndDestroyAll(bool) at sw/source/core/doc/docfmt.cxx:2115:9\n   #6 in SwDoc::~SwDoc() at sw/source/core/doc/docnew.cxx:565:28\n   #7 in SwDoc::release() at sw/source/core/doc/doc.cxx:118:9\n   #8 in rtl::Reference\u003cSwDoc\u003e::clear() at include/rtl/ref.hxx:196:19\n   #9 in SwDocShell::RemoveLink() at sw/source/uibase/app/docshini.cxx:444:16\n   #10 in SwDocShell::~SwDocShell() at sw/source/uibase/app/docshini.cxx:372:5\n   #11 in SwDocShell::~SwDocShell() at sw/source/uibase/app/docshini.cxx:362:1\n   #12 in SwDocShell::~SwDocShell() at sw/source/uibase/app/docshini.cxx:362:1\n   #13 in SvRefBase::ReleaseRef() at include/tools/ref.hxx:163:29\n   #14 in tools::SvRef\u003cSfxObjectShell\u003e::~SvRef() at include/tools/ref.hxx:56:36\n   #15 in IMPL_SfxBaseModel_DataContainer::~IMPL_SfxBaseModel_DataContainer() at sfx2/source/doc/sfxbasemodel.cxx:245:5\n   #16 in void std::destroy_at\u003cIMPL_SfxBaseModel_DataContainer\u003e(IMPL_SfxBaseModel_DataContainer*) at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/stl_construct.h:88:15\n   #17 in void std::allocator_traits\u003cstd::allocator\u003cIMPL_SfxBaseModel_DataContainer\u003e \u003e::destroy\u003cIMPL_SfxBaseModel_DataContainer\u003e(std::allocator\u003cIMPL_SfxBaseModel_DataContainer\u003e\u0026, IMPL_SfxBaseModel_DataContainer*) at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/alloc_traits.h:537:4\n   #18 in std::_Sp_counted_ptr_inplace\u003cIMPL_SfxBaseModel_DataContainer, std::allocator\u003cIMPL_SfxBaseModel_DataContainer\u003e, (__gnu_cxx::_Lock_policy)2\u003e::_M_dispose() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:528:2\n   #19 in std::_Sp_counted_base\u003c(__gnu_cxx::_Lock_policy)2\u003e::_M_release() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:168:6\n   #20 in std::__shared_count\u003c(__gnu_cxx::_Lock_policy)2\u003e::~__shared_count() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:705:11\n   #21 in std::__shared_ptr\u003cIMPL_SfxBaseModel_DataContainer, (__gnu_cxx::_Lock_policy)2\u003e::~__shared_ptr() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:1154:31\n   #22 in std::__shared_ptr\u003cIMPL_SfxBaseModel_DataContainer, (__gnu_cxx::_Lock_policy)2\u003e::reset() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:1272:9\n   #23 in SfxBaseModel::dispose() at sfx2/source/doc/sfxbasemodel.cxx:757:13\n   #24 in SwXTextDocument::dispose() at sw/source/uibase/uno/unotxdoc.cxx:549:19\n   #25 in SfxBaseModel::close(unsigned char) at sfx2/source/doc/sfxbasemodel.cxx:1482:5\n   #26 in SwXTextDocument::close(unsigned char) at sw/source/uibase/uno/unotxdoc.cxx:562:19\n   #27 in SfxBaseModel::dispose() at sfx2/source/doc/sfxbasemodel.cxx:718:13\n   #28 in SwXTextDocument::dispose() at sw/source/uibase/uno/unotxdoc.cxx:549:19\n   #29 in gcc3::callVirtualMethod(void*, unsigned int, void*, _typelib_TypeDescriptionReference*, bool, unsigned long*, unsigned int, unsigned long*, double*) at bridges/source/cpp_uno/gcc3_linux_x86-64/callvirtualmethod.cxx:77:5\n   #30 in cpp_call(bridges::cpp_uno::shared::UnoInterfaceProxy*, bridges::cpp_uno::shared::VtableSlot, _typelib_TypeDescriptionReference*, int, _typelib_MethodParameter*, void*, void**, _uno_Any**) at bridges/source/cpp_uno/gcc3_linux_x86-64/uno2cpp.cxx:233:13\n   #31 in unoInterfaceProxyDispatch at bridges/source/cpp_uno/gcc3_linux_x86-64/uno2cpp.cxx:413:13\n   #32 in binaryurp::IncomingRequest::execute_throw(binaryurp::BinaryAny*, std::__debug::vector\u003cbinaryurp::BinaryAny, std::allocator\u003cbinaryurp::BinaryAny\u003e \u003e*) const at binaryurp/source/incomingrequest.cxx:235:13\n   #33 in binaryurp::IncomingRequest::execute() const at binaryurp/source/incomingrequest.cxx:78:26\n   #34 in request at binaryurp/source/reader.cxx:85:9\n   #35 in cppu_threadpool::JobQueue::enter(void const*, bool) at cppu/source/threadpool/jobqueue.cxx:100:17\n   #36 in cppu_threadpool::ORequestThread::run() at cppu/source/threadpool/thread.cxx:164:31\n   #37 in threadFunc at include/osl/thread.hxx:189:15\n   #38 in osl_thread_start_Impl(void*) at sal/osl/unx/thread.cxx:264:9\n   #39 in start_thread at \u003cnull\u003e\n   #40 in __GI___clone3 at \u003cnull\u003e\n  \n  0x6130000e5048 is located 328 bytes inside of 376-byte region [0x6130000e4f00,0x6130000e5078)\n  freed by thread T47 here:\n   #0 in operator delete(void*, unsigned long) at ~/github.com/llvm/llvm-project/compiler-rt/lib/asan/asan_new_delete.cpp:164:3\n   #1 in SwFlyFrameFormat::~SwFlyFrameFormat() at sw/source/core/layout/atrfrm.cxx:2912:1\n   #2 in SwFrameFormats::DeleteAndDestroyAll(bool) at sw/source/core/doc/docfmt.cxx:2115:9\n   #3 in SwDoc::~SwDoc() at sw/source/core/doc/docnew.cxx:565:28\n   #4 in SwDoc::release() at sw/source/core/doc/doc.cxx:118:9\n   #5 in rtl::Reference\u003cSwDoc\u003e::clear() at include/rtl/ref.hxx:196:19\n   #6 in SwDocShell::RemoveLink() at sw/source/uibase/app/docshini.cxx:444:16\n   #7 in SwDocShell::~SwDocShell() at sw/source/uibase/app/docshini.cxx:372:5\n   #8 in SwDocShell::~SwDocShell() at sw/source/uibase/app/docshini.cxx:362:1\n   #9 in SwDocShell::~SwDocShell() at sw/source/uibase/app/docshini.cxx:362:1\n   #10 in SvRefBase::ReleaseRef() at include/tools/ref.hxx:163:29\n   #11 in tools::SvRef\u003cSfxObjectShell\u003e::~SvRef() at include/tools/ref.hxx:56:36\n   #12 in IMPL_SfxBaseModel_DataContainer::~IMPL_SfxBaseModel_DataContainer() at sfx2/source/doc/sfxbasemodel.cxx:245:5\n   #13 in void std::destroy_at\u003cIMPL_SfxBaseModel_DataContainer\u003e(IMPL_SfxBaseModel_DataContainer*) at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/stl_construct.h:88:15\n   #14 in void std::allocator_traits\u003cstd::allocator\u003cIMPL_SfxBaseModel_DataContainer\u003e \u003e::destroy\u003cIMPL_SfxBaseModel_DataContainer\u003e(std::allocator\u003cIMPL_SfxBaseModel_DataContainer\u003e\u0026, IMPL_SfxBaseModel_DataContainer*) at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/alloc_traits.h:537:4\n   #15 in std::_Sp_counted_ptr_inplace\u003cIMPL_SfxBaseModel_DataContainer, std::allocator\u003cIMPL_SfxBaseModel_DataContainer\u003e, (__gnu_cxx::_Lock_policy)2\u003e::_M_dispose() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:528:2\n   #16 in std::_Sp_counted_base\u003c(__gnu_cxx::_Lock_policy)2\u003e::_M_release() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:168:6\n   #17 in std::__shared_count\u003c(__gnu_cxx::_Lock_policy)2\u003e::~__shared_count() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:705:11\n   #18 in std::__shared_ptr\u003cIMPL_SfxBaseModel_DataContainer, (__gnu_cxx::_Lock_policy)2\u003e::~__shared_ptr() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:1154:31\n   #19 in std::__shared_ptr\u003cIMPL_SfxBaseModel_DataContainer, (__gnu_cxx::_Lock_policy)2\u003e::reset() at ~/gcc/trunk/inst/lib/gcc/x86_64-pc-linux-gnu/12.0.0/../../../../include/c++/12.0.0/bits/shared_ptr_base.h:1272:9\n  \n  previously allocated by thread T10 here:\n   #0 in operator new(unsigned long) at ~/github.com/llvm/llvm-project/compiler-rt/lib/asan/asan_new_delete.cpp:95:3\n   #1 in SwDoc::MakeFlyFrameFormat(rtl::OUString const\u0026, SwFrameFormat*) at sw/source/core/doc/docfmt.cxx:756:33\n   #2 in SwDoc::MakeFlySection_(SwPosition const\u0026, SwContentNode const\u0026, RndStdIds, SfxItemSet const*, SwFrameFormat*) at sw/source/core/doc/doclay.cxx:171:33\n   #3 in SwDoc::MakeFlySection(RndStdIds, SwPosition const*, SfxItemSet const*, SwFrameFormat*, bool) at sw/source/core/doc/doclay.cxx:337:19\n   #4 in SwXFrame::attachToRange(com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextRange\u003e const\u0026, SwPaM const*) at sw/source/core/unocore/unoframe.cxx:2821:29\n   #5 in SwXFrame::attach(com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextRange\u003e const\u0026) at sw/source/core/unocore/unoframe.cxx:3115:9\n   #6 in SwXTextFrame::attach(com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextRange\u003e const\u0026) at sw/source/core/unocore/unoframe.cxx:3346:15\n   #7 in SwXText::insertTextContent(com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextRange\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextContent\u003e const\u0026, unsigned char) at sw/source/core/unocore/unotext.cxx:615:15\n   #8 in SwXText::insertTextContentWithProperties(com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextContent\u003e const\u0026, com::sun::star::uno::Sequence\u003ccom::sun::star::beans::PropertyValue\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextRange\u003e const\u0026) at sw/source/core/unocore/unotext.cxx:1472:5\n   #9 in non-virtual thunk to SwXText::insertTextContentWithProperties(com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextContent\u003e const\u0026, com::sun::star::uno::Sequence\u003ccom::sun::star::beans::PropertyValue\u003e const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::text::XTextRange\u003e const\u0026) at sw/source/core/unocore/unotext.cxx\n   #10 in SwTextBoxHelper::create(SwFrameFormat*, SdrObject*, bool) at sw/source/core/doc/textboxhelper.cxx:100:29\n   #11 in SwXShape::setPropertyValue(rtl::OUString const\u0026, com::sun::star::uno::Any const\u0026) at sw/source/core/unocore/unodraw.cxx:1165:25\n   #12 in SdXMLShapeContext::SetStyle(bool) at xmloff/source/draw/ximpshap.cxx:701:27\n   #13 in SdXMLCustomShapeContext::startFastElement(int, com::sun::star::uno::Reference\u003ccom::sun::star::xml::sax::XFastAttributeList\u003e const\u0026) at xmloff/source/draw/ximpshap.cxx:3545:5\n   #14 in SvXMLImport::startFastElement(int, com::sun::star::uno::Reference\u003ccom::sun::star::xml::sax::XFastAttributeList\u003e const\u0026) at xmloff/source/core/xmlimp.cxx:805:15\n   #15 in (anonymous namespace)::Entity::startElement((anonymous namespace)::Event const*) at sax/source/fastparser/fastparser.cxx:468:27\n   #16 in sax_fastparser::FastSaxParserImpl::callbackStartElement(unsigned char const*, unsigned char const*, unsigned char const*, int, unsigned char const**, int, unsigned char const**) at sax/source/fastparser/fastparser.cxx:1304:21\n   #17 in (anonymous namespace)::call_callbackStartElement(void*, unsigned char const*, unsigned char const*, unsigned char const*, int, unsigned char const**, int, int, unsigned char const**) at sax/source/fastparser/fastparser.cxx:331:18\n   #18 in xmlParseStartTag2 at workdir/UnpackedTarball/libxml2/parser.c:9658:6\n   #19 in xmlParseTryOrFinish at workdir/UnpackedTarball/libxml2/parser.c:11453:14\n\n",
      "revId": "eabcfb3f18a6944d9ad89cecd3eb3ca7a2259cf3",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "01b557fb_106f6a07",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 20
      },
      "lineNbr": 0,
      "author": {
        "id": 1002210
      },
      "writtenOn": "2021-11-25T13:56:16Z",
      "side": 1,
      "message": "Thank you for reporting the problem. If i see well, the problem might be that when ~SwDoc() called the ~SwFrameFormat() dtor calls the ~SwTextBoxNode() dtor which tries to set the OtherTextBoxFormat to nullptr of the dying frameformat... Sorry for that. If I right what you suggest, should i make a new patch where i fix this or do you want to revert this patch?",
      "parentUuid": "f2861e7c_e5fa15ee",
      "revId": "eabcfb3f18a6944d9ad89cecd3eb3ca7a2259cf3",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53f8989f_14d9bc78",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 20
      },
      "lineNbr": 0,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2021-11-25T14:05:04Z",
      "side": 1,
      "message": "If you come up with a fix, please commit it (and I can give it a try with ASan before you commit it, if you can\u0027t check it yourself with something like ASan or Valgrind).  If you don\u0027t come up with a fix in time, please revert this.",
      "parentUuid": "01b557fb_106f6a07",
      "revId": "eabcfb3f18a6944d9ad89cecd3eb3ca7a2259cf3",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "42085aba_d9864cfc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 20
      },
      "lineNbr": 0,
      "author": {
        "id": 1002210
      },
      "writtenOn": "2021-11-25T14:23:56Z",
      "side": 1,
      "message": "Thank you. Ok, I try to fix it ASAP and if you do not mind i\u0027ll add you as reviewer for the fix. Is it good if tomorrow i do it?",
      "parentUuid": "53f8989f_14d9bc78",
      "revId": "eabcfb3f18a6944d9ad89cecd3eb3ca7a2259cf3",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3bb44f7_e3388d13",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 20
      },
      "lineNbr": 0,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2021-11-25T14:40:05Z",
      "side": 1,
      "message": "\u003e Is it good if tomorrow i do it?\n\nYes, sure, that\u0027s fine.  Thanks.",
      "parentUuid": "42085aba_d9864cfc",
      "revId": "eabcfb3f18a6944d9ad89cecd3eb3ca7a2259cf3",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "33868f78_60bb6293",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 20
      },
      "lineNbr": 0,
      "author": {
        "id": 1000045
      },
      "writtenOn": "2021-11-28T14:27:57Z",
      "side": 1,
      "message": "sent a revert now as \u003chttps://gerrit.libreoffice.org/c/core/+/125977\u003e \"Revert \u0027tdf#129183 sw: textboxes in group shapes - part 3\u0027\"; would be good to get \u003chttps://ci.libreoffice.org/job/lo_ubsan/\u003e (which started to suffer from various breakages recently) green again",
      "revId": "eabcfb3f18a6944d9ad89cecd3eb3ca7a2259cf3",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    }
  ]
}