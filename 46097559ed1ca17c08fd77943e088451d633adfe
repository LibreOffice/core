{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "eb6efe70_590d940c",
        "filename": "include/o3tl/lru_map.hxx",
        "patchSetId": 2
      },
      "lineNbr": 266,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2022-07-26T08:58:26Z",
      "side": 1,
      "message": "Opening, running a macro, and then closing a specific file in 7.4 now hangs on my Win10 system in this remove_if on close, with mLruList empty (size() \u003d\u003d 0), and it not being equal to end() and *not* changing in operator ++(). The only thread in the process at this time is the main thread.\n\nThis is the call stack:\n  mergedlo.dll!o3tl::lru_map\u003cScaleCacheKey,BitmapEx,std::hash\u003cScaleCacheKey\u003e,std::equal_to\u003cScaleCacheKey\u003e,void\u003e::remove_if\u003cbool \u003clambda\u003e(const std::pair\u003cScaleCacheKey,BitmapEx\u003e \u0026)\u003e(SalBitmap::DropScaledCache::__l5::bool \u003clambda\u003e(const std::pair\u003cScaleCacheKey,BitmapEx\u003e \u0026) pred) Line 263\tC++\n  [Inline Frame] mergedlo.dll!std::_Ref_count_base::_Decref() Line 1106\tC++\n  [Inline Frame] mergedlo.dll!std::_Ptr_base\u003cSalBitmap\u003e::_Decref() Line 1331\tC++\n  [Inline Frame] mergedlo.dll!std::shared_ptr\u003cSalBitmap\u003e::{dtor}() Line 1614\tC++\n  mergedlo.dll!Bitmap::~Bitmap() Line 166\tC++\n  mergedlo.dll!std::_Ref_count_obj2\u003cImplImage\u003e::_Destroy() Line 2031\tC++\n  [Inline Frame] mergedlo.dll!std::_Ref_count_base::_Decref() Line 1106\tC++\n  [Inline Frame] mergedlo.dll!std::_Ptr_base\u003cImplImage\u003e::_Decref() Line 1331\tC++\n  [Inline Frame] mergedlo.dll!std::shared_ptr\u003cImplImage\u003e::{dtor}() Line 1614\tC++\n  [Inline Frame] mergedlo.dll!std::_Default_allocator_traits\u003cstd::allocator\u003cImage\u003e\u003e::destroy(std::allocator\u003cImage\u003e \u0026) Line 690\tC++\n  mergedlo.dll!std::_Destroy_range\u003cstd::allocator\u003cImage\u003e\u003e(Image * _First, Image * const _Last, std::allocator\u003cImage\u003e \u0026) Line 905\tC++\n  [Inline Frame] mergedlo.dll!std::vector\u003cImage,std::allocator\u003cImage\u003e\u003e::_Destroy(Image *) Line 1667\tC++\n  mergedlo.dll!std::vector\u003cImage,std::allocator\u003cImage\u003e\u003e::_Tidy() Line 1752\tC++\n  [Inline Frame] mergedlo.dll!std::vector\u003cImage,std::allocator\u003cImage\u003e\u003e::{dtor}() Line 699\tC++\n  mergedlo.dll!ImplSVWinData::~ImplSVWinData() Line 503\tC++\n  ucrtbase.dll!\u003clambda\u003e(void)()\tUnknown\n  ucrtbase.dll!__crt_seh_guarded_call\u003cint\u003e::operator()\u003c\u003clambda_7777bce6b2f8c936911f934f8298dc43\u003e,\u003clambda\u003e(void) \u0026,\u003clambda_3883c3dff614d5e0c5f61bb1ac94921c\u003e\u003e()\tUnknown\n  ucrtbase.dll!_execute_onexit_table\u001e()\tUnknown\n  mergedlo.dll!dllmain_crt_process_detach(const bool is_terminating) Line 182\tC++\n  mergedlo.dll!dllmain_dispatch(HINSTANCE__ * const instance, const unsigned long reason, void * const reserved) Line 293\tC++\n  ntdll.dll!00007ffef30c9a1d()\tUnknown\n  ntdll.dll!00007ffef310db91()\tUnknown\n  ntdll.dll!00007ffef310da2d()\tUnknown\n  kernel32.dll!00007ffef281e0ab()\tUnknown\n  ucrtbase.dll!exit_or_terminate_process()\tUnknown\n  ucrtbase.dll!common_exit()\tUnknown\n  mergedlo.dll!desktop::Desktop::Exception(ExceptionCategory nCategory) Line 1177\tC++\n  mergedlo.dll!VCLExceptionSignal_impl(void * __formal, oslSignalInfo * pInfo) Line 173\tC++\n  [Inline Frame] sal3.dll!callSignalHandler(oslSignalInfo *) Line 48\tC++\n  sal3.dll!`anonymous namespace\u0027::signalHandlerFunction(_EXCEPTION_POINTERS * lpEP) Line 108\tC++\n  KernelBase.dll!00007ffef0a70057()\tUnknown\n  [Inline Frame] vclplug_winlo.dll!WinSalInstance::WorkaroundExceptionHandlingInUSER32Lib(int __formal, _EXCEPTION_POINTERS * pExceptionInfo) Line 920\tC++\n  vclplug_winlo.dll!`SalFrameWndProcW\u0027::`1\u0027::filt$0() Line 5952\tC++\n  vcruntime140.dll!00007ffe8555eff0()\tUnknown\n  ntdll.dll!00007ffef315229f()\tUnknown\n  ntdll.dll!00007ffef3101454()\tUnknown\n  ntdll.dll!00007ffef3150dce()\tUnknown\n  [Inline Frame] mergedlo.dll!com::sun::star::uno::Type::operator\u003d\u003d(const com::sun::star::uno::Type \u0026) Line 189\tC++\n  mergedlo.dll!comphelper::OWeakTypeObject::queryInterface(const com::sun::star::uno::Type \u0026 rType) Line 39\tC++\n  mergedlo.dll!SdrObjListIter::ImpProcessObj(const SdrObject \u0026 rSdrObject, SdrIterMode eMode) Line 127\tC++\n  mergedlo.dll!SdrObjListIter::ImpProcessObjectList(const SdrObjList \u0026 rObjList, SdrIterMode eMode) Line 88\tC++\n  mergedlo.dll!SdrObjListIter::SdrObjListIter(const SdrPage * pSdrPage, SdrIterMode eMode, bool bReverse) Line 73\tC++\n  sclo.dll!ScDocument::UpdateChartListenerCollection() Line 592\tC++\n  sclo.dll!ScDocShell::SetDrawModified() Line 3049\tC++\n  sclo.dll!ScDocShell::SetDocumentModified() Line 2979\tC++\n  sclo.dll!ScDocShellModificator::SetDocumentModified() Line 3307\tC++\n  sclo.dll!ScDocShell::MoveTable(short nSrcTab, short nDestTab, bool bCopy, bool bRecord) Line 1011\tC++\n  sclo.dll!ScTableSheetsObj::copyByName(const rtl::OUString \u0026 aName, const rtl::OUString \u0026 aCopy, short nDestination) Line 3685\tC++\n  vbaobjlo.dll!ScVbaWorksheet::createSheetCopy(const com::sun::star::uno::Reference\u003cooo::vba::excel::XWorksheet\u003e \u0026 xSheet, bool bAfter) Line 232\tC++\n  vbaobjlo.dll!ScVbaWorksheet::Copy(const com::sun::star::uno::Any \u0026 Before, const com::sun::star::uno::Any \u0026 After) Line 558\tC++\n  mscx_uno.dll!`anonymous namespace\u0027::cpp_call(bridges::cpp_uno::shared::UnoInterfaceProxy * pThis, bridges::cpp_uno::shared::VtableSlot aVtableSlot, _typelib_TypeDescriptionReference * pReturnTypeRef, long nParams, _typelib_MethodParameter * pParams, void * pUnoReturn, void * * pUnoArgs, _uno_Any * * ppUnoExc) Line 214\tC++\n  mscx_uno.dll!unoInterfaceProxyDispatch(_uno_Interface * pUnoI, const _typelib_TypeDescription * pMemberTD, void * pReturn, void * * pArgs, _uno_Any * * ppException) Line 430\tC++\n  reflectionlo.dll!stoc_corefl::`anonymous namespace\u0027::IdlInterfaceMethodImpl::invoke(const com::sun::star::uno::Any \u0026 rObj, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e \u0026 rArgs) Line 674\tC++\n  mergedlo.dll!SbUnoObject::Notify(SfxBroadcaster \u0026 rBC, const SfxHint \u0026 rHint) Line 2249\tC++\n  mergedlo.dll!SfxBroadcaster::Broadcast(const SfxHint \u0026 rHint) Line 35\tC++\n  mergedlo.dll!SbxVariable::Broadcast(SfxHintId nHintId) Line 154\tC++\n  mergedlo.dll!SbxValue::SbxValue(const SbxValue \u0026 r) Line 67\tC++\n  mergedlo.dll!SbxVariable::SbxVariable(const SbxVariable \u0026 r) Line 48\tC++\n  mergedlo.dll!SbxMethod::SbxMethod(const SbxMethod \u0026 r) Line 841\tC++\n  mergedlo.dll!SbiRuntime::FindElement(SbxObject * pObj, unsigned long nOp1, unsigned long nOp2, ErrCode nNotFound, bool bLocal, bool bStatic) Line 3710\tC++\n  mergedlo.dll!SbiRuntime::StepELEM(unsigned long nOp1, unsigned long nOp2) Line 4195\tC++\n  mergedlo.dll!SbiRuntime::Step() Line 832\tC++\n  [Inline Frame] mergedlo.dll!`anonymous-namespace\u0027::RunInitGuard::run() Line 1015\tC++\n  mergedlo.dll!SbModule::Run(SbMethod * pMeth) Line 1176\tC++\n  mergedlo.dll!SbModule::Notify(SfxBroadcaster \u0026 rBC, const SfxHint \u0026 rHint) Line 776\tC++\n  mergedlo.dll!SfxBroadcaster::Broadcast(const SfxHint \u0026 rHint) Line 35\tC++\n  mergedlo.dll!SbMethod::Broadcast(SfxHintId nHintId) Line 2116\tC++\n  mergedlo.dll!SbxValue::Get(SbxValues \u0026 rRes) Line 289\tC++\n  mergedlo.dll!SbMethod::Call(SbxValue * pRet, SbxVariable * pCaller) Line 2073\tC++\n  mergedlo.dll!basprov::BasicScriptImpl::invoke(const com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e \u0026 aParams, com::sun::star::uno::Sequence\u003cshort\u003e \u0026 aOutParamIndex, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e \u0026 aOutParam) Line 251\tC++\n  mergedlo.dll!SfxObjectShell::CallXScript(const com::sun::star::uno::Reference\u003ccom::sun::star::uno::XInterface\u003e \u0026 _rxScriptContext, const rtl::OUString \u0026 _rScriptURL, const com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e \u0026 aParams, com::sun::star::uno::Any \u0026 aRet, com::sun::star::uno::Sequence\u003cshort\u003e \u0026 aOutParamIndex, com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e \u0026 aOutParam, bool bRaiseError, const com::sun::star::uno::Any * pCaller) Line 1433\tC++\n  [Inline Frame] mergedlo.dll!SfxObjectShell::CallXScript(const rtl::OUString \u0026) Line 1462\tC++\n  mergedlo.dll!svxform::`anonymous namespace\u0027::NewStyleUNOScript::invoke(const com::sun::star::uno::Sequence\u003ccom::sun::star::uno::Any\u003e \u0026 _rArguments, com::sun::star::uno::Any \u0026 _rSynchronousResult) Line 831\tC++\n  mergedlo.dll!svxform::FormScriptingEnvironment::doFireScriptEvent(const com::sun::star::script::ScriptEvent \u0026 _rEvent, com::sun::star::uno::Any * _pSynchronousResult) Line 906\tC++\n  [Inline Frame] mergedlo.dll!svxform::FormScriptListener::impl_doFireScriptEvent_nothrow(std::unique_lock\u003cstd::mutex\u003e \u0026) Line 684\tC++\n  [Inline Frame] mergedlo.dll!svxform::FormScriptListener::OnAsyncScriptEvent(void *) Line 744\tC++\n  mergedlo.dll!svxform::FormScriptListener::LinkStubOnAsyncScriptEvent(void * instance, void * data) Line 733\tC++\n  [Inline Frame] mergedlo.dll!Link\u003cvoid *,void\u003e::Call(void *) Line 111\tC++\n  [Inline Frame] mergedlo.dll!ImplHandleUserEvent(ImplSVEvent *) Line 2229\tC++\n  mergedlo.dll!ImplWindowFrameProc(vcl::Window * _pWindow, SalEvent nEvent, const void * pEvent) Line 2799\tC++\n  mergedlo.dll!SalFrame::CallCallback(SalEvent nEvent, const void * pEvent) Line 308\tC++\n  [Inline Frame] vclplug_winlo.dll!ImplHandleUserEvent(HWND__ *) Line 4191\tC++\n  vclplug_winlo.dll!SalFrameWndProc(HWND__ * hWnd, unsigned int nMsg, unsigned __int64 wParam, __int64 lParam, bool \u0026 rDef) Line 5842\tC++\n  vclplug_winlo.dll!SalFrameWndProcW(HWND__ * hWnd, unsigned int nMsg, unsigned __int64 wParam, __int64 lParam) Line 5950\tC++\n  user32.dll!UserCallWinProcCheckWow()\tUnknown\n  user32.dll!DispatchMessageWorker()\tUnknown\n  vclplug_winlo.dll!ImplSalDispatchMessage(const tagMSG * pMsg) Line 476\tC++\n  vclplug_winlo.dll!ImplSalYield(bool bWait, bool bHandleAllCurrentEvents) Line 508\tC++\n  vclplug_winlo.dll!WinSalInstance::DoYield(bool bWait, bool bHandleAllCurrentEvents) Line 581\tC++\n  mergedlo.dll!ImplYield(bool i_bWait, bool i_bAllEvents) Line 477\tC++\n  mergedlo.dll!Application::Execute() Line 451\tC++\n  mergedlo.dll!desktop::Desktop::Main() Line 1600\tC++\n  mergedlo.dll!ImplSVMain() Line 202\tC++\n  [Inline Frame] mergedlo.dll!SVMain() Line 234\tC++\n  mergedlo.dll!soffice_main() Line 94\tC++\n  [Inline Frame] soffice.bin!sal_main() Line 51\tC\n  soffice.bin!main(int argc, char * * argv) Line 49\tC\n  [Inline Frame] soffice.bin!invoke_main() Line 78\tC++\n  soffice.bin!__scrt_common_main_seh() Line 288\tC++\n  kernel32.dll!00007ffef2817034()\tUnknown\n  ntdll.dll!00007ffef3102651()\tUnknown",
      "revId": "46097559ed1ca17c08fd77943e088451d633adfe",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    }
  ]
}