{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b9b276be_5b37c9a4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000057
      },
      "writtenOn": "2021-11-16T16:02:38Z",
      "side": 1,
      "message": "Take your time, I do the same...\nI opted to remove the old calculation with January 4 and to simply check if the day of the week of start and finish cross the week border of the night between Sunday and Monday.\nAlso, to keep just one calculation, I used the definition that WEEKS(d2;d1;m) \u003d -WEEKS(d1;d2;m).",
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e8f68493_ce808855",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000057
      },
      "writtenOn": "2021-11-17T13:23:43Z",
      "side": 1,
      "message": "Thanks for your comments, please see my replies below.",
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "26279714_6bc5f2e7",
        "filename": "scaddins/source/datefunc/datefunc.cxx",
        "patchSetId": 1
      },
      "lineNbr": 449,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2021-11-16T19:01:26Z",
      "side": 1,
      "message": "I don\u0027t think that week number is used here. What is the difference between week number 42 in year X and week number 3 in year Y? I suppose that \"by ISO8601 weeks\" is more correct.",
      "range": {
        "startLine": 449,
        "startChar": 39,
        "endLine": 449,
        "endChar": 49
      },
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "69c6b931_4c0f0c07",
        "filename": "scaddins/source/datefunc/datefunc.cxx",
        "patchSetId": 1
      },
      "lineNbr": 449,
      "author": {
        "id": 1000057
      },
      "writtenOn": "2021-11-17T13:23:43Z",
      "side": 1,
      "message": "That looks like a more correct reading indeed. I\u0027ll wait for comment from Eike before submitting a revised patch.",
      "parentUuid": "26279714_6bc5f2e7",
      "range": {
        "startLine": 449,
        "startChar": 39,
        "endLine": 449,
        "endChar": 49
      },
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b9539312_acff8043",
        "filename": "scaddins/source/datefunc/datefunc.cxx",
        "patchSetId": 1
      },
      "lineNbr": 475,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2021-11-16T19:01:26Z",
      "side": 1,
      "message": "I feel that trying to keep only integral computations, it brings much complexity. But dividing by 7.0 instead of 7, and then using std::floor on result, would give you uniform computation suitable for both positive and negative differences.",
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "550d98ca_508d98fd",
        "filename": "scaddins/source/datefunc/datefunc.cxx",
        "patchSetId": 1
      },
      "lineNbr": 475,
      "author": {
        "id": 1000057
      },
      "writtenOn": "2021-11-17T13:23:43Z",
      "side": 1,
      "message": "With mode 1, it is not if the number of weeks lies between n.00001 and n.99999, but how many \u0027week crossings\u0027 have taken place (see link to documentation in my comment 1).\nSo any call to weeks with startdate on a Sunday and enddate on a Monday will have 1 more week than the int division by 7. And any call with startdate on a Monday and enddate ion a Sunday will just have the int division by 7 as result, even if there are more days between startdate and enddate.\nTo avoid using week numbers and difficult calculations when crossing years, I simply remove the whole weeks between startdate and enddate, leaving just the comparison of the day of week.\n\nAnd to avoid different comparisons for startdate\u003c\u003denddate and startdate\u003eenddate, I calculate only with startdate\u003c\u003denddate and correct to negative value if the WEEKS argument have startdate\u003eenddate.\n\nI hope all this rambling is clear...",
      "parentUuid": "b9539312_acff8043",
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "51b44253_289d952b",
        "filename": "scaddins/source/datefunc/datefunc.cxx",
        "patchSetId": 1
      },
      "lineNbr": 475,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2021-11-17T14:08:54Z",
      "side": 1,
      "message": "It\u0027s better to think not about number of \"week crossings\", but about substracting week numbers of the dates - where week numbers are taken from *any* given week treated as 0. The only important part here is calculating the correct week numbers.\nAnd it\u0027s very interesting to note, that 0001-01-01 was *Monday*. So given that in the code, date 0001-01-01 is 0, it\u0027s really trivial to count week number based on that date (call that week of 0001-01-01 \"week 0\") - it then doesn\u0027t need *any* \"zero date\" calculated/added to the two dates. Any your date\u0027s week number is simply std::floor(date/7.0). This is true for both date \u003e\u003d 0 and date \u003c 0: floor makes -0.01 round to -1.",
      "parentUuid": "550d98ca_508d98fd",
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9d0012e_8be941c9",
        "filename": "scaddins/source/datefunc/datefunc.cxx",
        "patchSetId": 1
      },
      "lineNbr": 475,
      "author": {
        "id": 1000057
      },
      "writtenOn": "2021-11-19T14:50:56Z",
      "side": 1,
      "message": "It looks as if we have two subjects we discuss:\n-the functional specification\n-the actual coding\nFor me (int)/ and % and Floor are roughly equivalent, my preference goes to understandable code.\n\nWRT the functional spec, the documentation referred to by me in earlier comments states \u0027If Type is 1, WEEKS calculates the Monday-to-Sunday week that StartDate and EndDate each lie in, and returns the difference between those week numbers.\u0027. Therefore we need to know the dow for start date and end date. And therefore it is essential to use nullDate.\n\nThe code in my patch can be shortened by not using IsNormalOrder (which I introduced to keep the calculation itself clear). I don\u0027t think using Floor instead of (int)/ and % will result in shorter, understandable code. Knowing that there is a partial week between start date and end date is not enough; we need to establish if the partial week contains a week border crossing.\n\nAs I am not entirely happy with the patch because my code is longer than the original code, I will try if I can preserve the understandable property whilst reducing the lines by not using IsNormalOrder.",
      "parentUuid": "51b44253_289d952b",
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0fa692d8_958d2b61",
        "filename": "scaddins/source/datefunc/datefunc.cxx",
        "patchSetId": 1
      },
      "lineNbr": 475,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2021-11-19T15:05:15Z",
      "side": 1,
      "message": "\u003e For me (int)/ and % and Floor are roughly equivalent, my preference goes to understandable code\n\nI definitely agree with your preference; and (int)/ and % require also use of checking \"if negative\" condition, which IMO is much worse for both understandable code, and for code duplication (with small changes in the two branches).\n\n\u003e the documentation referred to by me in earlier comments states \u0027If Type is 1, WEEKS calculates the Monday-to-Sunday week that StartDate and EndDate each lie in, and returns the difference between those week numbers.\u0027. Therefore we need to know the dow for start date and end date. And therefore it is essential to use nullDate\n\nNo, it is *not* essential to use nullDate. Because the only thing that matters is in which week (number) counted from *any* possible week a specific date belongs. And if one date (2021-11-19) belongs to week 1234567 *starting from some randomly chosen Monday*, and another date (2021-11-22) belongs to week 1234568 *starting from the same Monday*, then subtracting 1234567 from 1234568 will give you the correct \u00271\u0027. The important thing here is that we count weeks from some *Monday* - which ISO demands, and which is therefore what function spec requires. Or you may take this week as a starting point (\"week 0\"), and then 2021-11-22 would correspond to week 1, and 2021-11-14would be in week -1. Subtracting -1 from 1 will give you the correct 2.\n\nWe only need a method to *correctly* calculate week numbers for a given day. And look: the date that is used in the function uses serial date \u00270\u0027 for 0001-01-01! This is *very* convenient, since as I mentioned above, 0001-01-01 was Monday! It means that if you divide any serial date in that function by 7 (rounding towards negative infinity, i.e. using floor), you get the correct week number relative to the week of 0001-01-01.",
      "parentUuid": "e9d0012e_8be941c9",
      "revId": "f3a2f261ca4cb99843e455517250f2a11c534c28",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    }
  ]
}