{
  "comments": [
    {
      "key": {
        "uuid": "3ffdc1bc_2f339910",
        "filename": "starmath/source/parse.cxx",
        "patchSetId": 3
      },
      "lineNbr": 1308,
      "author": {
        "id": 1002652
      },
      "writtenOn": "2021-02-06T09:03:55Z",
      "side": 1,
      "message": "The DepthProtect class:\nhttps://opengrok.libreoffice.org/xref/core/starmath/inc/parse.hxx?r\u003de3ea88c6#63\n\nIt increases the depth by one on creation and decreases by one in destruction.\nIt is called in the beginning of DoSomething (DoSum).\nOther subnodes are loaded by DoSomethingElse also cal it ( DoOpSubSup, DoProduct -).\n\nI\u0027ve found similar code in DoRelation, which I also believe to be wrong.\nI can\u0027t find the ofz in bugzilla, I\u0027d like to know the bug description, so I know what are you triying to correct.",
      "revId": "33664fc0ed46aaf80077e6a544c8c933d3cfaa9d",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ebb24e2_6e856c1f",
        "filename": "starmath/source/parse.cxx",
        "patchSetId": 3
      },
      "lineNbr": 1308,
      "author": {
        "id": 1000135
      },
      "writtenOn": "2021-02-06T10:19:07Z",
      "side": 1,
      "message": "ofz is oss-fuzz, i.e. https://github.com/google/oss-fuzz\nthe bugtracker for ofz is e.g. https://bugs.chromium.org/p/oss-fuzz\nthough this particular issue is private until a number of weeks after it it resolved: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id\u003d30330 The earlier one of https://bugs.chromium.org/p/oss-fuzz/issues/detail?id\u003d27892 is now public with testcase https://oss-fuzz.com/download?testcase_id\u003d6309633836449792 and is equivalent to this one.\n\nThe depthguard obviously increments/decrements in ctor/dtor of DepthProtect, but in the while loop m_nParseDepth will be the same on exiting DoWhatEver as on entering DoWhatEver, but the depth of the tree created increases on each loop so the eventual recursive delete of the tree will require more stack than the OS can provide. A reduction of stack size via ulimit -s 4096 or ulimit -s 2048 may be required to reproduce on a standard build.",
      "parentUuid": "3ffdc1bc_2f339910",
      "revId": "33664fc0ed46aaf80077e6a544c8c933d3cfaa9d",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "23bd04a5_8ff5b6fe",
        "filename": "starmath/source/parse.cxx",
        "patchSetId": 3
      },
      "lineNbr": 1308,
      "author": {
        "id": 1002652
      },
      "writtenOn": "2021-02-06T10:48:41Z",
      "side": 1,
      "message": "So the problem is we can accumulate more than 1024 subnodes in one row and freeing them causes the crash (what I understand).\n#define DEPTH_LIMIT 1024\n\nIn that case, that depthguard you are using is for the depth parent child relations can reach in one single tree branch.\n\nIt would be needed a second independent depthguard to check out the number of subnodes you are generating.\n\nThe implementation you have will work, but will greatly limit the formula complexity.",
      "parentUuid": "3ebb24e2_6e856c1f",
      "revId": "33664fc0ed46aaf80077e6a544c8c933d3cfaa9d",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d9adb32a_02af906b",
        "filename": "starmath/source/parse.cxx",
        "patchSetId": 3
      },
      "lineNbr": 1308,
      "author": {
        "id": 1002652
      },
      "writtenOn": "2021-02-08T14:26:10Z",
      "side": 1,
      "message": "Sorry, I mixed my pencils, I was wrong.",
      "parentUuid": "23bd04a5_8ff5b6fe",
      "revId": "33664fc0ed46aaf80077e6a544c8c933d3cfaa9d",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a2e5d243_ee25e86b",
        "filename": "starmath/source/parse.cxx",
        "patchSetId": 3
      },
      "lineNbr": 1309,
      "author": {
        "id": 1002652
      },
      "writtenOn": "2021-02-08T14:26:10Z",
      "side": 1,
      "message": "However, there was a change in syntax.\nNow it would be :\nDepthProtect bDepthGuard(m_nParseDepth);\nAfter rebasing in master branch.",
      "revId": "33664fc0ed46aaf80077e6a544c8c933d3cfaa9d",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "23728595_03f98bd7",
        "filename": "starmath/source/parse.cxx",
        "patchSetId": 3
      },
      "lineNbr": 1309,
      "author": {
        "id": 1002652
      },
      "writtenOn": "2021-02-08T18:07:02Z",
      "side": 1,
      "message": "It\u0027s up do date now.",
      "parentUuid": "a2e5d243_ee25e86b",
      "revId": "33664fc0ed46aaf80077e6a544c8c933d3cfaa9d",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    }
  ]
}