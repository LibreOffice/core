{
  "comments": [
    {
      "key": {
        "uuid": "3fa0c359_496ff991",
        "filename": "vcl/qt5/Qt5Clipboard.cxx",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1001976
      },
      "writtenOn": "2019-06-03T13:31:13Z",
      "side": 1,
      "message": "I see a potential problem with this constructor.\n\nLet\u0027s assume you have QMimeData instance with some data, and you make Qt5MimeData out of it using this constructor. Let\u0027s call it \u0027Qt5MimeData_Instance1\u0027. Since it has instance of QMimeData as argument, it\u0027ll go to the branch \u0027else\u0027. Everything looks fine till this point. But \u0027m_aContents.is()\u0027 for Qt5MimeData_Instance1 should be \u0027false\u0027.\n\nBut now one more instance of Qt5MimeData is constructed, let\u0027s call it \u0027Qt5MimeData_Instance2\u0027, and it takes \u0027Qt5MimeData_Instance1\u0027 as argument, casted to \u0027const QMimeData\u0026\u0027 type. It took me an explicit cast when I tried a small test program with class inheriting QMimeData. Since it\u0027s an instance of \u0027Qt5MimeData\u0027 class, it\u0027ll take \u0027if\u0027 branch, and copy m_aContents. But it is empty, and \u0027Qt5MimeData_Instance2\u0027 should have actually copied data of underlying QMimeData instance from \u0027Qt5MimeData_Instance1\u0027. But instead it has empty \u0027m_aContents\u0027 and no data in QMimeData members. It means it\u0027ll produce an empty instance instead of copy in such case.\n\nQMimeData, AFAIK, isn\u0027t copyable, maybe this class shouldn\u0027t be copy-constructible as well? Otherwise, it might be worth to change condition \u0027if (pQt5MimeData)\u0027 to \u0027if (pQt5MimeData \u0026\u0026 pQt5MimeData-\u003em_aContents.is())\u0027: if m_aContents is empty for instance of Qt5MimeData (i.e. it was constructed using QMimeData), try using underlying QMimeData as well.",
      "revId": "ed46fa08c3dbe1b0357c6e82d53c8788386ded10",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3fa0c359_89b501d0",
        "filename": "vcl/qt5/Qt5Clipboard.cxx",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1000562
      },
      "writtenOn": "2019-06-03T15:20:33Z",
      "side": 1,
      "message": "The code has now moved into the deepCopy function. See my other comment. Thanks for catching that. The patch is really WIP.",
      "parentUuid": "3fa0c359_496ff991",
      "revId": "ed46fa08c3dbe1b0357c6e82d53c8788386ded10",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3fa0c359_29cced68",
        "filename": "vcl/qt5/Qt5Clipboard.cxx",
        "patchSetId": 3
      },
      "lineNbr": 63,
      "author": {
        "id": 1000562
      },
      "writtenOn": "2019-06-03T15:20:33Z",
      "side": 1,
      "message": "@aleksei - yup, the pQt5MimeData check is wrong and produced the empty data. That was left from one of my many tries to come up with a usable solution in the class layout.",
      "range": {
        "startLine": 63,
        "startChar": 17,
        "endLine": 63,
        "endChar": 29
      },
      "revId": "ed46fa08c3dbe1b0357c6e82d53c8788386ded10",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3fa0c359_892501ae",
        "filename": "vcl/qt5/Qt5Clipboard.cxx",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1000789
      },
      "writtenOn": "2019-06-03T10:40:18Z",
      "side": 1,
      "message": "can use range-based for here, or even\n\u0027return std::any_of(...)\u0027",
      "range": {
        "startLine": 125,
        "startChar": 0,
        "endLine": 131,
        "endChar": 17
      },
      "revId": "ed46fa08c3dbe1b0357c6e82d53c8788386ded10",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3fa0c359_49c7f946",
        "filename": "vcl/qt5/Qt5Clipboard.cxx",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1000562
      },
      "writtenOn": "2019-06-03T15:20:33Z",
      "side": 1,
      "message": "Learned something new - just knew std::find_if yet.\nDone.",
      "parentUuid": "3fa0c359_892501ae",
      "range": {
        "startLine": 125,
        "startChar": 0,
        "endLine": 131,
        "endChar": 17
      },
      "revId": "ed46fa08c3dbe1b0357c6e82d53c8788386ded10",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3fa0c359_6922f5a6",
        "filename": "vcl/qt5/Qt5Clipboard.cxx",
        "patchSetId": 3
      },
      "lineNbr": 145,
      "author": {
        "id": 1000789
      },
      "writtenOn": "2019-06-03T10:40:18Z",
      "side": 1,
      "message": "can use range-based for here",
      "range": {
        "startLine": 143,
        "startChar": 0,
        "endLine": 145,
        "endChar": 67
      },
      "revId": "ed46fa08c3dbe1b0357c6e82d53c8788386ded10",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3fa0c359_e9c5a53d",
        "filename": "vcl/qt5/Qt5Clipboard.cxx",
        "patchSetId": 3
      },
      "lineNbr": 145,
      "author": {
        "id": 1000562
      },
      "writtenOn": "2019-06-03T15:20:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3fa0c359_6922f5a6",
      "range": {
        "startLine": 143,
        "startChar": 0,
        "endLine": 145,
        "endChar": 67
      },
      "revId": "ed46fa08c3dbe1b0357c6e82d53c8788386ded10",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    }
  ]
}