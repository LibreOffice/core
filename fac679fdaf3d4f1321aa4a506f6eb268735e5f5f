{
  "comments": [
    {
      "key": {
        "uuid": "9a30ddce_b3b5c3d1",
        "filename": "sdext/source/pdfimport/wrapper/wrapper.cxx",
        "patchSetId": 6
      },
      "lineNbr": 1124,
      "author": {
        "id": 1000068
      },
      "writtenOn": "2018-03-21T10:17:29Z",
      "side": 1,
      "message": "Thank you for the updates!\n\nUnfortunately this [and the code that leads to this] is not what I want ;-)  Instead, I want to use the Graphics here, with its setPdfData, which takes care of the roundtrip etc. - especially I don\u0027t want us to generate the PNGs (that are in the end backed by a Graphics anyway - if I\u0027m not mistaken).\n\nCan you please extend the setPdfData in a way that it actually uses a shared stream, and probably also about the page to render?  Miklos - do you have a code pointer or two, please? :-)\n\nWhen we go the \u0027Graphics\u0027 way, it will nicely align with the Tomaz\u0027s new caching rework I hope.",
      "range": {
        "startLine": 1123,
        "startChar": 8,
        "endLine": 1124,
        "endChar": 71
      },
      "revId": "fac679fdaf3d4f1321aa4a506f6eb268735e5f5f",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a30ddce_f3af3b7b",
        "filename": "sdext/source/pdfimport/wrapper/wrapper.cxx",
        "patchSetId": 6
      },
      "lineNbr": 1124,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-03-21T10:38:05Z",
      "side": 1,
      "message": "vcl::ImportPDF() in vcl/source/filter/ipdf/pdfread.cxx:233 currently takes a uno::Sequence\u003csal_Int8\u003e, that\u0027s the native PDF data. You could change that to a std::shared_ptr\u003cuno::Sequence\u003csal_Int8\u003e\u003e, that way in case we import multiple pages from the same pdf, in fact we only store the PDF file only once.\n\nThe idea is that we always work with a Graphic (which can contain a metafile or a bitmap -- in the pdfium case currently it contains a bitmap), and that has the original PDF as metadata; so later during the PDF export it is possible to write the original (vector) PDF, not the bitmap. I hope that\u0027s enough info to get you started.",
      "parentUuid": "9a30ddce_b3b5c3d1",
      "revId": "fac679fdaf3d4f1321aa4a506f6eb268735e5f5f",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a30ddce_e6dcdb48",
        "filename": "sdext/source/pdfimport/wrapper/wrapper.cxx",
        "patchSetId": 6
      },
      "lineNbr": 1124,
      "author": {
        "id": 1000871
      },
      "writtenOn": "2018-03-21T22:24:14Z",
      "side": 1,
      "message": "Thanks for the feedback.\n\nThe above patch actually does save the PDF exactly like the Graphic with setPdfData.\n\nFor sharing, the patch is already done: https://gerrit.libreoffice.org/#/c/51619/",
      "parentUuid": "9a30ddce_f3af3b7b",
      "revId": "fac679fdaf3d4f1321aa4a506f6eb268735e5f5f",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a30ddce_c6d7d721",
        "filename": "sdext/source/pdfimport/wrapper/wrapper.cxx",
        "patchSetId": 6
      },
      "lineNbr": 1124,
      "author": {
        "id": 1000871
      },
      "writtenOn": "2018-03-21T22:24:14Z",
      "side": 1,
      "message": "Thanks for the feedback. \n\nhttps://gerrit.libreoffice.org/#/c/51619/ does the sharing. That\u0027s already done.\n\nMaybe I\u0027m missing something but my tests show that the above code does survive round-trips. Saving an imported PDF document gives the same result as using a blank document and the Insert \u003e Image function.\n\nInternally the PNGs are converted to Graphic, although probably the PDF is not set (which we should do).\n\nThe other approach is to call the Insert function while loading, but that will not create the correct page size as we do here. Also I feared it would be problematic since during loading I\u0027m not sure we have everything that the Insert function expects (I should check that).",
      "parentUuid": "9a30ddce_b3b5c3d1",
      "range": {
        "startLine": 1123,
        "startChar": 8,
        "endLine": 1124,
        "endChar": 71
      },
      "revId": "fac679fdaf3d4f1321aa4a506f6eb268735e5f5f",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    }
  ]
}