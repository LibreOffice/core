{
  "comments": [
    {
      "key": {
        "uuid": "7c147eb2_73b5d2cc",
        "filename": "vcl/jsdialog/jsdialogbuilder.cxx",
        "patchSetId": 1
      },
      "lineNbr": 774,
      "author": {
        "id": 1000664
      },
      "writtenOn": "2021-03-04T08:49:31Z",
      "side": 1,
      "message": "Can you check if \u0027x\u0027 button works? (dialog will disappear, but check if you will receive \u0027close\u0027 message).\n\nI think: \"RememberWidget(\"__DIALOG__\", aJSMessageDialog.get());\" is needed here\n__DIALOG__ id is used for handling standard buttons (without explicit handlers) and \u0027x\u0027 button.\n\nmaybe it will even be not needed to add these handlers below with that line added. worth checking too.",
      "revId": "b86d881540a7574f8eb0ebe80a12e52159e43fc1",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9bd0ef22_4a3565aa",
        "filename": "vcl/jsdialog/jsdialogbuilder.cxx",
        "patchSetId": 1
      },
      "lineNbr": 774,
      "author": {
        "id": 1000865
      },
      "writtenOn": "2021-03-08T12:38:50Z",
      "side": 1,
      "message": "After creating RememberWidget1 defined static, wit some tweaks\n\nIt crashes:\n\ndistro/collabora/cp-6.4/instdir/program/libvcllo.so(_ZN6Dialog6ResizeEv+0x53)[0x7fd13cd3\n6a1f]                                                                                                                       \ndistro/collabora/cp-6.4/instdir/program/libsofficeapp.so(+0xfcf45)[0x7fd1442e4f45]      \ndistro/collabora/cp-6.4/instdir/program/libsofficeapp.so(+0xfd334)[0x7fd1442e5334]      \ndistro/collabora/co-6-4/loolforkit(_ZN3lok8Document15sendDialogEventEyPKc+0x39)[0x559cd0c7cca\n1]\n\nSorry, It does not work",
      "parentUuid": "7c147eb2_73b5d2cc",
      "revId": "b86d881540a7574f8eb0ebe80a12e52159e43fc1",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2062a9be_13b9b2ce",
        "filename": "vcl/jsdialog/jsdialogbuilder.cxx",
        "patchSetId": 1
      },
      "lineNbr": 774,
      "author": {
        "id": 1000664
      },
      "writtenOn": "2021-03-08T14:54:31Z",
      "side": 1,
      "message": "ah it hits the \"mobile sidebar\" code path with Resize call... that means it didn\u0027t found the welded window id or widget \u0027__DIALOG__\u0027 inside map. are you sure message dialog was successfully added to the map under id \u0027__DIALOG__\u0027?\n\nor can you paste how the arguments passed to sendDialogEvent were look?",
      "parentUuid": "9bd0ef22_4a3565aa",
      "revId": "b86d881540a7574f8eb0ebe80a12e52159e43fc1",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e570ee7e_d2824cff",
        "filename": "vcl/jsdialog/jsdialogbuilder.cxx",
        "patchSetId": 1
      },
      "lineNbr": 774,
      "author": {
        "id": 1000865
      },
      "writtenOn": "2021-03-08T21:07:26Z",
      "side": 1,
      "message": "Here you have my changes, maybe did I miss something?\n\n+void JSInstanceBuilder::RememberWidget1(sal_uInt64 nWindowId, const OString\u0026 id, weld::Widget* pWidget)                    \n+{                                                                                                                          \n+    auto it \u003d GetLOKWeldWidgetsMap().find(nWindowId);                                                                      \n+    if (it !\u003d GetLOKWeldWidgetsMap().end())                                                                                \n+    {                                                                                                                      \n+        it-\u003esecond.erase(id);                                                                                              \n+        it-\u003esecond.insert(WidgetMap::value_type(id, pWidget));                                                             \n+    }                                                                                                                      \n+}   \n\n+                                                                                                                   [15/741]\n void JSInstanceBuilder::AddChildWidget(sal_uInt64 nWindowId, const OString\u0026 id, weld::Widget* pWidget)                     \n {                                                                                                                          \n     auto it \u003d GetLOKWeldWidgetsMap().find(nWindowId);                                                                      \n@@ -812,6 +822,7 @@ weld::MessageDialog* JSInstanceBuilder::CreateMessageDialog(weld::Widget* pParen                        \n                                                             VclButtonsType eButtonType,                                    \n                                                             const OUString\u0026 rPrimaryMessage)                               \n {                                                                                                                          \n+    weld::MessageDialog* pRet;                                                                                             \n     SalInstanceWidget* pParentInstance \u003d dynamic_cast\u003cSalInstanceWidget*\u003e(pParent);                                        \n     SystemWindow* pParentWidget \u003d pParentInstance ? pParentInstance-\u003egetSystemWindow() : nullptr;                          \n     VclPtrInstance\u003c::MessageDialog\u003e xMessageDialog(pParentWidget, rPrimaryMessage, eMessageType,                           \n@@ -831,7 +842,12 @@ weld::MessageDialog* JSInstanceBuilder::CreateMessageDialog(weld::Widget* pParen\n\n     xMessageDialog-\u003eSetLOKTunnelingState(false);\n     InsertWindowToMap(xMessageDialog-\u003eGetLOKWindowId());\n-    return new JSMessageDialog(xMessageDialog, nullptr, true);\n+\n+    pRet \u003d new JSMessageDialog(xMessageDialog, nullptr, true);\n+    if (pRet)\n+        RememberWidget1(xMessageDialog-\u003eGetLOKWindowId(), \"__DIALOG__\", pRet);\n+\n+    return pRet;\n }",
      "parentUuid": "2062a9be_13b9b2ce",
      "revId": "b86d881540a7574f8eb0ebe80a12e52159e43fc1",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615",
      "unresolved": false
    }
  ]
}