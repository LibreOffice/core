{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ce8657a0_2055f647",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000135
      },
      "writtenOn": "2021-09-28T08:50:33Z",
      "side": 1,
      "message": "Got a deadlock with this on loading https://bugs.documentfoundation.org/attachment.cgi?id\u003d175049 and then trying to exit. \n\nSfxGlobalEvents_Impl::dispose()\nsfx2/source/notify/globalevents.cxx:249\nstd::unique_lock g(m_aLock);\n\nand dispose eventually calls\n\nSfxGlobalEvents_Impl::implts_notifyJobExecution\nsfx2/source/notify/globalevents.cxx:425\nstd::scoped_lock g(m_aLock);\n\nThe full backtrace is...\n\n#0  0x00007ffff7a508e0 in __lll_lock_wait () at /lib64/libc.so.6\n#1  0x00007ffff7a56f02 in pthread_mutex_lock@@GLIBC_2.2.5 () at /lib64/libc.so.6\n#2  0x00007ffff464f813 in __gthread_mutex_lock(pthread_mutex_t*) (__mutex\u003d0x1fe75c8)\n    at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/x86_64-redhat-linux/bits/gthr-default.h:749\n#3  0x00007ffff4658e85 in std::mutex::lock() (this\u003d0x1fe75c8) at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/bits/std_mutex.h:100\n#4  0x00007ffff4650e13 in std::scoped_lock\u003cstd::mutex\u003e::scoped_lock(std::mutex\u0026) (this\u003d0x7fffffffcd48, __m\u003d...)\n    at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/mutex:655\n#5  0x00007ffff4a776af in (anonymous namespace)::SfxGlobalEvents_Impl::implts_notifyJobExecution(com::sun::star::document::EventObject const\u0026) (this\u003d0x1fe7560, aEvent\u003d...)\n    at sfx2/source/notify/globalevents.cxx:425\n\n2nd std::scoped_lock g(m_aLock) here\n\n#6  0x00007ffff4a7532a in (anonymous namespace)::SfxGlobalEvents_Impl::documentEventOccured(com::sun::star::document::DocumentEvent const\u0026) (this\u003d0x1fe7560, Event\u003d...)\n    at sfx2/source/notify/globalevents.cxx:224\n#7  0x00007fff4c39deae in comphelper::OInterfaceContainerHelper2::NotifySingleListener\u003ccom::sun::star::document::XDocumentEventListener, com::sun::star::document::DocumentEvent\u003e::operator()(com::sun::star::uno::Reference\u003ccom::sun::star::document::XDocumentEventListener\u003e const\u0026) const\n    (this\u003d0x7fffffffced0, listener\u003duno::Reference to ((anonymous namespace)::SfxGlobalEvents_Impl *) 0x1fe75a8) at include/comphelper/interfacecontainer2.hxx:259\n#8  0x00007fff4c39dc79 in comphelper::OInterfaceContainerHelper2::forEach\u003ccom::sun::star::document::XDocumentEventListener, comphelper::OInterfaceContainerHelper2::NotifySingleListener\u003ccom::sun::star::document::XDocumentEventListener, com::sun::star::document::DocumentEvent\u003e \u003e(comphelper::OInterfaceContainerHelper2::NotifySingleListener\u003ccom::sun::star::document::XDocumentEventListener, com::sun::star::document::DocumentEvent\u003e const\u0026) (this\u003d0x8c5ba10, func\u003d...) at include/comphelper/interfacecontainer2.hxx:272\n#9  0x00007fff4c39cd83 in comphelper::OInterfaceContainerHelper2::notifyEach\u003ccom::sun::star::document::XDocumentEventListener, com::sun::star::document::DocumentEvent\u003e(void (com::sun::star::document::XDocumentEventListener::*)(com::sun::star::document::DocumentEvent const\u0026), com::sun::star::document::DocumentEvent const\u0026) (this\u003d0x8c5ba10, NotificationMethod\u003d\n    \u0026virtual table offset 32, Event\u003d...) at include/comphelper/interfacecontainer2.hxx:285\n#10 0x00007fff4c39c3d0 in dbaccess::DocumentEventNotifier_Impl::impl_notifyEvent_nothrow(com::sun::star::document::DocumentEvent const\u0026) (this\u003d0x8c5b9c0, _rEvent\u003d...)\n    at dbaccess/source/core/dataaccess/documenteventnotifier.cxx:200\n#11 0x00007fff4c39d22c in dbaccess::DocumentEventNotifier_Impl::notifyDocumentEvent(rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::frame::XController2\u003e const\u0026, com::sun::star::uno::Any const\u0026) (this\u003d0x8c5b9c0, EventName\u003d\"OnUnload\", ViewController\u003dempty uno::Reference, Supplement\u003duno::Any(void)) at dbaccess/source/core/dataaccess/documenteventnotifier.cxx:101\n#12 0x00007fff4c39c945 in dbaccess::DocumentEventNotifier::notifyDocumentEvent(rtl::OUString const\u0026, com::sun::star::uno::Reference\u003ccom::sun::star::frame::XController2\u003e const\u0026, com::sun::star::uno::Any const\u0026) (this\u003d0x10d13d80, EventName\u003d\"OnUnload\", ViewController\u003dempty uno::Reference, Supplement\u003duno::Any(void)) at dbaccess/source/core/dataaccess/documenteventnotifier.cxx:279\n#13 0x00007fff4c31db33 in dbaccess::DocumentEventNotifier::notifyDocumentEvent(char const*, com::sun::star::uno::Reference\u003ccom::sun::star::frame::XController2\u003e const\u0026, com::sun::star::uno::Any const\u0026) (this\u003d0x10d13d80, _pAsciiEventName\u003d0x7fff4c48899d \"OnUnload\", _rxViewController\u003dempty uno::Reference, _rSupplement\u003duno::Any(void))\n    at dbaccess/source/core/dataaccess/documenteventnotifier.hxx:103\n#14 0x00007fff4c317c59 in dbaccess::ODatabaseDocument::disposing() (this\u003d0x10d13c00) at dbaccess/source/core/dataaccess/databasedocument.cxx:1787\n#15 0x00007ffff64185ed in cppu::WeakComponentImplHelperBase::dispose() (this\u003d0x10d13c18) at cppuhelper/source/implbase.cxx:104\n#16 0x00007fff4c318239 in dbaccess::ODatabaseDocument::dispose() (this\u003d0x10d13c00) at dbaccess/source/core/dataaccess/databasedocument.cxx:1862\n#17 0x00007ffff641825f in cppu::WeakComponentImplHelperBase::release() (this\u003d0x10d13c18) at cppuhelper/source/implbase.cxx:79\n#18 0x00007fff4c31d0b5 in cppu::PartialWeakComponentImplHelper\u003ccom::sun::star::frame::XModel2, com::sun::star::util::XModifiable, com::sun::star::frame::XStorable, com::sun::star::document::XEventBroadcaster, com::sun::star::document::XDocumentEventBroadcaster, com::sun::star::view::XPrintable, com::sun::star::util::XCloseable, com::sun::star::lang::XServiceInfo, com::sun::star::sdb::XOfficeDatabaseDocument, com::sun::star::ui::XUIConfigurationManagerSupplier, com::sun::star::document::XStorageBasedDocument, com::sun::star::document::XEmbeddedScripts, com::sun::star::document::XScriptInvocationContext, com::sun::star::script::provider::XScriptProviderSupplier, com::sun::star::document::XEventsSupplier, com::sun::star::frame::XLoadable, com::sun::star::document::XDocumentRecovery\u003e::release() (this\u003d0x10d13c18) at include/cppuhelper/compbase.hxx:86\n#19 0x00007fff4c30a339 in dbaccess::ODatabaseDocument::release() (this\u003d0x10d13c00) at dbaccess/source/core/dataaccess/databasedocument.cxx:211\n#20 0x00007ffff44328ae in com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e::~Reference() (this\u003d0x76fc4b0) at include/com/sun/star/uno/Reference.hxx:114\n#21 0x00007ffff4a7a4b5 in std::_Destroy\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e \u003e(com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*) (__pointer\u003d0x76fc4b0)\n    at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/bits/stl_construct.h:140\n#22 0x00007ffff4a7a47f in std::_Destroy_aux\u003cfalse\u003e::__destroy\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*\u003e(com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*, com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*) (__first\u003d0x76fc4b0, __last\u003d0x76fc4b8)\n    at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/bits/stl_construct.h:152\n#23 0x00007ffff4a7a43d in std::_Destroy\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*\u003e(com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*, com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*) (__first\u003d0x76fc4b0, __last\u003d0x76fc4b8) at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/bits/stl_construct.h:184\n#24 0x00007ffff4a7a3a1 in std::_Destroy\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*, com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e \u003e(com::sun::star::uno::Refe\nrence\u003ccom::sun::star::frame::XModel\u003e*, com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e \u003e\u0026)\n    (__first\u003d0x76fc4b0, __last\u003d0x76fc4b8) at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/bits/alloc_traits.h:746\n#25 0x00007ffff4a8e7df in std::__cxx1998::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e \u003e \u003e::_M_erase_at_end(com::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e*) (this\u003d0x1fe7670, __pos\u003d0x76fc4b0)\n    at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/bits/stl_vector.h:1796\n#26 0x00007ffff4a8e778 in std::__cxx1998::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e \u003e \u003e::clear() (this\u003d0x1fe7670) at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/bits/stl_vector.h:1499\n#27 0x00007ffff4a8d8cd in std::__debug::vector\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e, std::allocator\u003ccom::sun::star::uno::Reference\u003ccom::sun::star::frame::XModel\u003e \u003e \u003e::clear() (this\u003d0x1fe7658) at /usr/bin/../lib/gcc/x86_64-redhat-linux/11/../../../../include/c++/11/debug/vector:720\n#28 0x00007ffff4a769d9 in (anonymous namespace)::SfxGlobalEvents_Impl::dispose() (this\u003d0x1fe7560) at sfx2/source/notify/globalevents.cxx:249\n\n1st std::scoped_lock g(m_aLock) here\n\n#29 0x00007ffff63e39a9 in cppu::(anonymous namespace)::ComponentContext::disposing() (this\u003d0x536530) at cppuhelper/source/component_context.cxx:430\n#30 0x00007ffff64185ed in cppu::WeakComponentImplHelperBase::dispose() (this\u003d0x536530) at cppuhelper/source/implbase.cxx:104\n#31 0x00007ffff63ed805 in cppu::PartialWeakComponentImplHelper\u003ccom::sun::star::uno::XComponentContext, com::sun::star::container::XNameContainer\u003e::dispose() (this\u003d0x536530)\n    at include/cppuhelper/compbase.hxx:90\n#32 0x00007ffff7c411f5 in desktop::Desktop::DeInit() (this\u003d0x7fffffffe218) at desktop/source/app/app.cxx:550\n#33 0x00007fffefda2688 in DeInitVCL() () at vcl/source/app/svmain.cxx:525\n#34 0x00007fffefda1290 in ImplSVMain() () at vcl/source/app/svmain.cxx:224\n#35 0x00007fffefda2d19 in SVMain() () at vcl/source/app/svmain.cxx:231\n#36 0x00007ffff7cc14ed in soffice_main() () at desktop/source/app/sofficemain.cxx:98\n#37 0x00000000004008fd in sal_main () at desktop/source/app/main.c:49\n#38 0x00000000004008d7 in main (argc\u003d2, argv\u003d0x7fffffffe448) at desktop/source/app/main.c:47",
      "revId": "8122c82d90117fc0c4c8ea87aa7f771d5e92bf36",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    }
  ]
}