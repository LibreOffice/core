{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3a91ed52_1e116339",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2021-09-16T06:18:43Z",
      "side": 1,
      "message": "Mike: could you please review this? This fixes the remaining problems found by https://github.com/CollaboraOnline/online/issues/3218. No testcase, the double-delete happened with 5 different views, and I couldn\u0027t reproduce it on the desktop with just 2 views, so I would just assume that loolstress will break again if this would go wrong in the future. Thanks.",
      "revId": "e2548131212e9cff6e83700071a24fe89434633c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac7a032b_8d4fd5dd",
        "filename": "svx/source/svdraw/svdedxv.cxx",
        "patchSetId": 1
      },
      "lineNbr": 2765,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2021-09-17T14:36:56Z",
      "side": 1,
      "message": "Can\u0027t this leak own-created manager? SetUndoManager doesn\u0027t call a delete on it.",
      "revId": "e2548131212e9cff6e83700071a24fe89434633c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e40e5536_47f4d292",
        "filename": "svx/source/svdraw/svdedxv.cxx",
        "patchSetId": 1
      },
      "lineNbr": 2765,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2021-09-17T14:53:10Z",
      "side": 1,
      "message": "My understanding is when an active text edit is ended, the editeng undo manager is deleted in SdrObjEditView::SdrEndTextEdit(). So at this point the undo manager is either nullptr already, or it has a non-owning pointer to the Writer one.\n\nOr did I miss something?",
      "parentUuid": "ac7a032b_8d4fd5dd",
      "revId": "e2548131212e9cff6e83700071a24fe89434633c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1887f829_518bf424",
        "filename": "svx/source/svdraw/svdedxv.cxx",
        "patchSetId": 1
      },
      "lineNbr": 2765,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2021-09-17T15:13:32Z",
      "side": 1,
      "message": "First of all, I am sure that you understand the dynamics of those undo managers better than I. I only look at the code for the first time ðŸ˜Š\n\nMy perception is that in SdrObjEditView::SdrEndTextEdit, some previous undo manager is installed into the outliner. I do not see which exactly that previous undo manager might be; but I suppose that the manager obtained from that SetUndoManager call can\u0027t be the manager created by outliner itself: SdrObjEditView::SdrBeginTextEdit installed the manager from getSdrUndoManagerForEnhancedTextEdit.\n\nSo *if* the previous manager could only be the already destroyed undo manager, that\u0027s OK. But I don\u0027t know where that pGivenOutliner in SdrObjEditView::SdrBeginTextEdit comes from, thus I only assumed that the previous manager could be an own one.\n\nGenerally it seems to me that a shared_ptr could be useful here...",
      "parentUuid": "e40e5536_47f4d292",
      "revId": "e2548131212e9cff6e83700071a24fe89434633c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "168b89c0_c7d527a9",
        "filename": "svx/source/svdraw/svdedxv.cxx",
        "patchSetId": 1
      },
      "lineNbr": 2765,
      "author": {
        "id": 1000994
      },
      "writtenOn": "2021-09-17T16:54:53Z",
      "side": 1,
      "message": "So my imagined scenario is:\n\n1. An outliner goes to the SdrObjEditView::SdrBeginTextEdit, with own undo manager.\n2. There it gets the undo manager replaced; the old manager is stored in mpOldTextEditUndoManager.\n3. For some reason, SdrObjEditView::SdrEndTextEdit didn\u0027t happen.\n5. In SwView::~SwView, SdrObjEditView::DisposeUndoManager clears the undo manager in the outliner, but does not reinstate mpOldTextEditUndoManager.\n\nmpOldTextEditUndoManager leaks. Or is it guaranteed that mpOldTextEditUndoManager is invalid at this point?",
      "parentUuid": "1887f829_518bf424",
      "revId": "e2548131212e9cff6e83700071a24fe89434633c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "df785b49_8cd296a7",
        "filename": "svx/source/svdraw/svdedxv.cxx",
        "patchSetId": 1
      },
      "lineNbr": 2765,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2021-09-20T06:26:30Z",
      "side": 1,
      "message": "That indeed can happen. I\u0027ll do a follow-up change to address this later scenario and then these can be reviewed together. Thanks!",
      "parentUuid": "168b89c0_c7d527a9",
      "revId": "e2548131212e9cff6e83700071a24fe89434633c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4c4db99a_53ca45f0",
        "filename": "svx/source/svdraw/svdedxv.cxx",
        "patchSetId": 1
      },
      "lineNbr": 2765,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2021-09-20T07:18:20Z",
      "side": 1,
      "message": "I have a local patch to do this, will test it once Lubos fixes loolstress to work again, so I have a working baseline. :-)",
      "parentUuid": "df785b49_8cd296a7",
      "revId": "e2548131212e9cff6e83700071a24fe89434633c",
      "serverId": "6622c302-437a-49ad-a91d-55ba7dcf1615"
    }
  ]
}