#!/bin/bash

#
# This file is part of the LibreOffice project.
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
#

# This script extracts the list of operators from unicode.xml, with a boolean
# indicating whether at least one form (prefix, infix, postfix) is stretchy.

# Download unicode.xml if it does not exist yet.
if [ ! -f unicode.xml ]; then
  wget http://www.w3.org/2003/entities/2007xml/unicode.xml -O unicode.xml
fi

# Extract the list of operators.
# "grep -v '-'" excludes multichar entries (e.g. "||").
# "uniq" excludes duplicate lines (two forms with the same stretchy value)
xsltproc extractOperators.xsl unicode.xml | grep opDict | \
sed s/U0/0x/ | grep -v '-' | uniq > tmp1.txt

# Although it is rare, some entries may have at this point two stretchy values
# (false and true). We want to know if the operator has at least one stretchy
# form, so we keep only the line that sets the value to 'true'.
sed s/false/true/ tmp1.txt | uniq --repeated | \
sed s/true/false/ > tmp2.txt
diff -U1 tmp1.txt tmp2.txt | grep '\-opDict' | \
sed "s/\-//" | \
sed "1 i \/* Generated by generateOperatorDictionary.sh *\/" > \
operatorDictionary.txt

# Remove temporary files.
rm -f tmp*.txt
