--- a/a/nss/Makefile	2008-12-03 00:24:39.000000000 +0100
+++ b/b/nss/Makefile	2009-11-27 13:36:22.662753328 +0100
@@ -104,6 +104,9 @@
 ifeq ($(OS_TARGET),WIN95)
 NSPR_CONFIGURE_OPTS += --enable-win32-target=WIN95
 endif
+ifdef MACOS_SDK_DIR
+NSPR_CONFIGURE_OPTS += --with-macos-sdk=$(MACOS_SDK_DIR)
+endif
 ifdef USE_DEBUG_RTL
 NSPR_CONFIGURE_OPTS += --enable-debug-rtl
 endif
--- a/a/nspr/configure
+++ b/b/nspr/configure
@@ -3888,7 +3889,7 @@
 fi
 
     DSO_CFLAGS=-fPIC
-    DSO_LDOPTS='-dynamiclib -compatibility_version 1 -current_version 1 -all_load -install_name @executable_path/$@ -headerpad_max_install_names'
+    DSO_LDOPTS='-dynamiclib -compatibility_version 1 -current_version 1 -all_load -install_name @__________________________________________________OOO/$@ -headerpad_max_install_names'
     _OPTIMIZE_FLAGS=-O2
     MKSHLIB='$(CC) $(DSO_LDOPTS) -o $@'
     STRIP="$STRIP -x -S"
--- a/a/nspr/lib/ds/Makefile.in
+++ b/b/nspr/lib/ds/Makefile.in
@@ -143,7 +143,7 @@
 
 export:: $(TARGETS)
 	$(INSTALL) -m 444 $(HEADERS) $(dist_includedir)
-	$(INSTALL) -m 444 $(TARGETS) $(dist_libdir)
+	$(INSTALL) -m 664 $(TARGETS) $(dist_libdir)
 ifdef SHARED_LIBRARY
 ifeq ($(OS_ARCH),HP-UX)
 	$(INSTALL) -m 755 $(SHARED_LIBRARY) $(dist_libdir)
--- a/a/nspr/lib/libc/src/Makefile.in
+++ b/b/nspr/lib/libc/src/Makefile.in
@@ -144,7 +144,7 @@
 #
 
 export:: $(TARGETS)
-	$(INSTALL) -m 444 $(TARGETS) $(dist_libdir)
+	$(INSTALL) -m 664 $(TARGETS) $(dist_libdir)
 ifdef SHARED_LIBRARY
 ifeq ($(OS_ARCH),HP-UX)
 	$(INSTALL) -m 755 $(SHARED_LIBRARY) $(dist_libdir)
--- a/a/nspr/pr/src/Makefile.in
+++ b/b/nspr/pr/src/Makefile.in
@@ -365,7 +365,7 @@
 #
 
 build:: $(TARGETS)
-	$(INSTALL) -m 444 $(TARGETS) $(dist_libdir)
+	$(INSTALL) -m 664 $(TARGETS) $(dist_libdir)
 ifdef SHARED_LIBRARY
 ifeq ($(OS_ARCH),HP-UX)
 	$(INSTALL) -m 755 $(SHARED_LIBRARY) $(dist_libdir)
--- a/a/nss/coreconf/Darwin.mk
+++ b/b/nss/coreconf/Darwin.mk
@@ -150,7 +150,7 @@
 # May override this with different compatibility and current version numbers.
 DARWIN_DYLIB_VERSIONS = -compatibility_version 1 -current_version 1
 # May override this with -bundle to create a loadable module.
-DSO_LDOPTS	= -dynamiclib $(DARWIN_DYLIB_VERSIONS) -install_name @executable_path/$(notdir $@) -headerpad_max_install_names
+DSO_LDOPTS	= -dynamiclib $(DARWIN_DYLIB_VERSIONS) -install_name @__________________________________________________OOO/$(notdir $@) -headerpad_max_install_names
 
 MKSHLIB		= $(CC) $(DSO_LDOPTS) $(DARWIN_SDK_SHLIBFLAGS)
 DLL_SUFFIX	= dylib
