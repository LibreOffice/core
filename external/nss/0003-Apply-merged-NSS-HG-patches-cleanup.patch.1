From 256ba01cda276c3e2648e87cca796ab2ab96acea Mon Sep 17 00:00:00 2001
From: Jan-Marek Glogowski <glogow@fbihome.de>
Date: Tue, 5 May 2020 01:08:04 +0200
Subject: [PATCH 3/3] Apply merged NSS HG patches - cleanup

---
 nss/cmd/crmf-cgi/Makefile                     |  12 +-
 nss/cmd/crmf-cgi/config.mk                    |  16 -
 nss/cmd/crmftest/Makefile                     |  11 +-
 nss/cmd/crmftest/config.mk                    |  15 -
 nss/cmd/lib/Makefile                          |   1 -
 nss/cmd/lib/config.mk                         |  15 -
 nss/cmd/lib/manifest.mn                       |   1 +
 nss/cmd/libpkix/config.mk                     |   9 -
 nss/cmd/libpkix/perf/Makefile                 |   2 -
 nss/cmd/libpkix/perf/manifest.mn              |   1 +
 nss/cmd/libpkix/pkix/Makefile                 |   2 -
 nss/cmd/libpkix/pkix/certsel/Makefile         |   2 -
 nss/cmd/libpkix/pkix/certsel/manifest.mn      |   3 +-
 nss/cmd/libpkix/pkix/checker/Makefile         |   2 -
 nss/cmd/libpkix/pkix/checker/manifest.mn      |   3 +-
 nss/cmd/libpkix/pkix/crlsel/Makefile          |   2 -
 nss/cmd/libpkix/pkix/crlsel/manifest.mn       |   3 +-
 nss/cmd/libpkix/pkix/params/Makefile          |   2 -
 nss/cmd/libpkix/pkix/params/manifest.mn       |   3 +-
 nss/cmd/libpkix/pkix/results/Makefile         |   2 -
 nss/cmd/libpkix/pkix/results/manifest.mn      |   3 +-
 nss/cmd/libpkix/pkix/store/Makefile           |   2 -
 nss/cmd/libpkix/pkix/store/manifest.mn        |   3 +-
 nss/cmd/libpkix/pkix/top/Makefile             |   2 -
 nss/cmd/libpkix/pkix/top/manifest.mn          |   3 +-
 nss/cmd/libpkix/pkix/util/Makefile            |   2 -
 nss/cmd/libpkix/pkix/util/manifest.mn         |   3 +-
 nss/cmd/libpkix/pkix_pl/Makefile              |   2 -
 nss/cmd/libpkix/pkix_pl/module/Makefile       |   2 -
 nss/cmd/libpkix/pkix_pl/module/manifest.mn    |   3 +-
 nss/cmd/libpkix/pkix_pl/pki/Makefile          |   2 -
 nss/cmd/libpkix/pkix_pl/pki/manifest.mn       |   3 +-
 nss/cmd/libpkix/pkix_pl/system/Makefile       |   2 -
 nss/cmd/libpkix/pkix_pl/system/manifest.mn    |   4 +-
 nss/cmd/libpkix/testutil/config.mk            |   9 +-
 nss/cmd/libpkix/testutil/manifest.mn          |   1 +
 nss/coreconf/IRIX.mk                          |   3 -
 nss/coreconf/OS2.mk                           |  13 +-
 nss/coreconf/OpenUNIX.mk                      |   3 -
 nss/coreconf/README                           |  41 -
 nss/coreconf/SCO_SV3.2.mk                     |   3 -
 nss/coreconf/SunOS4.1.3_U1.mk                 |   2 +-
 nss/coreconf/SunOS5.mk                        |   3 -
 nss/coreconf/UNIX.mk                          |   4 -
 nss/coreconf/WIN32.mk                         |  15 -
 nss/coreconf/config.mk                        |  14 -
 nss/coreconf/cpdist.pl                        | 167 ----
 nss/coreconf/import.pl                        | 189 ----
 nss/coreconf/jdk.mk                           | 504 ----------
 nss/coreconf/jniregen.pl                      |  79 --
 nss/coreconf/location.mk                      |   5 +-
 nss/coreconf/mkdepend/Makefile                |  60 --
 nss/coreconf/mkdepend/cppsetup.c              | 233 -----
 nss/coreconf/mkdepend/def.h                   | 184 ----
 nss/coreconf/mkdepend/ifparser.c              | 551 -----------
 nss/coreconf/mkdepend/ifparser.h              |  83 --
 nss/coreconf/mkdepend/imakemdep.h             | 782 ----------------
 nss/coreconf/mkdepend/include.c               | 337 -------
 nss/coreconf/mkdepend/main.c                  | 870 ------------------
 nss/coreconf/mkdepend/mkdepend.man            | 382 --------
 nss/coreconf/mkdepend/parse.c                 | 693 --------------
 nss/coreconf/mkdepend/pr.c                    | 124 ---
 nss/coreconf/module.mk                        |   4 -
 nss/coreconf/outofdate.pl                     |  39 -
 nss/coreconf/release.pl                       | 112 ---
 nss/coreconf/rules.mk                         | 602 +-----------
 nss/coreconf/ruleset.mk                       | 113 +--
 nss/coreconf/source.mk                        |  34 -
 nss/coreconf/suffix.mk                        |   5 -
 nss/coreconf/version.mk                       |   4 -
 nss/cpputil/Makefile                          |   2 -
 nss/cpputil/config.mk                         |  15 -
 nss/cpputil/manifest.mn                       |   2 +
 nss/gtests/common/Makefile                    |   2 -
 nss/gtests/common/manifest.mn                 |   1 +
 nss/gtests/google_test/Makefile               |   2 -
 nss/gtests/google_test/manifest.mn            |   1 +
 nss/lib/base/Makefile                         |   8 +-
 nss/lib/base/config.mk                        |  19 -
 nss/lib/base/manifest.mn                      |   1 +
 nss/lib/certdb/Makefile                       |   2 -
 nss/lib/certdb/config.mk                      |  15 -
 nss/lib/certdb/manifest.mn                    |   1 +
 nss/lib/certhigh/Makefile                     |   2 -
 nss/lib/certhigh/config.mk                    |  15 -
 nss/lib/certhigh/manifest.mn                  |   1 +
 nss/lib/ckfw/Makefile                         |   6 +-
 nss/lib/ckfw/builtins/Makefile                |  22 +-
 nss/lib/ckfw/builtins/config.mk               |  38 -
 nss/lib/ckfw/builtins/manifest.mn             |   4 +-
 nss/lib/ckfw/builtins/testlib/Makefile        |  23 +-
 nss/lib/ckfw/builtins/testlib/config.mk       |  38 -
 nss/lib/ckfw/builtins/testlib/manifest.mn     |   1 +
 nss/lib/ckfw/capi/Makefile                    |  17 +-
 nss/lib/ckfw/capi/config.mk                   |  31 -
 nss/lib/ckfw/capi/manifest.mn                 |   4 +-
 nss/lib/ckfw/config.mk                        |  25 -
 nss/lib/ckfw/manifest.mn                      |   1 +
 nss/lib/crmf/Makefile                         |   2 -
 nss/lib/crmf/config.mk                        |  16 -
 nss/lib/crmf/manifest.mn                      |   1 +
 nss/lib/cryptohi/Makefile                     |   2 -
 nss/lib/cryptohi/config.mk                    |  15 -
 nss/lib/cryptohi/manifest.mn                  |   1 +
 nss/lib/dbm/src/config.mk                     |   6 -
 nss/lib/dbm/src/manifest.mn                   |   1 +
 nss/lib/dev/Makefile                          |  10 +-
 nss/lib/dev/config.mk                         |  19 -
 nss/lib/dev/manifest.mn                       |   1 +
 nss/lib/freebl/Makefile                       | 134 +--
 nss/lib/freebl/config.mk                      |   4 -
 nss/lib/jar/Makefile                          |  16 +-
 nss/lib/jar/config.mk                         |  26 -
 nss/lib/jar/manifest.mn                       |   1 +
 nss/lib/libpkix/Makefile                      |   2 -
 nss/lib/libpkix/config.mk                     |  16 -
 nss/lib/libpkix/include/Makefile              |   1 -
 nss/lib/libpkix/include/config.mk             |  15 -
 nss/lib/libpkix/pkix/Makefile                 |   1 -
 nss/lib/libpkix/pkix/certsel/Makefile         |   1 -
 nss/lib/libpkix/pkix/certsel/config.mk        |  15 -
 nss/lib/libpkix/pkix/certsel/manifest.mn      |   2 +-
 nss/lib/libpkix/pkix/checker/Makefile         |   1 -
 nss/lib/libpkix/pkix/checker/config.mk        |  15 -
 nss/lib/libpkix/pkix/checker/manifest.mn      |   2 +-
 nss/lib/libpkix/pkix/config.mk                |  15 -
 nss/lib/libpkix/pkix/crlsel/Makefile          |   1 -
 nss/lib/libpkix/pkix/crlsel/config.mk         |  15 -
 nss/lib/libpkix/pkix/crlsel/manifest.mn       |   2 +-
 nss/lib/libpkix/pkix/params/Makefile          |   1 -
 nss/lib/libpkix/pkix/params/config.mk         |  15 -
 nss/lib/libpkix/pkix/params/manifest.mn       |   2 +-
 nss/lib/libpkix/pkix/results/Makefile         |   1 -
 nss/lib/libpkix/pkix/results/config.mk        |  15 -
 nss/lib/libpkix/pkix/results/manifest.mn      |   2 +-
 nss/lib/libpkix/pkix/store/Makefile           |   1 -
 nss/lib/libpkix/pkix/store/config.mk          |  15 -
 nss/lib/libpkix/pkix/store/manifest.mn        |   2 +-
 nss/lib/libpkix/pkix/top/Makefile             |   1 -
 nss/lib/libpkix/pkix/top/config.mk            |  15 -
 nss/lib/libpkix/pkix/top/manifest.mn          |   2 +-
 nss/lib/libpkix/pkix/util/Makefile            |   1 -
 nss/lib/libpkix/pkix/util/config.mk           |  15 -
 nss/lib/libpkix/pkix/util/manifest.mn         |   2 +-
 nss/lib/libpkix/pkix_pl_nss/Makefile          |   1 -
 nss/lib/libpkix/pkix_pl_nss/config.mk         |  15 -
 nss/lib/libpkix/pkix_pl_nss/module/Makefile   |  21 +-
 nss/lib/libpkix/pkix_pl_nss/module/config.mk  |  35 -
 .../libpkix/pkix_pl_nss/module/manifest.mn    |   2 +-
 nss/lib/libpkix/pkix_pl_nss/pki/Makefile      |   1 -
 nss/lib/libpkix/pkix_pl_nss/pki/config.mk     |  15 -
 nss/lib/libpkix/pkix_pl_nss/pki/manifest.mn   |   2 +-
 nss/lib/libpkix/pkix_pl_nss/system/Makefile   |   1 -
 nss/lib/libpkix/pkix_pl_nss/system/config.mk  |  15 -
 .../libpkix/pkix_pl_nss/system/manifest.mn    |   2 +-
 nss/lib/nss/config.mk                         |   7 -
 nss/lib/nss/manifest.mn                       |   3 +-
 nss/lib/pk11wrap/Makefile                     |   5 +-
 nss/lib/pk11wrap/config.mk                    |  15 -
 nss/lib/pk11wrap/manifest.mn                  |   5 +-
 nss/lib/pk11wrap/pk11load.c                   |   2 +-
 nss/lib/pk11wrap/pk11wrap.gyp                 |   2 +-
 nss/lib/pkcs12/Makefile                       |   2 -
 nss/lib/pkcs12/config.mk                      |  16 -
 nss/lib/pkcs12/manifest.mn                    |   1 +
 nss/lib/pkcs7/Makefile                        |   2 -
 nss/lib/pkcs7/config.mk                       |  14 -
 nss/lib/pkcs7/manifest.mn                     |   1 +
 nss/lib/pki/Makefile                          |   8 +-
 nss/lib/pki/config.mk                         |  19 -
 nss/lib/pki/manifest.mn                       |   2 +-
 nss/lib/smime/config.mk                       |   7 -
 nss/lib/smime/manifest.mn                     |   2 +-
 nss/lib/softoken/Makefile                     |   7 +-
 nss/lib/softoken/config.mk                    |   7 -
 nss/lib/softoken/legacydb/config.mk           |   7 -
 nss/lib/softoken/legacydb/manifest.mn         |   2 +-
 nss/lib/softoken/manifest.mn                  |   2 +-
 nss/lib/sqlite/Makefile                       |   2 +-
 nss/lib/sqlite/config.mk                      |  12 -
 nss/lib/sqlite/manifest.mn                    |   4 +-
 nss/lib/ssl/config.mk                         |   7 -
 nss/lib/ssl/manifest.mn                       |   2 +-
 nss/lib/sysinit/Makefile                      |   4 -
 nss/lib/sysinit/config.mk                     |   7 -
 nss/lib/sysinit/manifest.mn                   |   2 +-
 nss/lib/util/Makefile                         |   2 -
 nss/lib/util/config.mk                        |   7 -
 nss/lib/util/manifest.mn                      |   4 +-
 nss/lib/zlib/Makefile                         |   7 +-
 nss/lib/zlib/config.mk                        |  20 -
 nss/lib/zlib/manifest.mn                      |   3 +-
 192 files changed, 324 insertions(+), 7165 deletions(-)
 delete mode 100644 nss/cmd/crmf-cgi/config.mk
 delete mode 100644 nss/cmd/crmftest/config.mk
 delete mode 100644 nss/cmd/lib/config.mk
 delete mode 100644 nss/cmd/libpkix/config.mk
 delete mode 100755 nss/coreconf/cpdist.pl
 delete mode 100755 nss/coreconf/import.pl
 delete mode 100644 nss/coreconf/jdk.mk
 delete mode 100755 nss/coreconf/jniregen.pl
 delete mode 100644 nss/coreconf/mkdepend/Makefile
 delete mode 100644 nss/coreconf/mkdepend/cppsetup.c
 delete mode 100644 nss/coreconf/mkdepend/def.h
 delete mode 100644 nss/coreconf/mkdepend/ifparser.c
 delete mode 100644 nss/coreconf/mkdepend/ifparser.h
 delete mode 100644 nss/coreconf/mkdepend/imakemdep.h
 delete mode 100644 nss/coreconf/mkdepend/include.c
 delete mode 100644 nss/coreconf/mkdepend/main.c
 delete mode 100644 nss/coreconf/mkdepend/mkdepend.man
 delete mode 100644 nss/coreconf/mkdepend/parse.c
 delete mode 100644 nss/coreconf/mkdepend/pr.c
 delete mode 100755 nss/coreconf/outofdate.pl
 delete mode 100755 nss/coreconf/release.pl
 delete mode 100644 nss/cpputil/config.mk
 delete mode 100644 nss/lib/base/config.mk
 delete mode 100644 nss/lib/certdb/config.mk
 delete mode 100644 nss/lib/certhigh/config.mk
 delete mode 100644 nss/lib/ckfw/builtins/config.mk
 delete mode 100644 nss/lib/ckfw/builtins/testlib/config.mk
 delete mode 100644 nss/lib/ckfw/capi/config.mk
 delete mode 100644 nss/lib/ckfw/config.mk
 delete mode 100644 nss/lib/crmf/config.mk
 delete mode 100644 nss/lib/cryptohi/config.mk
 delete mode 100644 nss/lib/dev/config.mk
 delete mode 100644 nss/lib/jar/config.mk
 delete mode 100755 nss/lib/libpkix/config.mk
 delete mode 100755 nss/lib/libpkix/include/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/certsel/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/checker/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/crlsel/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/params/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/results/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/store/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/top/config.mk
 delete mode 100755 nss/lib/libpkix/pkix/util/config.mk
 delete mode 100755 nss/lib/libpkix/pkix_pl_nss/config.mk
 delete mode 100755 nss/lib/libpkix/pkix_pl_nss/module/config.mk
 delete mode 100755 nss/lib/libpkix/pkix_pl_nss/pki/config.mk
 delete mode 100755 nss/lib/libpkix/pkix_pl_nss/system/config.mk
 delete mode 100644 nss/lib/pk11wrap/config.mk
 delete mode 100644 nss/lib/pkcs12/config.mk
 delete mode 100644 nss/lib/pkcs7/config.mk
 delete mode 100644 nss/lib/pki/config.mk
 delete mode 100644 nss/lib/zlib/config.mk

diff --git a/nss/cmd/crmf-cgi/Makefile b/nss/cmd/crmf-cgi/Makefile
index f817268..00a6b95 100644
--- a/nss/cmd/crmf-cgi/Makefile
+++ b/nss/cmd/crmf-cgi/Makefile
@@ -7,11 +7,7 @@
 #######################################################################
 # (1) Include initial platform-independent assignments (MANDATORY).   #
 #######################################################################
-ifeq (,$(filter-out WIN%,$(OS_TARGET)))
-EXTRA_LIBS += $(DIST)/lib/crmf.lib
-else
-EXTRA_LIBS += $(DIST)/lib/libcrmf.$(LIB_SUFFIX) 
-endif
+
 include manifest.mn
 
 #######################################################################
@@ -24,7 +20,11 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-
+ifeq (,$(filter-out WIN%,$(OS_TARGET)))
+EXTRA_LIBS += $(DIST)/lib/crmf.lib
+else
+EXTRA_LIBS += $(DIST)/lib/libcrmf.$(LIB_SUFFIX)
+endif
 
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
diff --git a/nss/cmd/crmf-cgi/config.mk b/nss/cmd/crmf-cgi/config.mk
deleted file mode 100644
index 77fca36..0000000
--- a/nss/cmd/crmf-cgi/config.mk
+++ /dev/null
@@ -1,16 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(PROGRAM)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-LIBRARY        =
-
diff --git a/nss/cmd/crmftest/Makefile b/nss/cmd/crmftest/Makefile
index 369cdc8..715d0b7 100644
--- a/nss/cmd/crmftest/Makefile
+++ b/nss/cmd/crmftest/Makefile
@@ -20,13 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-
-
-#######################################################################
-# (4) Include "local" platform-dependent assignments (OPTIONAL).      #
-#######################################################################
-include config.mk
-
 ifeq ($(OS_TARGET)$(OS_RELEASE), AIX4.2)
 OS_LIBS += -lsvld 
 endif 
@@ -37,6 +30,10 @@ endif
 
 EXTRA_LIBS += $(DIST)/lib/$(LIB_PREFIX)crmf.$(LIB_SUFFIX)
 
+#######################################################################
+# (4) Include "local" platform-dependent assignments (OPTIONAL).      #
+#######################################################################
+
 include ../platlibs.mk
 
 #######################################################################
diff --git a/nss/cmd/crmftest/config.mk b/nss/cmd/crmftest/config.mk
deleted file mode 100644
index 9838ef1..0000000
--- a/nss/cmd/crmftest/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(PROGRAM)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-LIBRARY        =
-
diff --git a/nss/cmd/lib/Makefile b/nss/cmd/lib/Makefile
index 94cfb1d..b1f9d1a 100644
--- a/nss/cmd/lib/Makefile
+++ b/nss/cmd/lib/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 include ../platlibs.mk
 
 #######################################################################
diff --git a/nss/cmd/lib/config.mk b/nss/cmd/lib/config.mk
deleted file mode 100644
index b8c03de..0000000
--- a/nss/cmd/lib/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/cmd/lib/manifest.mn b/nss/cmd/lib/manifest.mn
index b3c36b3..86233e6 100644
--- a/nss/cmd/lib/manifest.mn
+++ b/nss/cmd/lib/manifest.mn
@@ -5,6 +5,7 @@
 CORE_DEPTH	= ../..
 
 LIBRARY_NAME	= sectool
+SHARED_LIBRARY = $(NULL)
 
 # MODULE public and private header  directories are implicitly REQUIRED.
 MODULE		= nss
diff --git a/nss/cmd/libpkix/config.mk b/nss/cmd/libpkix/config.mk
deleted file mode 100644
index 672f6ff..0000000
--- a/nss/cmd/libpkix/config.mk
+++ /dev/null
@@ -1,9 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-TARGETS = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
diff --git a/nss/cmd/libpkix/perf/Makefile b/nss/cmd/libpkix/perf/Makefile
index b724102..3181547 100755
--- a/nss/cmd/libpkix/perf/Makefile
+++ b/nss/cmd/libpkix/perf/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/perf/manifest.mn b/nss/cmd/libpkix/perf/manifest.mn
index 005c96c..f700402 100755
--- a/nss/cmd/libpkix/perf/manifest.mn
+++ b/nss/cmd/libpkix/perf/manifest.mn
@@ -15,6 +15,7 @@ CSRCS = libpkix_buildthreads.c \
 	$(NULL)
 
 LIBRARY_NAME = pkixtoolperf
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR = $(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/Makefile b/nss/cmd/libpkix/pkix/Makefile
index ab4ffbd..1de5ef2 100755
--- a/nss/cmd/libpkix/pkix/Makefile
+++ b/nss/cmd/libpkix/pkix/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/certsel/Makefile b/nss/cmd/libpkix/pkix/certsel/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/certsel/Makefile
+++ b/nss/cmd/libpkix/pkix/certsel/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/certsel/manifest.mn b/nss/cmd/libpkix/pkix/certsel/manifest.mn
index 2e8198c..d9da6e1 100755
--- a/nss/cmd/libpkix/pkix/certsel/manifest.mn
+++ b/nss/cmd/libpkix/pkix/certsel/manifest.mn
@@ -14,7 +14,8 @@ CSRCS = test_certselector.c \
 	test_comcertselparams.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtoolcertsel
+LIBRARY_NAME = pkixtoolcertsel
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/checker/Makefile b/nss/cmd/libpkix/pkix/checker/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/checker/Makefile
+++ b/nss/cmd/libpkix/pkix/checker/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/checker/manifest.mn b/nss/cmd/libpkix/pkix/checker/manifest.mn
index 3101e02..54e1486 100755
--- a/nss/cmd/libpkix/pkix/checker/manifest.mn
+++ b/nss/cmd/libpkix/pkix/checker/manifest.mn
@@ -12,7 +12,8 @@ MODULE = nss
 
 CSRCS = test_certchainchecker.c
 
-LIBRARY_NAME=pkixtoolchecker
+LIBRARY_NAME = pkixtoolchecker
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/crlsel/Makefile b/nss/cmd/libpkix/pkix/crlsel/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/crlsel/Makefile
+++ b/nss/cmd/libpkix/pkix/crlsel/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/crlsel/manifest.mn b/nss/cmd/libpkix/pkix/crlsel/manifest.mn
index dfac43b..3b13298 100755
--- a/nss/cmd/libpkix/pkix/crlsel/manifest.mn
+++ b/nss/cmd/libpkix/pkix/crlsel/manifest.mn
@@ -14,7 +14,8 @@ CSRCS = test_crlselector.c \
 	test_comcrlselparams.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtoolcrlsel
+LIBRARY_NAME = pkixtoolcrlsel
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/params/Makefile b/nss/cmd/libpkix/pkix/params/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/params/Makefile
+++ b/nss/cmd/libpkix/pkix/params/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/params/manifest.mn b/nss/cmd/libpkix/pkix/params/manifest.mn
index a2e7e67..c7629a6 100755
--- a/nss/cmd/libpkix/pkix/params/manifest.mn
+++ b/nss/cmd/libpkix/pkix/params/manifest.mn
@@ -16,7 +16,8 @@ CSRCS = test_procparams.c \
 	test_resourcelimits.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtoolparams
+LIBRARY_NAME = pkixtoolparams
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/results/Makefile b/nss/cmd/libpkix/pkix/results/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/results/Makefile
+++ b/nss/cmd/libpkix/pkix/results/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/results/manifest.mn b/nss/cmd/libpkix/pkix/results/manifest.mn
index 5a8b936..7e4caea 100755
--- a/nss/cmd/libpkix/pkix/results/manifest.mn
+++ b/nss/cmd/libpkix/pkix/results/manifest.mn
@@ -16,7 +16,8 @@ CSRCS = test_buildresult.c \
 	test_valresult.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtoolresults
+LIBRARY_NAME = pkixtoolresults
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/store/Makefile b/nss/cmd/libpkix/pkix/store/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/store/Makefile
+++ b/nss/cmd/libpkix/pkix/store/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/store/manifest.mn b/nss/cmd/libpkix/pkix/store/manifest.mn
index 566a346..b939ffd 100755
--- a/nss/cmd/libpkix/pkix/store/manifest.mn
+++ b/nss/cmd/libpkix/pkix/store/manifest.mn
@@ -12,7 +12,8 @@ MODULE = nss
 
 CSRCS = test_store.c
 
-LIBRARY_NAME=pkixtoolstore
+LIBRARY_NAME = pkixtoolstore
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/top/Makefile b/nss/cmd/libpkix/pkix/top/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/top/Makefile
+++ b/nss/cmd/libpkix/pkix/top/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/top/manifest.mn b/nss/cmd/libpkix/pkix/top/manifest.mn
index a7d997d..8840204 100755
--- a/nss/cmd/libpkix/pkix/top/manifest.mn
+++ b/nss/cmd/libpkix/pkix/top/manifest.mn
@@ -26,7 +26,8 @@ CSRCS = test_basicchecker.c \
 	test_validatechain_NB.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtooltop
+LIBRARY_NAME = pkixtooltop
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix/util/Makefile b/nss/cmd/libpkix/pkix/util/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix/util/Makefile
+++ b/nss/cmd/libpkix/pkix/util/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix/util/manifest.mn b/nss/cmd/libpkix/pkix/util/manifest.mn
index 7dbeb6d..c7790c4 100755
--- a/nss/cmd/libpkix/pkix/util/manifest.mn
+++ b/nss/cmd/libpkix/pkix/util/manifest.mn
@@ -16,7 +16,8 @@ CSRCS = test_error.c \
 	test_logger.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtoolutil
+LIBRARY_NAME = pkixtoolutil
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix_pl/Makefile b/nss/cmd/libpkix/pkix_pl/Makefile
index ab4ffbd..1de5ef2 100755
--- a/nss/cmd/libpkix/pkix_pl/Makefile
+++ b/nss/cmd/libpkix/pkix_pl/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix_pl/module/Makefile b/nss/cmd/libpkix/pkix_pl/module/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix_pl/module/Makefile
+++ b/nss/cmd/libpkix/pkix_pl/module/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix_pl/module/manifest.mn b/nss/cmd/libpkix/pkix_pl/module/manifest.mn
index eedc934..50d20d0 100755
--- a/nss/cmd/libpkix/pkix_pl/module/manifest.mn
+++ b/nss/cmd/libpkix/pkix_pl/module/manifest.mn
@@ -17,7 +17,8 @@ CSRCS = test_colcertstore.c \
 	test_httpcertstore.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtoolmodule
+LIBRARY_NAME = pkixtoolmodule
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix_pl/pki/Makefile b/nss/cmd/libpkix/pkix_pl/pki/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix_pl/pki/Makefile
+++ b/nss/cmd/libpkix/pkix_pl/pki/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix_pl/pki/manifest.mn b/nss/cmd/libpkix/pkix_pl/pki/manifest.mn
index 7c6e0a7..15fae7b 100755
--- a/nss/cmd/libpkix/pkix_pl/pki/manifest.mn
+++ b/nss/cmd/libpkix/pkix_pl/pki/manifest.mn
@@ -21,7 +21,8 @@ CSRCS = test_cert.c \
 	test_subjectinfoaccess.c \
 	$(NULL)
 
-LIBRARY_NAME=pkixtoolpki
+LIBRARY_NAME = pkixtoolpki
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/cmd/libpkix/pkix_pl/system/Makefile b/nss/cmd/libpkix/pkix_pl/system/Makefile
index 09ca5f1..802e772 100755
--- a/nss/cmd/libpkix/pkix_pl/system/Makefile
+++ b/nss/cmd/libpkix/pkix_pl/system/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-include $(PKIX_DEPTH)/config.mk
-
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
diff --git a/nss/cmd/libpkix/pkix_pl/system/manifest.mn b/nss/cmd/libpkix/pkix_pl/system/manifest.mn
index edbf0cd..52bb34e 100755
--- a/nss/cmd/libpkix/pkix_pl/system/manifest.mn
+++ b/nss/cmd/libpkix/pkix_pl/system/manifest.mn
@@ -30,8 +30,8 @@ CSRCS = test_bigint.c \
 	test_string2.c \
 	$(NULL)
 
-
-LIBRARY_NAME=pkixtoolsys
+LIBRARY_NAME = pkixtoolsys
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR=$(PKIX_DEPTH)/$(OBJDIR)
  
diff --git a/nss/cmd/libpkix/testutil/config.mk b/nss/cmd/libpkix/testutil/config.mk
index 820dbb2..f1f6674 100644
--- a/nss/cmd/libpkix/testutil/config.mk
+++ b/nss/cmd/libpkix/testutil/config.mk
@@ -5,11 +5,4 @@
 
 # don't build the static library
 LIBRARY =
-
-ifeq (,$(filter-out WIN%,$(OS_TARGET)))
-
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-endif
+RES =
diff --git a/nss/cmd/libpkix/testutil/manifest.mn b/nss/cmd/libpkix/testutil/manifest.mn
index 2f831fc..184085b 100755
--- a/nss/cmd/libpkix/testutil/manifest.mn
+++ b/nss/cmd/libpkix/testutil/manifest.mn
@@ -20,6 +20,7 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixtooltestutil
+SHARED_LIBRARY = $(NULL)
 
 SOURCE_LIB_DIR = $(PKIX_DEPTH)/$(OBJDIR)
 
diff --git a/nss/coreconf/IRIX.mk b/nss/coreconf/IRIX.mk
index 1c91554..0afbb62 100644
--- a/nss/coreconf/IRIX.mk
+++ b/nss/coreconf/IRIX.mk
@@ -62,9 +62,6 @@ RANLIB		= /bin/true
 NOMD_OS_CFLAGS += $(ODD_CFLAGS) -D_SGI_MP_SOURCE
 
 OS_CFLAGS += $(NOMD_OS_CFLAGS)
-ifdef USE_MDUPDATE
-	OS_CFLAGS += -MDupdate $(DEPENDENCIES)
-endif
 
 ifeq ($(USE_N32),1)
 	SHLIB_LD_OPTS	+= -n32 -mips3
diff --git a/nss/coreconf/OS2.mk b/nss/coreconf/OS2.mk
index 17a8df5..4aa40eb 100644
--- a/nss/coreconf/OS2.mk
+++ b/nss/coreconf/OS2.mk
@@ -96,10 +96,6 @@ endif
 NSINSTALL 	= nsinstall             # HCT4OS2
 INSTALL		= $(NSINSTALL)
 
-MKDEPEND_DIR    = $(CORE_DEPTH)/coreconf/mkdepend
-MKDEPEND        = $(MKDEPEND_DIR)/$(OBJDIR_NAME)/mkdepend
-MKDEPENDENCIES  = $(OBJDIR_NAME)/depend.mk
-
 ####################################################################
 #
 # One can define the makefile variable NSDISTMODE to control
@@ -140,6 +136,10 @@ ifndef DLL_PREFIX
     DLL_PREFIX = $(NULL)
 endif
 
+ifndef IMPORT_LIB_SUFFIX
+    IMPORT_LIB_SUFFIX = .$(LIB_SUFFIX)
+endif
+
 #
 # override the TARGETS defined in ruleset.mk, adding IMPORT_LIBRARY
 #
@@ -147,8 +147,3 @@ ifndef TARGETS
     TARGETS = $(LIBRARY) $(SHARED_LIBRARY) $(IMPORT_LIBRARY) $(PROGRAM)
 endif
 
-
-ifdef LIBRARY_NAME
-    IMPORT_LIBRARY = $(OBJDIR)/$(LIBRARY_NAME)$(LIBRARY_VERSION)$(JDK_DEBUG_SUFFIX).lib
-endif
-
diff --git a/nss/coreconf/OpenUNIX.mk b/nss/coreconf/OpenUNIX.mk
index 209ca41..1afc80a 100644
--- a/nss/coreconf/OpenUNIX.mk
+++ b/nss/coreconf/OpenUNIX.mk
@@ -55,6 +55,3 @@ PROCESS_MAP_FILE = cp $< $@
 BUILD_UNIX_PLUGINS  = 1
 #DSO_LDOPTS         += -b elf -G -z defs
 DSO_LDOPTS         += -G
-
-# Used for Java compiler
-EXPORT_FLAGS += -W l,-Bexport
diff --git a/nss/coreconf/README b/nss/coreconf/README
index d17e64b..9d4c9e4 100644
--- a/nss/coreconf/README
+++ b/nss/coreconf/README
@@ -337,12 +337,6 @@ OVERVIEW of "rules.mk":
         clobber_all::           synonym for "realclean::" rule
 
 
-        IMPORT
-        ------
-        import::                uses perl script to retrieve specified
-                                VERSION of the binary release from
-                                $(RELEASE_TREE)
-
         RELEASE
         -------
         release_clean::         remove all files from the
@@ -364,18 +358,6 @@ OVERVIEW of "rules.mk":
                                 $(SOURCE_RELEASE_PREFIX)/
                                 $(SOURCE_RELEASE_BIN_DIR) directory
 
-        release_jars::          use perl script to package appropriate
-                                files in the $(XPCLASS_JAR),
-                                $(XPHEADER_JAR), $(MDHEADER_JAR), and
-                                $(MDBINARY_JAR) jar files
-
-        release_cpdistdir::     use perl script to copy the
-                                $(XPCLASS_JAR), $(XPHEADER_JAR),
-                                $(MDHEADER_JAR), and $(MDBINARY_JAR)
-                                jar files to the specified VERSION
-                                of the $(RELEASE_TREE) directory
-
-
 
         TOOLS and AUTOMATION
         --------------------
@@ -513,34 +495,11 @@ OVERVIEW of "rules.mk":
         CATEGORY/rule::                   Purpose
         ===================               =============================
 
-        $(PUBLIC_EXPORT_DIR)::            create directory used to
-                                          house public "C" header files
-
-        $(PRIVATE_EXPORT_DIR)::           create directory used to
-                                          house private "C" header
-                                          files
-
         $(SOURCE_XP_DIR)/
         release/include::                 create directory used to
                                           house "C" header files
                                           contained in a release
 
-        $(MKDEPENDENCIES)::               for UNIX systems, create
-                                          a directory used to house
-                                          dependencies and utilize
-                                          the $(MKDEPEND) rule to
-                                          create them
-
-        $(MKDEPEND)::                     cd to the dependency
-                                          directory and create them
-
-        depend::                          if $(OBJS) exist, perform the
-                                          $(MKDEPEND) rule followed by
-                                          the $(MKDEPENDENCIES) rule
-
-        dependclean::                     remove all files contained
-                                          in the dependency repository
-
         .DEFAULT:                         standard gmake rule
 
         .SUFFIXES:                        standard gmake rule
diff --git a/nss/coreconf/SCO_SV3.2.mk b/nss/coreconf/SCO_SV3.2.mk
index e0b9fe8..813603f 100644
--- a/nss/coreconf/SCO_SV3.2.mk
+++ b/nss/coreconf/SCO_SV3.2.mk
@@ -55,6 +55,3 @@ PROCESS_MAP_FILE = cp $< $@
 BUILD_UNIX_PLUGINS  = 1
 #DSO_LDOPTS         += -b elf -G -z defs
 DSO_LDOPTS         += -b elf -G
-
-# Used for Java compiler
-EXPORT_FLAGS += -W l,-Bexport
diff --git a/nss/coreconf/SunOS4.1.3_U1.mk b/nss/coreconf/SunOS4.1.3_U1.mk
index a3eb59f..edca215 100644
--- a/nss/coreconf/SunOS4.1.3_U1.mk
+++ b/nss/coreconf/SunOS4.1.3_U1.mk
@@ -18,7 +18,7 @@ CPU_ARCH   = sparc
 
 # Purify doesn't like -MDupdate
 NOMD_OS_CFLAGS += -Wall -Wno-format -Wno-switch -DSUNOS4
-OS_CFLAGS      += $(DSO_CFLAGS) $(NOMD_OS_CFLAGS) -MDupdate $(DEPENDENCIES)
+OS_CFLAGS      += $(DSO_CFLAGS) $(NOMD_OS_CFLAGS)
 MKSHLIB         = $(LD)
 MKSHLIB        += $(DSO_LDOPTS)
 NOSUCHFILE      = /solaris-rm-f-sucks
diff --git a/nss/coreconf/SunOS5.mk b/nss/coreconf/SunOS5.mk
index 9c8cc37..3d9dd3c 100644
--- a/nss/coreconf/SunOS5.mk
+++ b/nss/coreconf/SunOS5.mk
@@ -39,9 +39,6 @@ ifdef NS_USE_GCC
 	CCC       += -Wall -Wno-format
 	ASFLAGS	  += -x assembler-with-cpp
 	OS_CFLAGS += $(NOMD_OS_CFLAGS) $(ARCHFLAG)
-	ifdef USE_MDUPDATE
-		OS_CFLAGS += -MDupdate $(DEPENDENCIES)
-	endif
 	ifdef BUILD_OPT
 	    OPTIMIZER = -O2
 	    # Enable this for accurate dtrace profiling
diff --git a/nss/coreconf/UNIX.mk b/nss/coreconf/UNIX.mk
index 986235f..59dbf7b 100644
--- a/nss/coreconf/UNIX.mk
+++ b/nss/coreconf/UNIX.mk
@@ -25,10 +25,6 @@ NSINSTALL_DIR  = $(CORE_DEPTH)/coreconf/nsinstall
 NSINSTALL      = $(NSINSTALL_DIR)/$(OBJDIR_NAME)/nsinstall
 endif
 
-MKDEPEND_DIR    = $(CORE_DEPTH)/coreconf/mkdepend
-MKDEPEND        = $(MKDEPEND_DIR)/$(OBJDIR_NAME)/mkdepend
-MKDEPENDENCIES  = $(OBJDIR_NAME)/depend.mk
-
 ####################################################################
 #
 # One can define the makefile variable NSDISTMODE to control
diff --git a/nss/coreconf/WIN32.mk b/nss/coreconf/WIN32.mk
index df72372..189e901 100644
--- a/nss/coreconf/WIN32.mk
+++ b/nss/coreconf/WIN32.mk
@@ -85,12 +85,6 @@ NSINSTALL_DIR  = $(CORE_DEPTH)/coreconf/nsinstall
 endif
 NSINSTALL      = nsinstall
 
-MKDEPEND_DIR    = $(CORE_DEPTH)/coreconf/mkdepend
-MKDEPEND        = $(MKDEPEND_DIR)/$(OBJDIR_NAME)/mkdepend.exe
-# Note: MKDEPENDENCIES __MUST__ be a relative pathname, not absolute.
-# If it is absolute, gmake will crash unless the named file exists.
-MKDEPENDENCIES  = $(OBJDIR_NAME)/depend.mk
-
 INSTALL      = $(NSINSTALL)
 GARBAGE     += $(OBJDIR)/vc20.pdb $(OBJDIR)/vc40.pdb
 XP_DEFINE   += -DXP_PC
@@ -358,15 +352,6 @@ ifneq ($(CPU_ARCH),x386)
     CPU_TAG = _$(CPU_ARCH)
 endif
 
-#
-# override ruleset.mk, removing the "lib" prefix for library names, and
-# adding the "32" after the LIBRARY_VERSION.
-#
-ifdef LIBRARY_NAME
-    SHARED_LIBRARY = $(OBJDIR)/$(LIBRARY_NAME)$(LIBRARY_VERSION)32$(JDK_DEBUG_SUFFIX).dll
-    IMPORT_LIBRARY = $(OBJDIR)/$(LIBRARY_NAME)$(LIBRARY_VERSION)32$(JDK_DEBUG_SUFFIX).lib
-endif
-
 #
 # override the TARGETS defined in ruleset.mk, adding IMPORT_LIBRARY
 #
diff --git a/nss/coreconf/config.mk b/nss/coreconf/config.mk
index 60a0841..ab485da 100644
--- a/nss/coreconf/config.mk
+++ b/nss/coreconf/config.mk
@@ -121,14 +121,6 @@ ifndef MK_SUFFIX
 include $(CORE_DEPTH)/coreconf/suffix.mk
 endif
 
-#######################################################################
-# [13.0] Master "Core Components" for defining JDK                    #
-#        (dependent upon <architecture>, <source>, and <suffix>  tags)#
-#######################################################################
-ifdef NS_USE_JDK
-include $(CORE_DEPTH)/coreconf/jdk.mk
-endif
-
 #######################################################################
 # [14.0] Master "Core Components" rule set                            #
 #######################################################################
@@ -136,12 +128,6 @@ ifndef MK_RULESET
 include $(CORE_DEPTH)/coreconf/ruleset.mk
 endif
 
-#######################################################################
-# [15.0] Dependencies.
-#######################################################################
-
--include $(MKDEPENDENCIES)
-
 #######################################################################
 # [16.0] Global environ ment defines
 #######################################################################
diff --git a/nss/coreconf/cpdist.pl b/nss/coreconf/cpdist.pl
deleted file mode 100755
index 800edfb..0000000
--- a/nss/coreconf/cpdist.pl
+++ /dev/null
@@ -1,167 +0,0 @@
-#! /usr/local/bin/perl
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-require('coreconf.pl');
-
-#######-- read in variables on command line into %var
-
-&parse_argv;
- 
-### do the copy
-
-print STDERR "RELEASE TREE / MODULE =  $var{RELEASE_TREE} $var{MODULE}\n";
-
-
-
-# 1
-if ($var{RELEASE} eq "") { exit; } # Can't do release here, so exit.
-
-# 2
-#if (! ($var{RELEASE} =~ /\//)) {   # if no specific version is specified in RELEASE variable
-#    $component = $var{RELEASE};
-#}
-#else {  # if a subcomponent/version is given in the RELEASE variable
-#        $var{RELEASE} =~ m|^([^/]*)/|;  
-#	$component = $1;           # everything before the first slash;
-#    }
-
-# 3
-$path = $var{RELEASE};
-
-
-# 4
-# find out what directory we would create for 'today'
-
-$year = (localtime)[5] + 1900;
-$month = (localtime)[4] + 1;
-$day = (localtime)[3];
-$today = sprintf( "%d%02d%02d", $year, $month, $day );
-
-# 5
-# if version is null, then set the version to today.
-if ($var{"RELEASE_VERSION"} eq "") {
-    $var{"RELEASE_VERSION"} = $today;
-}
-
-#6
-$version = $var{"RELEASE_VERSION"};  # set RELEASE_VERSION to passed in variable
-
-#7
-# if version is today, then we will want to make a 'current' link.
-
-if ($version eq $today) {
-    $create_current = 1;
-}
-
-#8
-# version can be a) passed in value from command line, b) value in manifest.mn
-# or c) computed value such as '19970909'
-
-
-$dir = "$var{'RELEASE_TREE'}/$path";
-
-#9
-if (! (-e "$dir/$version" && -d "$dir/$version")) {
-    print "making dir $dir \n";
-    &rec_mkdir("$dir/$version");
-}
-
-
-
-print "version = $version\n";
-print "path = $path\n";
-print "var{release_tree} = $var{'RELEASE_TREE'}\n";
-print "dir = $dir   = RELEASE_TREE/path\n";
-
-
-#10
-if ($create_current == 1) {
-
-# unlinking and linking always occurs, even if the link is correct
-    print "unlinking $dir/current\n";
-    unlink("$dir/current");
-    
-    print "putting version number $today into 'current' file..";
-
-    open(FILE,">$dir/current") || die " couldn't open current\n";
-    print FILE "$today\n";
-    close(FILE);
-    print " ..done\n"
-    
-}
-
-&rec_mkdir("$dir/$version/$var{'RELEASE_MD_DIR'}");
-&rec_mkdir("$dir/$version/$var{'RELEASE_XP_DIR'}");
-
-
-
-
-foreach $jarfile (split(/ /,$var{FILES}) ) {
-    print STDERR "---------------------------------------------\n";
-    
-    $jarinfo = $var{$jarfile};
- 
-    ($jardir,$jaropts) = split(/\|/,$jarinfo);
- 
-    if ($jaropts =~ /f/) {
-      print STDERR "Copying files $jardir....\n";
-    }
-    else {
-      print STDERR "Copying jar file $jarfile....\n";
-    }
-    
-    print "jaropts = $jaropts\n";
-    
-    if ($jaropts =~ /m/) {
-      $destdir = $var{"RELEASE_MD_DIR"};
-      print "found m, using MD dir $destdir\n";
-    }
-    elsif ($jaropts =~ /x/) {
-      $destdir = $var{"RELEASE_XP_DIR"};
-      print "found x, using XP dir $destdir\n";
-    }
-    else {
-      die "Error: must specify m or x in jar options in $jarinfo line\n";
-    }
-    
-    
-    $distdir = "$dir/$version/$destdir";
-    
-
-
-    if ($jaropts =~ /f/) {
-
-      print "splitting: \"$jardir\"\n";
-      for $srcfile (split(/ /,$jardir)) {
-
-#if srcfile has a slash
-	if ($srcfile =~ m|/|) {
-#pull out everything before the last slash into $1
-	  $srcfile =~ m|(.*)/|;
-	  $distsubdir = "/$1";
-	  print "making dir $distdir$distsubdir\n";
-	  &rec_mkdir("$distdir$distsubdir");
-	}
-	print "copy: from $srcfile\n";
-	print "      to   $distdir$distsubdir\n";
-	$srcprefix = "";
-	if ($jaropts =~/m/) {
-	  $srcprefix = "$var{'PLATFORM'}/";
-	}
-	system("cp $srcprefix$srcfile $distdir$distsubdir");
-      }
-    }
-    else {
-      $srcfile = "$var{SOURCE_RELEASE_PREFIX}/$jardir/$jarfile";
-      
-      print "copy: from $srcfile\n";
-      print "      to   $distdir\n";
-      
-      system("cp $srcfile $distdir");
-      
-    }
-    
-  }
-
diff --git a/nss/coreconf/import.pl b/nss/coreconf/import.pl
deleted file mode 100755
index dd2d177..0000000
--- a/nss/coreconf/import.pl
+++ /dev/null
@@ -1,189 +0,0 @@
-#! /usr/local/bin/perl
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-print STDERR "import.pl\n";
-
-require('coreconf.pl');
-
-
-$returncode =0;
-
-
-#######-- read in variables on command line into %var
-
-$var{UNZIP} = "unzip -o";
-
-&parse_argv;
-
-if (! ($var{IMPORTS} =~ /\w/)) {
-    print STDERR "nothing to import\n";
-}
-
-######-- Do the import!
-
-foreach $import (split(/ /,$var{IMPORTS}) ) {
-
-    print STDERR "\n\nIMPORTING .... $import\n-----------------------------\n";
-
-
-# if a specific version specified in IMPORT variable
-# (if $import has a slash in it)
-
-    if ($import =~ /\//) {
-        # $component=everything before the first slash of $import
-
-	$import =~ m|^([^/]*)/|; 
-	$component = $1;
-
-	$import =~ m|^(.*)/([^/]*)$|;
-
-	# $path=everything before the last slash of $import
-	$path = $1;
-
-	# $version=everything after the last slash of $import
-	$version = $2;
-
-	if ($var{VERSION} ne "current") {
-	    $version = $var{VERSION};
-	}
-    }
-    else {
-	$component = $import;
-	$path = $import;
-	$version = $var{VERSION};
-    }
-
-    $releasejardir = "$var{RELEASE_TREE}/$path";
-    if ($version eq "current") {
-	print STDERR "Current version specified. Reading 'current' file ... \n";
-	
-	open(CURRENT,"$releasejardir/current") || die "NO CURRENT FILE\n";
-	$version = <CURRENT>;
-	$version =~ s/(\r?\n)*$//; # remove any trailing [CR/]LF's
-	close(CURRENT);
-	print STDERR "Using version $version\n";
-	if ( $version eq "") {
-	    die "Current version file empty. Stopping\n";
-	}
-    }
-    
-    $releasejardir = "$releasejardir/$version";
-    if ( ! -d $releasejardir) {
-	die "$releasejardir doesn't exist (Invalid Version?)\n";
-    }
-    foreach $jarfile (split(/ /,$var{FILES})) {
-
-	($relpath,$distpath,$options) = split(/\|/, $var{$jarfile});
-
-	if ($var{'OVERRIDE_IMPORT_CHECK'} eq 'YES') {
-	    $options =~ s/v//g;
-	}
-
-	if ( $relpath ne "") { $releasejarpathname = "$releasejardir/$relpath";}
-	else { $releasejarpathname = $releasejardir; }
-
-# If a component doesn't have IDG versions, import the DBG ones
-    if( ! -e "$releasejarpathname/$jarfile" ) {
-        if( $relpath =~ /IDG\.OBJ$/ ) {
-            $relpath =~ s/IDG.OBJ/DBG.OBJ/;
-            $releasejarpathname = "$releasejardir/$relpath";
-        } elsif( $relpath =~ /IDG\.OBJD$/ ) {
-            $relpath =~ s/IDG.OBJD/DBG.OBJD/;
-            $releasejarpathname = "$releasejardir/$relpath";
-        }
-    }
-
-	if (-e "$releasejarpathname/$jarfile") {
-	    print STDERR "\nWorking on jarfile: $jarfile\n";
-	    
-	    if ($distpath =~ m|/$|) {
-		$distpathname = "$distpath$component";
-	    }
-	    else {
-		$distpathname = "$distpath"; 
-	    }
-	  
-	  
-#the block below is used to determine whether or not the xp headers have
-#already been imported for this component
-
-	    $doimport = 1;
-	  if ($options =~ /v/) {   # if we should check the imported version
-	      print STDERR "Checking if version file exists $distpathname/version\n";
-	      if (-e "$distpathname/version") {
-		  open( VFILE, "<$distpathname/version") ||
-		      die "Cannot open $distpathname/version for reading. Permissions?\n";
-		  $importversion = <VFILE>;
-		  close (VFILE);
-		  $importversion =~ s/\r?\n$//;   # Strip off any trailing CR/LF
-		  if ($version eq $importversion) {
-		      print STDERR "$distpathname version '$importversion' already imported. Skipping...\n";
-		      $doimport =0;
-		  }
-	      }
-	  }
-	  
-	  if ($doimport == 1) {
-	      if (! -d "$distpathname") {
-		  &rec_mkdir("$distpathname");
-	      }
-	      # delete the stuff in there already.
-	      # (this should really be recursive delete.)
-	      
-	      if ($options =~ /v/) {
-		  $remheader = "\nREMOVING files in '$distpathname/' :";
-		  opendir(DIR,"$distpathname") ||
-		      die ("Cannot read directory $distpathname\n");
-		  @filelist = readdir(DIR);
-		  closedir(DIR);
-		  foreach $file ( @filelist ) {
-		      if (! ($file =~ m!/.?.$!) ) {
-			  if (! (-d $file)) {
-			      $file =~ m!([^/]*)$!;
-			      print STDERR "$remheader $1";
-			      $remheader = " ";
-			      unlink "$distpathname/$file";
-			  }
-		      }
-		  }
-	      }
-
-
-	      print STDERR "\n\n";
-
-	      print STDERR "\nExtracting jarfile '$jarfile' to local directory $distpathname/\n";
-	      
-	      print STDERR "$var{UNZIP} $releasejarpathname/$jarfile -d $distpathname\n";
-	      system("$var{UNZIP} $releasejarpathname/$jarfile -d $distpathname");
-	      
-	      $r = $?;
-
-	      if ($options =~ /v/) {
-		  if ($r == 0) {
-		      unlink ("$distpathname/version");
-		      if (open(VFILE,">$distpathname/version")) {
-			  print VFILE "$version\n";
-			  close(VFILE);
-		      }
-		  }
-		  else {
-		      print STDERR "Could not create '$distpathname/version'. Permissions?\n";
-		      $returncode ++;
-		  }
-	      }
-	  }  # if (doimport)
-	} # if (-e releasejarpathname/jarfile)
-    } # foreach jarfile)
-} # foreach IMPORT
-
-
-
-exit($returncode);
-
-
-
-
-
diff --git a/nss/coreconf/jdk.mk b/nss/coreconf/jdk.mk
deleted file mode 100644
index 92eb0e6..0000000
--- a/nss/coreconf/jdk.mk
+++ /dev/null
@@ -1,504 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-ifdef NS_USE_JDK
-#######################################################################
-# [1] Define preliminary JDK "Core Components" toolset options        #
-#######################################################################
-
-# set default JDK java threading model
-ifeq ($(JDK_THREADING_MODEL),)
-	JDK_THREADING_MODEL     = native_threads
-# no such thing as -native flag
-	JDK_THREADING_MODEL_OPT =
-endif
-
-#######################################################################
-# [2] Define platform-independent JDK "Core Components" options       #
-#######################################################################
-
-# set default location of the java classes repository
-ifeq ($(JAVA_DESTPATH),)
-ifdef BUILD_OPT
-	JAVA_DESTPATH  = $(SOURCE_CLASSES_DIR)
-else
-	JAVA_DESTPATH  = $(SOURCE_CLASSES_DBG_DIR)
-endif
-endif
-
-# set default location of the package under the java classes repository
-# note that this overrides the default package value in ruleset.mk
-ifeq ($(PACKAGE),)
-	PACKAGE = .
-endif
-
-# set default location of the java source code repository
-ifeq ($(JAVA_SOURCEPATH),)
-	JAVA_SOURCEPATH	= .
-endif
-
-# add JNI directory to default include search path
-ifneq ($(JNI_GEN),)
-	ifdef NSBUILDROOT
-		INCLUDES += -I$(JNI_GEN_DIR) -I$(SOURCE_XP_DIR)
-	else
-		INCLUDES += -I$(JNI_GEN_DIR)
-	endif
-endif
-
-#######################################################################
-# [3] Define platform-dependent JDK "Core Components" options         #
-#######################################################################
-
-# set [Microsoft Windows] platforms
-ifeq ($(OS_ARCH), WINNT)
-	JAVA_CLASSES = $(JAVA_HOME)/jre/lib/rt.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/lib/rt.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = ;
-
-	# (2) specify "header" information
-	JAVA_ARCH = win32
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	#     currently, disable JIT option on this platform
-	JDK_JIT_OPT = -nojit
-endif
-
-# set [Sun Solaris] platforms
-ifeq ($(OS_ARCH), SunOS)
-	JAVA_CLASSES = $(JAVA_HOME)/jre/lib/rt.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/lib/rt.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = :
-
-	# (2) specify "header" information
-	JAVA_ARCH = solaris
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	#     currently, disable JIT option on this platform
-	JDK_JIT_OPT =
-endif
-
-# set [Hewlett Packard HP-UX] platforms
-ifeq ($(OS_ARCH), HP-UX)
-	JAVA_CLASSES = $(JAVA_HOME)/jre/lib/rt.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/lib/rt.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = :
-
-	# (2) specify "header" information
-	JAVA_ARCH = hp-ux
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	# no JIT option available on this platform
-	JDK_JIT_OPT =
-endif
-
-# set [Redhat Linux] platforms
-ifeq ($(OS_ARCH), Linux)
-	JAVA_CLASSES = $(JAVA_HOME)/jre/lib/rt.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/lib/rt.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = :
-
-	# (2) specify "header" information
-	JAVA_ARCH = linux
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	# no JIT option available on this platform
-	JDK_JIT_OPT =
-endif
-
-# set [Mac OS X] platforms
-ifeq ($(OS_ARCH), Darwin)
-	JAVA_CLASSES = $(JAVA_HOME)/../Classes/classes.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/../Classes/classes.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = :
-
-	# (2) specify "header" information
-	JAVA_ARCH = darwin
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	# no JIT option available on this platform
-	JDK_JIT_OPT =
-endif
-
-# set [IBM AIX] platforms
-ifeq ($(OS_ARCH), AIX)
-	JAVA_CLASSES = $(JAVA_HOME)/jre/lib/rt.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/lib/rt.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = :
-
-	# (2) specify "header" information
-	JAVA_ARCH = aix
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	# no JIT option available on this platform
-	JDK_JIT_OPT =
-endif
-
-# set [Digital UNIX] platforms
-ifeq ($(OS_ARCH), OSF1)
-	JAVA_CLASSES = $(JAVA_HOME)/jre/lib/rt.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/lib/rt.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = :
-
-	# (2) specify "header" information
-	JAVA_ARCH = alpha
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	# no JIT option available on this platform
-	JDK_JIT_OPT =
-endif
-
-# set [Silicon Graphics IRIX] platforms
-ifeq ($(OS_ARCH), IRIX)
-	JAVA_CLASSES = $(JAVA_HOME)/lib/dev.jar:$(JAVA_HOME)/lib/rt.jar
-
-	ifeq ($(JRE_HOME),)
-		JRE_HOME = $(JAVA_HOME)
-		JRE_CLASSES = $(JAVA_CLASSES)
-	else
-		ifeq ($(JRE_CLASSES),)
-			JRE_CLASSES = $(JRE_HOME)/lib/dev.jar:$(JRE_HOME)/lib/rt.jar
-		endif
-	endif
-
-	PATH_SEPARATOR = :
-
-	# (2) specify "header" information
-	JAVA_ARCH = irix
-
-	INCLUDES += -I$(JAVA_HOME)/include
-	INCLUDES += -I$(JAVA_HOME)/include/$(JAVA_ARCH)
-
-	# no JIT option available on this platform
-	JDK_JIT_OPT =
-endif
-
-#######################################################################
-# [4] Define remaining JDK "Core Components" default toolset options  #
-#######################################################################
-
-# set JDK optimization model
-ifeq ($(BUILD_OPT),1)
-	JDK_OPTIMIZER_OPT = -O
-else
-	JDK_OPTIMIZER_OPT = -g
-endif
-
-# set minimal JDK debugging model
-ifeq ($(JDK_DEBUG),1)
-	JDK_DEBUG_OPT    = -debug
-else
-	JDK_DEBUG_OPT    =
-endif
-
-# set default path to repository for JDK classes
-ifeq ($(JDK_CLASS_REPOSITORY_OPT),)
-	JDK_CLASS_REPOSITORY_OPT = -d $(JAVA_DESTPATH)
-endif
-
-# define a default JDK classpath
-ifeq ($(JDK_CLASSPATH),)
-	JDK_CLASSPATH = '$(JAVA_DESTPATH)$(PATH_SEPARATOR)$(JAVA_SOURCEPATH)$(PATH_SEPARATOR)$(JAVA_CLASSES)'
-endif
-
-# by default, override CLASSPATH environment variable using the JDK classpath option with $(JDK_CLASSPATH)
-ifeq ($(JDK_CLASSPATH_OPT),)
-	JDK_CLASSPATH_OPT = -classpath $(JDK_CLASSPATH)
-endif
-
-ifeq ($(USE_64), 1)
-	JDK_USE_64 = -d64
-endif
-
-endif
-
-
-#######################################################################
-# [5] Define JDK "Core Components" toolset;                           #
-#     (always allow a user to override these values)                  #
-#######################################################################
-
-#
-# (1) appletviewer
-#
-
-ifeq ($(APPLETVIEWER),)
-	APPLETVIEWER_PROG   = $(JAVA_HOME)/bin/appletviewer$(PROG_SUFFIX)
-	APPLETVIEWER_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	APPLETVIEWER_FLAGS += $(JDK_DEBUG_OPT)
-	APPLETVIEWER_FLAGS += $(JDK_JIT_OPT)
-	APPLETVIEWER        = $(APPLETVIEWER_PROG) $(APPLETVIEWER_FLAGS)
-endif
-
-#
-# (2) jar
-#
-
-ifeq ($(JAR),)
-	JAR_PROG   = $(JAVA_HOME)/bin/jar$(PROG_SUFFIX)
-	JAR_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAR        = $(JAR_PROG) $(JAR_FLAGS)
-endif
-
-#
-# (3) java
-#
-
-ifeq ($(JAVA),)
-	JAVA_PROG   = $(JAVA_HOME)/bin/java$(PROG_SUFFIX)
-	JAVA_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVA_FLAGS += $(JDK_DEBUG_OPT)
-	JAVA_FLAGS += $(JDK_CLASSPATH_OPT)
-	JAVA_FLAGS += $(JDK_JIT_OPT)
-	JAVA_FLAGS += $(JDK_USE_64)
-	JAVA        = $(JAVA_PROG) $(JAVA_FLAGS) 
-endif
-
-#
-# (4) javac
-#
-
-ifeq ($(JAVAC),)
-	JAVAC_PROG   = $(JAVA_HOME)/bin/javac$(PROG_SUFFIX)
-	JAVAC_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVAC_FLAGS += $(JDK_OPTIMIZER_OPT)
-	JAVAC_FLAGS += $(JDK_DEBUG_OPT)
-	JAVAC_FLAGS += $(JDK_CLASSPATH_OPT)
-	JAVAC_FLAGS += $(JDK_CLASS_REPOSITORY_OPT)
-	JAVAC_FLAGS += $(JDK_USE_64)
-	JAVAC        = $(JAVAC_PROG) $(JAVAC_FLAGS)
-endif
-
-#
-# (5) javadoc
-#
-
-ifeq ($(JAVADOC),)
-	JAVADOC_PROG   = $(JAVA_HOME)/bin/javadoc$(PROG_SUFFIX)
-	JAVADOC_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVADOC_FLAGS += $(JDK_CLASSPATH_OPT)
-	JAVADOC        = $(JAVADOC_PROG) $(JAVADOC_FLAGS)
-endif
-
-#
-# (6) javah
-#
-
-ifeq ($(JAVAH),)
-	JAVAH_PROG   = $(JAVA_HOME)/bin/javah$(PROG_SUFFIX)
-	JAVAH_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVAH_FLAGS += $(JDK_CLASSPATH_OPT)
-	JAVAH        = $(JAVAH_PROG) $(JAVAH_FLAGS)
-endif
-
-#
-# (7) javakey
-#
-
-ifeq ($(JAVAKEY),)
-	JAVAKEY_PROG   = $(JAVA_HOME)/bin/javakey$(PROG_SUFFIX)
-	JAVAKEY_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVAKEY        = $(JAVAKEY_PROG) $(JAVAKEY_FLAGS)
-endif
-
-#
-# (8) javap
-#
-
-ifeq ($(JAVAP),)
-	JAVAP_PROG   = $(JAVA_HOME)/bin/javap$(PROG_SUFFIX)
-	JAVAP_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVAP_FLAGS += $(JDK_CLASSPATH_OPT)
-	JAVAP        = $(JAVAP_PROG) $(JAVAP_FLAGS)
-endif
-
-#
-# (9) javat
-#
-
-ifeq ($(JAVAT),)
-	JAVAT_PROG   = $(JAVA_HOME)/bin/javat$(PROG_SUFFIX)
-	JAVAT_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVAT        = $(JAVAT_PROG) $(JAVAT_FLAGS)
-endif
-
-#
-# (10) javaverify
-#
-
-ifeq ($(JAVAVERIFY),)
-	JAVAVERIFY_PROG   = $(JAVA_HOME)/bin/javaverify$(PROG_SUFFIX)
-	JAVAVERIFY_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JAVAVERIFY        = $(JAVAVERIFY_PROG) $(JAVAVERIFY_FLAGS)
-endif
-
-#
-# (11) javaw
-#
-
-ifeq ($(JAVAW),)
-	jJAVAW_PROG   = $(JAVA_HOME)/bin/javaw$(PROG_SUFFIX)
-	jJAVAW_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	jJAVAW_FLAGS += $(JDK_DEBUG_OPT)
-	jJAVAW_FLAGS += $(JDK_CLASSPATH_OPT)
-	jJAVAW_FLAGS += $(JDK_JIT_OPT)
-	jJAVAW        = $(JAVAW_PROG) $(JAVAW_FLAGS)
-endif
-
-#
-# (12) jdb
-#
-
-ifeq ($(JDB),)
-	JDB_PROG   = $(JAVA_HOME)/bin/jdb$(PROG_SUFFIX)
-	JDB_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JDB_FLAGS += $(JDK_DEBUG_OPT)
-	JDB_FLAGS += $(JDK_CLASSPATH_OPT)
-	JDB_FLAGS += $(JDK_JIT_OPT)
-	JDB        = $(JDB_PROG) $(JDB_FLAGS)
-endif
-
-#
-# (13) jre
-#
-
-ifeq ($(JRE),)
-	JRE_PROG   = $(JAVA_HOME)/bin/jre$(PROG_SUFFIX)
-	JRE_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JRE_FLAGS += $(JDK_CLASSPATH_OPT)
-	JRE_FLAGS += $(JDK_JIT_OPT)
-	JRE        = $(JRE_PROG) $(JRE_FLAGS) 
-endif
-
-#
-# (14) jrew
-#
-
-ifeq ($(JREW),)
-	JREW_PROG   = $(JAVA_HOME)/bin/jrew$(PROG_SUFFIX)
-	JREW_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	JREW_FLAGS += $(JDK_CLASSPATH_OPT)
-	JREW_FLAGS += $(JDK_JIT_OPT)
-	JREW        = $(JREW_PROG) $(JREW_FLAGS) 
-endif
-
-#
-# (15) native2ascii
-#
-
-ifeq ($(NATIVE2ASCII),)
-	NATIVE2ASCII_PROG   = $(JAVA_HOME)/bin/native2ascii$(PROG_SUFFIX)
-	NATIVE2ASCII_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	NATIVE2ASCII        = $(NATIVE2ASCII_PROG) $(NATIVE2ASCII_FLAGS) 
-endif
-
-#
-# (16) rmic
-#
-
-ifeq ($(RMIC),)
-	RMIC_PROG   = $(JAVA_HOME)/bin/rmic$(PROG_SUFFIX)
-	RMIC_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	RMIC_FLAGS += $(JDK_OPTIMIZER_OPT)
-	RMIC_FLAGS += $(JDK_CLASSPATH_OPT)
-	RMIC        = $(RMIC_PROG) $(RMIC_FLAGS) 
-endif
-
-#
-# (17) rmiregistry
-#
-
-ifeq ($(RMIREGISTRY),)
-	RMIREGISTRY_PROG   = $(JAVA_HOME)/bin/rmiregistry$(PROG_SUFFIX)
-	RMIREGISTRY_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	RMIREGISTRY        = $(RMIREGISTRY_PROG) $(RMIREGISTRY_FLAGS) 
-endif
-
-#
-# (18) serialver
-#
-
-ifeq ($(SERIALVER),)
-	SERIALVER_PROG   = $(JAVA_HOME)/bin/serialver$(PROG_SUFFIX)
-	SERIALVER_FLAGS  = $(JDK_THREADING_MODEL_OPT)
-	SERIALVER        = $(SERIALVER_PROG) $(SERIALVER_FLAGS) 
-endif
diff --git a/nss/coreconf/jniregen.pl b/nss/coreconf/jniregen.pl
deleted file mode 100755
index 2039180..0000000
--- a/nss/coreconf/jniregen.pl
+++ /dev/null
@@ -1,79 +0,0 @@
-#!/usr/local/bin/perl
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-# Input: -d dir -j javahcmd foo1 foo2 . . .
-#        Compares generated "_jni/foo1.h" file with "foo1.class", and
-#        generated "_jni/foo2.h" file with "foo2.class", etc.
-#        (NOTE:  unlike its closely related cousin, outofdate.pl,
-#                the "-d dir" must always be specified)
-#        Runs the javahcmd on all files that are different.
-#
-# Returns: list of headers which are OLDER than corresponding class
-#          files (non-existent class files are considered to be real old :-)
-
-my $javah = "";
-my $classdir = "";
-
-while(1) {
-    if ($ARGV[0] eq '-d') {
-        $classdir = $ARGV[1];
-        $classdir .= "/";
-        shift;
-        shift;
-    } elsif($ARGV[0] eq '-j') {
-        $javah = $ARGV[1];
-        shift;
-        shift;
-    } else {
-        last;
-    }
-}
-
-if( $javah  eq "") {
-    die "Must specify -j <javah command>";
-}
-if( $classdir eq "") {
-    die "Must specify -d <classdir>";
-}
-
-foreach $filename (@ARGV)
-{
-    $headerfilename = "_jni/";
-    $headerfilename .= $filename;
-    $headerfilename =~ s/\./_/g;
-    $headerfilename .= ".h";
-
-    $classfilename = $filename;
-    $classfilename =~ s|\.|/|g;
-    $classfilename .= ".class";
-
-    $classfilename = $classdir . $classfilename;
-
-
-    ( $dev, $ino, $mode, $nlink, $uid, $gid, $rdev, $size, $atime, $headermtime,
-      $ctime, $blksize, $blocks ) = stat( $headerfilename );
-
-    ( $dev, $ino, $mode, $nlink, $uid, $gid, $rdev, $size, $atime, $classmtime,
-      $ctime, $blksize, $blocks ) = stat( $classfilename );
-
-    if( $headermtime < $classmtime )
-    {
-	# NOTE:  Since this is used by "javah", and "javah" refuses to overwrite
-	#        an existing file, we force an unlink from this script, since
-	#        we actually want to regenerate the header file at this time.
-        unlink $headerfilename;
-        push @filelist, $filename;
-    }
-}
-
-if( @filelist ) {
-    $cmd = "$javah " . join(" ",@filelist);
-    $cmd =~ s/\'/\"/g;  # because windows doesn't understand single quote
-    print "$cmd\n";
-    exit (system($cmd) >> 8);
-} else {
-    print "All JNI header files up to date.\n"
-}
diff --git a/nss/coreconf/location.mk b/nss/coreconf/location.mk
index b11558a..9c43394 100644
--- a/nss/coreconf/location.mk
+++ b/nss/coreconf/location.mk
@@ -15,16 +15,13 @@ ifdef BUILD_TREE
 ifdef LIBRARY_NAME
 BUILD         = $(BUILD_TREE)/nss/$(LIBRARY_NAME)
 OBJDIR        = $(BUILD_TREE)/nss/$(LIBRARY_NAME)
-DEPENDENCIES  = $(BUILD_TREE)/nss/$(LIBRARY_NAME)/.md
 else
 BUILD         = $(BUILD_TREE)/nss
 OBJDIR        = $(BUILD_TREE)/nss
-DEPENDENCIES  = $(BUILD_TREE)/nss/.md
 endif
 else
 BUILD         = $(PLATFORM)
 OBJDIR        = $(PLATFORM)
-DEPENDENCIES  = $(PLATFORM)/.md
 endif
 
 DIST          = $(SOURCE_PREFIX)/$(PLATFORM)
@@ -33,7 +30,7 @@ ifdef BUILD_DEBUG_GC
     DEFINES += -DDEBUG_GC
 endif
 
-GARBAGE += $(DEPENDENCIES) core $(wildcard core.[0-9]*)
+GARBAGE += core $(wildcard core.[0-9]*)
 
 ifdef NSPR_INCLUDE_DIR
     INCLUDES += -I$(NSPR_INCLUDE_DIR)
diff --git a/nss/coreconf/mkdepend/Makefile b/nss/coreconf/mkdepend/Makefile
deleted file mode 100644
index 2554e23..0000000
--- a/nss/coreconf/mkdepend/Makefile
+++ /dev/null
@@ -1,60 +0,0 @@
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-DEPTH		= ../..
-CORE_DEPTH	= ../..
-
-MODULE		= coreconf
-
-CSRCS		= \
-                cppsetup.c \
-                ifparser.c \
-                include.c \
-                main.c \
-                parse.c \
-                pr.c
-
-PROGRAM		= mkdepend
-
-# Indicate that this directory builds build tools.
-INTERNAL_TOOLS  = 1
-
-
-include $(DEPTH)/coreconf/config.mk
-
-TARGETS		= $(PROGRAM)
-ifeq (,$(filter-out OS2 WIN%,$(OS_TARGET)))
-DEFINES		+= -DNO_X11
-else
-INSTALL		= true
-endif
-
-ifdef NATIVE_CC
-CC=$(NATIVE_CC)
-endif
-
-ifdef NATIVE_FLAGS
-OS_CFLAGS=$(NATIVE_FLAGS)
-endif
-
-include $(DEPTH)/coreconf/rules.mk
-
-ifdef GNU_CC
-OPTIMIZER = -O3
-else
-ifeq ($(OS_ARCH),SunOS)
-OPTIMIZER = -fast
-endif
-ifeq ($(OS_ARCH),WINNT)
-OPTIMIZER = -Ox
-endif
-endif
-
-DEFINES += -DINCLUDEDIR=\"/usr/include\" -DOBJSUFFIX=\".$(OBJ_SUFFIX)\"
-
-# Redefine MAKE_OBJDIR for just this directory
-define MAKE_OBJDIR
-if test ! -d $(@D); then mkdir -p $(@D); fi
-endef
-
diff --git a/nss/coreconf/mkdepend/cppsetup.c b/nss/coreconf/mkdepend/cppsetup.c
deleted file mode 100644
index 49a746a..0000000
--- a/nss/coreconf/mkdepend/cppsetup.c
+++ /dev/null
@@ -1,233 +0,0 @@
-/* $Xorg: cppsetup.c,v 1.5 2001/02/09 02:03:16 xorgcvs Exp $ */
-/*
-
-Copyright (c) 1993, 1994, 1998  The Open Group
-
-Permission to use, copy, modify, distribute, and sell this software and its
-documentation for any purpose is hereby granted without fee, provided that
-the above copyright notice appear in all copies and that both that
-copyright notice and this permission notice appear in supporting
-documentation.
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
-CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-
-Except as contained in this notice, the name of The Open Group shall not be
-used in advertising or otherwise to promote the sale, use or other dealings
-in this Software without prior written authorization from The Open Group.
-
-*/
-/* $XFree86: xc/config/makedepend/cppsetup.c,v 3.11 2001/12/17 20:52:22 dawes Exp $ */
-
-#include "def.h"
-
-#ifdef	CPP
-/*
- * This file is strictly for the sake of cpy.y and yylex.c (if
- * you indeed have the source for cpp).
- */
-#define IB 1
-#define SB 2
-#define NB 4
-#define CB 8
-#define QB 16
-#define WB 32
-#define SALT '#'
-#if defined(pdp11) || defined(vax) || defined(ns16000) || defined(mc68000) || defined(ibm032)
-#define COFF 128
-#else
-#define COFF 0
-#endif
-/*
- * These variables used by cpy.y and yylex.c
- */
-extern char	*outp, *inp, *newp, *pend;
-extern char	*ptrtab;
-extern char	fastab[];
-extern char	slotab[];
-
-/*
- * cppsetup
- */
-struct filepointer	*currentfile;
-struct inclist		*currentinc;
-
-int
-cppsetup(char *line, struct filepointer *filep, struct inclist *inc)
-{
-	char *p, savec;
-	static boolean setupdone = FALSE;
-	boolean	value;
-
-	if (!setupdone) {
-		cpp_varsetup();
-		setupdone = TRUE;
-	}
-
-	currentfile = filep;
-	currentinc = inc;
-	inp = newp = line;
-	for (p=newp; *p; p++)
-		;
-
-	/*
-	 * put a newline back on the end, and set up pend, etc.
-	 */
-	*p++ = '\n';
-	savec = *p;
-	*p = '\0';
-	pend = p;
-
-	ptrtab = slotab+COFF;
-	*--inp = SALT; 
-	outp=inp; 
-	value = yyparse();
-	*p = savec;
-	return(value);
-}
-
-struct symtab **lookup(symbol)
-	char	*symbol;
-{
-	static struct symtab    *undefined;
-	struct symtab   **sp;
-
-	sp = isdefined(symbol, currentinc, NULL);
-	if (sp == NULL) {
-		sp = &undefined;
-		(*sp)->s_value = NULL;
-	}
-	return (sp);
-}
-
-pperror(tag, x0,x1,x2,x3,x4)
-	int	tag,x0,x1,x2,x3,x4;
-{
-	warning("\"%s\", line %d: ", currentinc->i_file, currentfile->f_line);
-	warning(x0,x1,x2,x3,x4);
-}
-
-
-yyerror(s)
-	register char	*s;
-{
-	fatalerr("Fatal error: %s\n", s);
-}
-#else /* not CPP */
-
-#include "ifparser.h"
-struct _parse_data {
-    struct filepointer *filep;
-    struct inclist *inc;
-    char *filename;
-    const char *line;
-};
-
-static const char *
-my_if_errors (IfParser *ip, const char *cp, const char *expecting)
-{
-    struct _parse_data *pd = (struct _parse_data *) ip->data;
-    int lineno = pd->filep->f_line;
-    char *filename = pd->filename;
-    char prefix[300];
-    int prefixlen;
-    int i;
-
-    sprintf (prefix, "\"%s\":%d", filename, lineno);
-    prefixlen = strlen(prefix);
-    fprintf (stderr, "%s:  %s", prefix, pd->line);
-    i = cp - pd->line;
-    if (i > 0 && pd->line[i-1] != '\n') {
-	putc ('\n', stderr);
-    }
-    for (i += prefixlen + 3; i > 0; i--) {
-	putc (' ', stderr);
-    }
-    fprintf (stderr, "^--- expecting %s\n", expecting);
-    return NULL;
-}
-
-
-#define MAXNAMELEN 256
-
-static struct symtab **
-lookup_variable (IfParser *ip, const char *var, int len)
-{
-    char tmpbuf[MAXNAMELEN + 1];
-    struct _parse_data *pd = (struct _parse_data *) ip->data;
-
-    if (len > MAXNAMELEN)
-	return 0;
-
-    strncpy (tmpbuf, var, len);
-    tmpbuf[len] = '\0';
-    return isdefined (tmpbuf, pd->inc, NULL);
-}
-
-
-static int
-my_eval_defined (IfParser *ip, const char *var, int len)
-{
-    if (lookup_variable (ip, var, len))
-	return 1;
-    else
-	return 0;
-}
-
-#define isvarfirstletter(ccc) (isalpha(ccc) || (ccc) == '_')
-
-static long
-my_eval_variable (IfParser *ip, const char *var, int len)
-{
-    long val;
-    struct symtab **s;
-
-    s = lookup_variable (ip, var, len);
-    if (!s)
-	return 0;
-    do {
-	var = (*s)->s_value;
-	if (!isvarfirstletter(*var) || !strcmp((*s)->s_name, var))
-	    break;
-	s = lookup_variable (ip, var, strlen(var));
-    } while (s);
-
-    var = ParseIfExpression(ip, var, &val);
-    if (var && *var) debug(4, ("extraneous: '%s'\n", var));
-    return val;
-}
-
-int
-cppsetup(char *filename,
-	 char *line,
-	 struct filepointer *filep,
-	 struct inclist *inc)
-{
-    IfParser ip;
-    struct _parse_data pd;
-    long val = 0;
-
-    pd.filep = filep;
-    pd.inc = inc;
-    pd.line = line;
-    pd.filename = filename;
-    ip.funcs.handle_error = my_if_errors;
-    ip.funcs.eval_defined = my_eval_defined;
-    ip.funcs.eval_variable = my_eval_variable;
-    ip.data = (char *) &pd;
-
-    (void) ParseIfExpression (&ip, line, &val);
-    if (val)
-	return IF;
-    else
-	return IFFALSE;
-}
-#endif /* CPP */
-
diff --git a/nss/coreconf/mkdepend/def.h b/nss/coreconf/mkdepend/def.h
deleted file mode 100644
index d6e5f89..0000000
--- a/nss/coreconf/mkdepend/def.h
+++ /dev/null
@@ -1,184 +0,0 @@
-/* $Xorg: def.h,v 1.4 2001/02/09 02:03:16 xorgcvs Exp $ */
-/*
-
-Copyright (c) 1993, 1994, 1998 The Open Group.
-
-Permission to use, copy, modify, distribute, and sell this software and its
-documentation for any purpose is hereby granted without fee, provided that
-the above copyright notice appear in all copies and that both that
-copyright notice and this permission notice appear in supporting
-documentation.
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
-CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-
-Except as contained in this notice, the name of The Open Group shall not be
-used in advertising or otherwise to promote the sale, use or other dealings
-in this Software without prior written authorization from The Open Group.
-
-*/
-/* $XFree86: xc/config/makedepend/def.h,v 3.14 2003/01/17 17:09:49 tsi Exp $ */
-
-#ifndef NO_X11
-#include <X11/Xos.h>
-#include <X11/Xfuncproto.h>
-#endif
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
-#include <ctype.h>
-#if 0
-#ifndef X_NOT_POSIX
-#ifndef _POSIX_SOURCE
-#define _POSIX_SOURCE
-#endif
-#endif
-#endif
-#include <sys/types.h>
-#include <fcntl.h>
-#include <sys/stat.h>
-
-#define MAXDEFINES	512
-#define MAXFILES	1024
-#define MAXINCFILES	256	/* "-include" files */
-#define MAXDIRS		1024
-#define SYMTABINC	10	/* must be > 1 for define() to work right */
-#define	TRUE		1
-#define	FALSE		0
-
-/* the following must match the directives table in main.c */
-#define	IF		0
-#define	IFDEF		1
-#define	IFNDEF		2
-#define	ELSE		3
-#define	ENDIF		4
-#define	DEFINE		5
-#define	UNDEF		6
-#define	INCLUDE		7
-#define	LINE		8
-#define	PRAGMA		9
-#define ERROR           10
-#define IDENT           11
-#define SCCS            12
-#define ELIF            13
-#define EJECT           14
-#define WARNING         15
-#define INCLUDENEXT     16
-#define IFFALSE         17     /* pseudo value --- never matched */
-#define ELIFFALSE       18     /* pseudo value --- never matched */
-#define INCLUDEDOT      19     /* pseudo value --- never matched */
-#define IFGUESSFALSE    20     /* pseudo value --- never matched */
-#define ELIFGUESSFALSE  21     /* pseudo value --- never matched */
-#define INCLUDENEXTDOT  22     /* pseudo value --- never matched */
-
-#ifdef DEBUG
-extern int	_debugmask;
-/*
- * debug levels are:
- * 
- *     0	show ifn*(def)*,endif
- *     1	trace defined/!defined
- *     2	show #include
- *     3	show #include SYMBOL
- *     4-6	unused
- */
-#define debug(level,arg) { if (_debugmask & (1 << level)) warning arg; }
-#else
-#define	debug(level,arg) /**/
-#endif /* DEBUG */
-
-typedef	unsigned char boolean;
-
-struct symtab {
-	char	*s_name;
-	char	*s_value;
-};
-
-/* possible i_flag */
-#define DEFCHECKED	(1<<0)	/* whether defines have been checked */
-#define NOTIFIED	(1<<1)	/* whether we have revealed includes */
-#define MARKED		(1<<2)	/* whether it's in the makefile */
-#define SEARCHED	(1<<3)	/* whether we have read this */
-#define FINISHED	(1<<4)	/* whether we are done reading this */
-#define INCLUDED_SYM	(1<<5)	/* whether #include SYMBOL was found
-				   Can't use i_list if TRUE */
-struct	inclist {
-	char		*i_incstring;	/* string from #include line */
-	char		*i_file;	/* path name of the include file */
-	struct inclist	**i_list;	/* list of files it itself includes */
-	int		i_listlen;	/* length of i_list */
-	struct symtab	**i_defs;	/* symbol table for this file and its
-					   children when merged */
-	int		i_ndefs;	/* current # defines */
-	boolean		*i_merged;      /* whether we have merged child
-					   defines */
-	unsigned char   i_flags;
-};
-
-struct filepointer {
-	char	*f_name;
-	char	*f_p;
-	char	*f_base;
-	char	*f_end;
-	long	f_len;
-	long	f_line;
-	long	cmdinc_count;
-	char	**cmdinc_list;
-	long	cmdinc_line;
-};
-
-#include <stdlib.h>
-#if defined(macII) && !defined(__STDC__)  /* stdlib.h fails to define these */
-char *malloc(), *realloc();
-#endif /* macII */
-
-char			*copy(char *str);
-int                     match(char *str, char **list);
-char			*base_name(char *file);
-char			*getnextline(struct filepointer *fp);
-struct symtab		**slookup(char *symbol, struct inclist *file);
-struct symtab		**isdefined(char *symbol, struct inclist *file,
-				    struct inclist **srcfile);
-struct symtab		**fdefined(char *symbol, struct inclist *file,
-				   struct inclist **srcfile);
-struct filepointer	*getfile(char *file);
-void                    included_by(struct inclist *ip, 
-				    struct inclist *newfile);
-struct inclist		*newinclude(char *newfile, char *incstring);
-void                    inc_clean (void);
-struct inclist		*inc_path(char *file, char *include, int type);
-
-void                    freefile(struct filepointer *fp);
-
-void                    define2(char *name, char *val, struct inclist *file);
-void                    define(char *def, struct inclist *file);
-void                    undefine(char *symbol, struct inclist *file);
-int                     find_includes(struct filepointer *filep, 
-				      struct inclist *file, 
-				      struct inclist *file_red, 
-				      int recursion, boolean failOK);
-
-void                    recursive_pr_include(struct inclist *head, 
-					     char *file, char *base);
-void                    add_include(struct filepointer *filep, 
-				    struct inclist *file, 
-				    struct inclist *file_red, 
-				    char *include, int type,
-				    boolean failOK);
-
-int                     cppsetup(char *filename,
-				 char *line,
-				 struct filepointer *filep,
-				 struct inclist *inc);
-
-
-extern void fatalerr(char *, ...);
-extern void warning(char *, ...);
-extern void warning1(char *, ...);
diff --git a/nss/coreconf/mkdepend/ifparser.c b/nss/coreconf/mkdepend/ifparser.c
deleted file mode 100644
index 0b184c2..0000000
--- a/nss/coreconf/mkdepend/ifparser.c
+++ /dev/null
@@ -1,551 +0,0 @@
-/*
- * $Xorg: ifparser.c,v 1.3 2000/08/17 19:41:50 cpqbld Exp $
- *
- * Copyright 1992 Network Computing Devices, Inc.
- * 
- * Permission to use, copy, modify, and distribute this software and its
- * documentation for any purpose and without fee is hereby granted, provided
- * that the above copyright notice appear in all copies and that both that
- * copyright notice and this permission notice appear in supporting
- * documentation, and that the name of Network Computing Devices may not be
- * used in advertising or publicity pertaining to distribution of the software
- * without specific, written prior permission.  Network Computing Devices makes
- * no representations about the suitability of this software for any purpose.
- * It is provided ``as is'' without express or implied warranty.
- * 
- * NETWORK COMPUTING DEVICES DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS
- * SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS,
- * IN NO EVENT SHALL NETWORK COMPUTING DEVICES BE LIABLE FOR ANY SPECIAL,
- * INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
- * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE
- * OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
- * PERFORMANCE OF THIS SOFTWARE.
- * 
- * Author:  Jim Fulton
- *          Network Computing Devices, Inc.
- * 
- * Simple if statement processor
- *
- * This module can be used to evaluate string representations of C language
- * if constructs.  It accepts the following grammar:
- * 
- *     EXPRESSION	:=	VALUE
- * 			 |	VALUE  BINOP	EXPRESSION
- *			 |	VALUE	'?'	EXPRESSION ':'	EXPRESSION
- * 
- *     VALUE		:=	'('  EXPRESSION  ')'
- * 			 |	'!'  VALUE
- * 			 |	'-'  VALUE
- * 			 |	'+'  VALUE
- *			 |	'~'  VALUE
- * 			 |	'defined'  '('  variable  ')'
- * 			 |	'defined'  variable
- *			 |	# variable '(' variable-list ')'
- * 			 |	variable
- * 			 |	number
- * 
- *     BINOP		:=	'*'	|  '/'	|  '%'
- * 			 |	'+'	|  '-'
- * 			 |	'<<'	|  '>>'
- * 			 |	'<'	|  '>'	|  '<='  |  '>='
- * 			 |	'=='	|  '!='
- * 			 |	'&'	|  '^'  |  '|'
- * 			 |	'&&'	|  '||'
- * 
- * The normal C order of precedence is supported.
- * 
- * 
- * External Entry Points:
- * 
- *     ParseIfExpression		parse a string for #if
- */
-/* $XFree86: xc/config/makedepend/ifparser.c,v 3.11 2002/09/23 01:48:08 tsi Exp $ */
-
-#include "ifparser.h"
-#include <ctype.h>
-#include <stdlib.h>
-#include <string.h>
-
-/****************************************************************************
-		   Internal Macros and Utilities for Parser
- ****************************************************************************/
-
-#define DO(val) if (!(val)) return NULL
-#define CALLFUNC(ggg,fff) (*((ggg)->funcs.fff))
-#define SKIPSPACE(ccc) while (isspace(*ccc)) ccc++
-#define isvarfirstletter(ccc) (isalpha(ccc) || (ccc) == '_')
-
-
-static const char *
-parse_variable (IfParser *g, const char *cp, const char **varp)
-{
-    SKIPSPACE (cp);
-
-    if (!isvarfirstletter (*cp))
-	return CALLFUNC(g, handle_error) (g, cp, "variable name");
-
-    *varp = cp;
-    /* EMPTY */
-    for (cp++; isalnum(*cp) || *cp == '_'; cp++) ;
-    return cp;
-}
-
-
-static const char *
-parse_number (IfParser *g, const char *cp, long *valp)
-{
-    long base = 10;
-    SKIPSPACE (cp);
-
-    if (!isdigit(*cp))
-	return CALLFUNC(g, handle_error) (g, cp, "number");
-
-    *valp = 0;
-
-    if (*cp == '0') {
-	cp++;
-	if ((*cp == 'x') || (*cp == 'X')) {
-	    base = 16;
-	    cp++;
-	} else {
-	    base = 8;
-	}
-    }
-
-    /* Ignore overflows and assume ASCII, what source is usually written in */
-    while (1) {
-	int increment = -1;
-	if (base == 8) {
-	    if ((*cp >= '0') && (*cp <= '7'))
-		increment = *cp++ - '0';
-	} else if (base == 16) {
-	    if ((*cp >= '0') && (*cp <= '9'))
-		increment = *cp++ - '0';
-	    else if ((*cp >= 'A') &&  (*cp <= 'F'))
-		increment = *cp++ - ('A' - 10);
-	    else if ((*cp >= 'a') && (*cp <= 'f'))
-		increment = *cp++ - ('a' - 10);
-	} else {	/* Decimal */
-	    if ((*cp >= '0') && (*cp <= '9'))
-		increment = *cp++ - '0';
-	}
-	if (increment < 0)
-	    break;
-	*valp = (*valp * base) + increment;
-    }
-
-    /* Skip trailing qualifiers */
-    while (*cp == 'U' || *cp == 'u' || *cp == 'L' || *cp == 'l') cp++;
-    return cp;
-}
-
-static const char *
-parse_character (IfParser *g, const char *cp, long *valp)
-{
-    char val;
-
-    SKIPSPACE (cp);
-    if (*cp == '\\')
-	switch (cp[1]) {
-	case 'n': val = '\n'; break;
-	case 't': val = '\t'; break;
-	case 'v': val = '\v'; break;
-	case 'b': val = '\b'; break;
-	case 'r': val = '\r'; break;
-	case 'f': val = '\f'; break;
-	case 'a': val = '\a'; break;
-	case '\\': val = '\\'; break;
-	case '?': val = '\?'; break;
-	case '\'': val = '\''; break;
-	case '\"': val = '\"'; break;
-	case 'x': val = (char) strtol (cp + 2, NULL, 16); break;
-	default: val = (char) strtol (cp + 1, NULL, 8); break;
-	}
-    else
-	val = *cp;
-    while (*cp != '\'') cp++;
-    *valp = (long) val;
-    return cp;
-}
-
-static const char *
-parse_value (IfParser *g, const char *cp, long *valp)
-{
-    const char *var, *varend;
-
-    *valp = 0;
-
-    SKIPSPACE (cp);
-    if (!*cp)
-	return cp;
-
-    switch (*cp) {
-      case '(':
-	DO (cp = ParseIfExpression (g, cp + 1, valp));
-	SKIPSPACE (cp);
-	if (*cp != ')') 
-	    return CALLFUNC(g, handle_error) (g, cp, ")");
-
-	return cp + 1;			/* skip the right paren */
-
-      case '!':
-	DO (cp = parse_value (g, cp + 1, valp));
-	*valp = !(*valp);
-	return cp;
-
-      case '-':
-	DO (cp = parse_value (g, cp + 1, valp));
-	*valp = -(*valp);
-	return cp;
-
-      case '+':
-	DO (cp = parse_value (g, cp + 1, valp));
-	return cp;
-
-      case '~':
-	DO (cp = parse_value (g, cp + 1, valp));
-	*valp = ~(*valp);
-	return cp;
-
-      case '#':
-	DO (cp = parse_variable (g, cp + 1, &var));
-	SKIPSPACE (cp);
-	if (*cp != '(')
-	    return CALLFUNC(g, handle_error) (g, cp, "(");
-	do {
-	    DO (cp = parse_variable (g, cp + 1, &var));
-	    SKIPSPACE (cp);
-	} while (*cp && *cp != ')');
-	if (*cp != ')')
-	    return CALLFUNC(g, handle_error) (g, cp, ")");
-	*valp = 1; /* XXX */
-	return cp + 1;
-
-      case '\'':
-	DO (cp = parse_character (g, cp + 1, valp));
-	if (*cp != '\'')
-	    return CALLFUNC(g, handle_error) (g, cp, "'");
-	return cp + 1;
-
-      case 'd':
-	if (strncmp (cp, "defined", 7) == 0 && !isalnum(cp[7])) {
-	    int paren = 0;
-	    int len;
-
-	    cp += 7;
-	    SKIPSPACE (cp);
-	    if (*cp == '(') {
-		paren = 1;
-		cp++;
-	    }
-	    DO (cp = parse_variable (g, cp, &var));
-	    len = cp - var;
-	    SKIPSPACE (cp);
-	    if (paren && *cp != ')')
-		return CALLFUNC(g, handle_error) (g, cp, ")");
-	    *valp = (*(g->funcs.eval_defined)) (g, var, len);
-	    return cp + paren;		/* skip the right paren */
-	}
-	/* fall out */
-    }
-
-    if (isdigit(*cp)) {
-	DO (cp = parse_number (g, cp, valp));
-    } else if (!isvarfirstletter(*cp))
-	return CALLFUNC(g, handle_error) (g, cp, "variable or number");
-    else {
-	DO (cp = parse_variable (g, cp, &var));
-	varend = cp;
-	SKIPSPACE(cp);
-	if (*cp != '(') {
-	    *valp = (*(g->funcs.eval_variable)) (g, var, varend - var);
-	} else {
-	    do {
-		long dummy;
-		DO (cp = ParseIfExpression (g, cp + 1, &dummy));
-		SKIPSPACE(cp);
-		if (*cp == ')')
-		    break;
-		if (*cp != ',')
-		    return CALLFUNC(g, handle_error) (g, cp, ",");
-	    } while (1);
-
-	    *valp = 1;	/* XXX */
-	    cp++;
-	}
-    }
-    
-    return cp;
-}
-
-
-
-static const char *
-parse_product (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_value (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '*':
-	DO (cp = parse_product (g, cp + 1, &rightval));
-	*valp = (*valp * rightval);
-	break;
-
-      case '/':
-	DO (cp = parse_product (g, cp + 1, &rightval));
-	if (rightval == 0)
-	  return CALLFUNC(g, handle_error) (g, cp, "0");
-	*valp = (*valp / rightval);
-	break;
-
-      case '%':
-	DO (cp = parse_product (g, cp + 1, &rightval));
-	*valp = (*valp % rightval);
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_sum (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_product (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '+':
-	DO (cp = parse_sum (g, cp + 1, &rightval));
-	*valp = (*valp + rightval);
-	break;
-
-      case '-':
-	DO (cp = parse_sum (g, cp + 1, &rightval));
-	*valp = (*valp - rightval);
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_shift (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_sum (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '<':
-	if (cp[1] == '<') {
-	    DO (cp = parse_shift (g, cp + 2, &rightval));
-	    *valp = (*valp << rightval);
-	}
-	break;
-
-      case '>':
-	if (cp[1] == '>') {
-	    DO (cp = parse_shift (g, cp + 2, &rightval));
-	    *valp = (*valp >> rightval);
-	}
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_inequality (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_shift (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '<':
-	if (cp[1] == '=') {
-	    DO (cp = parse_inequality (g, cp + 2, &rightval));
-	    *valp = (*valp <= rightval);
-	} else {
-	    DO (cp = parse_inequality (g, cp + 1, &rightval));
-	    *valp = (*valp < rightval);
-	}
-	break;
-
-      case '>':
-	if (cp[1] == '=') {
-	    DO (cp = parse_inequality (g, cp + 2, &rightval));
-	    *valp = (*valp >= rightval);
-	} else {
-	    DO (cp = parse_inequality (g, cp + 1, &rightval));
-	    *valp = (*valp > rightval);
-	}
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_equality (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_inequality (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '=':
-	if (cp[1] == '=')
-	    cp++;
-	DO (cp = parse_equality (g, cp + 1, &rightval));
-	*valp = (*valp == rightval);
-	break;
-
-      case '!':
-	if (cp[1] != '=')
-	    break;
-	DO (cp = parse_equality (g, cp + 2, &rightval));
-	*valp = (*valp != rightval);
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_band (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_equality (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '&':
-	if (cp[1] != '&') {
-	    DO (cp = parse_band (g, cp + 1, &rightval));
-	    *valp = (*valp & rightval);
-	}
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_bxor (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_band (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '^':
-	DO (cp = parse_bxor (g, cp + 1, &rightval));
-	*valp = (*valp ^ rightval);
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_bor (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_bxor (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '|':
-	if (cp[1] != '|') {
-	    DO (cp = parse_bor (g, cp + 1, &rightval));
-	    *valp = (*valp | rightval);
-	}
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_land (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_bor (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '&':
-	if (cp[1] != '&')
-	    return CALLFUNC(g, handle_error) (g, cp, "&&");
-	DO (cp = parse_land (g, cp + 2, &rightval));
-	*valp = (*valp && rightval);
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_lor (IfParser *g, const char *cp, long *valp)
-{
-    long rightval;
-
-    DO (cp = parse_land (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '|':
-	if (cp[1] != '|')
-	    return CALLFUNC(g, handle_error) (g, cp, "||");
-	DO (cp = parse_lor (g, cp + 2, &rightval));
-	*valp = (*valp || rightval);
-	break;
-    }
-    return cp;
-}
-
-
-static const char *
-parse_cond(IfParser *g, const char *cp, long *valp)
-{
-    long trueval, falseval;
-
-    DO (cp = parse_lor (g, cp, valp));
-    SKIPSPACE (cp);
-
-    switch (*cp) {
-      case '?':
-	DO (cp = parse_cond (g, cp + 1, &trueval));
-	SKIPSPACE (cp);
-	if (*cp != ':')
-	    return CALLFUNC(g, handle_error) (g, cp, ":");
-	DO (cp = parse_cond (g, cp + 1, &falseval));
-	*valp = (*valp ? trueval : falseval);
-	break;
-    }
-    return cp;
-}
-
-
-/****************************************************************************
-			     External Entry Points
- ****************************************************************************/
-
-const char *
-ParseIfExpression (IfParser *g, const char *cp, long *valp)
-{
-    return parse_cond (g, cp, valp);
-}
diff --git a/nss/coreconf/mkdepend/ifparser.h b/nss/coreconf/mkdepend/ifparser.h
deleted file mode 100644
index 89d2a2f..0000000
--- a/nss/coreconf/mkdepend/ifparser.h
+++ /dev/null
@@ -1,83 +0,0 @@
-/*
- * $Xorg: ifparser.h,v 1.3 2000/08/17 19:41:51 cpqbld Exp $
- *
- * Copyright 1992 Network Computing Devices, Inc.
- * 
- * Permission to use, copy, modify, and distribute this software and its
- * documentation for any purpose and without fee is hereby granted, provided
- * that the above copyright notice appear in all copies and that both that
- * copyright notice and this permission notice appear in supporting
- * documentation, and that the name of Network Computing Devices may not be
- * used in advertising or publicity pertaining to distribution of the software
- * without specific, written prior permission.  Network Computing Devices makes
- * no representations about the suitability of this software for any purpose.
- * It is provided ``as is'' without express or implied warranty.
- * 
- * NETWORK COMPUTING DEVICES DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS
- * SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS,
- * IN NO EVENT SHALL NETWORK COMPUTING DEVICES BE LIABLE FOR ANY SPECIAL,
- * INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
- * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE
- * OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
- * PERFORMANCE OF THIS SOFTWARE.
- * 
- * Author:  Jim Fulton
- *          Network Computing Devices, Inc.
- * 
- * Simple if statement processor
- *
- * This module can be used to evaluate string representations of C language
- * if constructs.  It accepts the following grammar:
- * 
- *     EXPRESSION	:=	VALUE
- * 			 |	VALUE  BINOP	EXPRESSION
- *			 |	VALUE	'?'	EXPRESSION ':'	EXPRESSION
- * 
- *     VALUE		:=	'('  EXPRESSION  ')'
- * 			 |	'!'  VALUE
- * 			 |	'-'  VALUE
- *			 |	'~'  VALUE
- * 			 |	'defined'  '('  variable  ')'
- * 			 |	variable
- * 			 |	number
- * 
- *     BINOP		:=	'*'	|  '/'	|  '%'
- * 			 |	'+'	|  '-'
- * 			 |	'<<'	|  '>>'
- * 			 |	'<'	|  '>'	|  '<='  |  '>='
- * 			 |	'=='	|  '!='
- * 			 |	'&'	|  '^'  |  '|'
- * 			 |	'&&'	|  '||'
- * 
- * The normal C order of precedence is supported.
- * 
- * 
- * External Entry Points:
- * 
- *     ParseIfExpression		parse a string for #if
- */
-
-/* $XFree86: xc/config/makedepend/ifparser.h,v 3.5 2001/07/25 15:04:40 dawes Exp $ */
-
-#include <stdio.h>
-
-typedef int Bool;
-#define False 0
-#define True 1
-
-typedef struct _if_parser {
-    struct {				/* functions */
-	const char *(*handle_error) (struct _if_parser *, const char *,
-				     const char *);
-	long (*eval_variable) (struct _if_parser *, const char *, int);
-	int (*eval_defined) (struct _if_parser *, const char *, int);
-    } funcs;
-    char *data;
-} IfParser;
-
-const char *ParseIfExpression (
-    IfParser *, 
-    const char *, 
-    long *
-);
-
diff --git a/nss/coreconf/mkdepend/imakemdep.h b/nss/coreconf/mkdepend/imakemdep.h
deleted file mode 100644
index 7321972..0000000
--- a/nss/coreconf/mkdepend/imakemdep.h
+++ /dev/null
@@ -1,782 +0,0 @@
-
-/* $XConsortium: imakemdep.h,v 1.83 95/04/07 19:47:46 kaleb Exp $ */
-/* $XFree86: xc/config/imake/imakemdep.h,v 3.12 1995/07/08 10:22:17 dawes Exp $ */
-/*
-
-Copyright (c) 1993, 1994  X Consortium
-
-Permission is hereby granted, free of charge, to any person obtaining a copy
-of this software and associated documentation files (the "Software"), to deal
-in the Software without restriction, including without limitation the rights
-to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
-copies of the Software, and to permit persons to whom the Software is
-furnished to do so, subject to the following conditions:
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-X CONSORTIUM BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
-CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-
-Except as contained in this notice, the name of the X Consortium shall not be
-used in advertising or otherwise to promote the sale, use or other dealings
-in this Software without prior written authorization from the X Consortium.
-
-*/
-
-
-/* 
- * This file contains machine-dependent constants for the imake utility.
- * When porting imake, read each of the steps below and add in any necessary
- * definitions.  In general you should *not* edit ccimake.c or imake.c!
- */
-
-#ifdef CCIMAKE
-/*
- * Step 1:  imake_ccflags
- *     Define any special flags that will be needed to get imake.c to compile.
- *     These will be passed to the compile along with the contents of the
- *     make variable BOOTSTRAPCFLAGS.
- */
-#ifdef hpux
-#ifdef hp9000s800
-#define imake_ccflags "-DSYSV"
-#else
-#define imake_ccflags "-Wc,-Nd4000,-Ns3000 -DSYSV"
-#endif
-#endif
-
-#if defined(macII) || defined(_AUX_SOURCE)
-#define imake_ccflags "-DmacII -DSYSV"
-#endif
-
-#ifdef stellar
-#define imake_ccflags "-DSYSV"
-#endif
-
-#if defined(USL) || defined(Oki) || defined(NCR)
-#define imake_ccflags "-Xc -DSVR4"
-#endif
-
-#ifdef sony
-#if defined(SYSTYPE_SYSV) || defined(_SYSTYPE_SYSV)
-#define imake_ccflags "-DSVR4"
-#else
-#include <sys/param.h>
-#if NEWSOS < 41
-#define imake_ccflags "-Dbsd43 -DNOSTDHDRS"
-#else
-#if NEWSOS < 42
-#define imake_ccflags "-Dbsd43"
-#endif
-#endif
-#endif
-#endif
-
-#ifdef _CRAY
-#define imake_ccflags "-DSYSV -DUSG"
-#endif
-
-#if defined(_IBMR2) || defined(aix)
-#define imake_ccflags "-Daix -DSYSV"
-#endif
-
-#ifdef Mips
-#  if defined(SYSTYPE_BSD) || defined(BSD) || defined(BSD43)
-#    define imake_ccflags "-DBSD43"
-#  else 
-#    define imake_ccflags "-DSYSV"
-#  endif
-#endif 
-
-#ifdef is68k
-#define imake_ccflags "-Dluna -Duniosb"
-#endif
-
-#ifdef SYSV386
-# ifdef SVR4
-#  define imake_ccflags "-Xc -DSVR4"
-# else
-#  define imake_ccflags "-DSYSV"
-# endif
-#endif
-
-#ifdef SVR4
-# ifdef i386
-#  define imake_ccflags "-Xc -DSVR4"
-# endif
-#endif
-
-#ifdef SYSV
-# ifdef i386
-#  define imake_ccflags "-DSYSV"
-# endif
-#endif
-
-#ifdef __convex__
-#define imake_ccflags "-fn -tm c1"
-#endif
-
-#ifdef apollo
-#define imake_ccflags "-DX_NOT_POSIX"
-#endif
-
-#ifdef WIN32
-#define imake_ccflags "-nologo -batch -D__STDC__"
-#endif
-
-#ifdef __uxp__
-#define imake_ccflags "-DSVR4 -DANSICPP"
-#endif
-
-#ifdef __sxg__
-#define imake_ccflags "-DSYSV -DUSG -DNOSTDHDRS"
-#endif
-
-#ifdef sequent
-#define imake_ccflags "-DX_NOT_STDC_ENV -DX_NOT_POSIX"
-#endif
-
-#ifdef _SEQUENT_
-#define imake_ccflags "-DSYSV -DUSG"
-#endif
-
-#if defined(SX) || defined(PC_UX)
-#define imake_ccflags "-DSYSV"
-#endif
-
-#ifdef nec_ews_svr2
-#define imake_ccflags "-DUSG"
-#endif
-
-#if defined(nec_ews_svr4) || defined(_nec_ews_svr4) || defined(_nec_up) || defined(_nec_ft)
-#define imake_ccflags "-DSVR4"
-#endif
-
-#ifdef	MACH
-#define imake_ccflags "-DNOSTDHDRS"
-#endif
-
-/* this is for OS/2 under EMX. This won't work with DOS */
-#if defined(__EMX__) 
-#define imake_ccflags "-DBSD43"
-#endif
-
-#else /* not CCIMAKE */
-#ifndef MAKEDEPEND
-/*
- * Step 2:  dup2
- *     If your OS doesn't have a dup2() system call to duplicate one file
- *     descriptor onto another, define such a mechanism here (if you don't
- *     already fall under the existing category(ies).
- */
-#if defined(SYSV) && !defined(_CRAY) && !defined(Mips) && !defined(_SEQUENT_)
-#define	dup2(fd1,fd2)	((fd1 == fd2) ? fd1 : (close(fd2), \
-					       fcntl(fd1, F_DUPFD, fd2)))
-#endif
-
-
-/*
- * Step 3:  FIXUP_CPP_WHITESPACE
- *     If your cpp collapses tabs macro expansions into a single space and
- *     replaces escaped newlines with a space, define this symbol.  This will
- *     cause imake to attempt to patch up the generated Makefile by looking
- *     for lines that have colons in them (this is why the rules file escapes
- *     all colons).  One way to tell if you need this is to see whether or not
- *     your Makefiles have no tabs in them and lots of @@ strings.
- */
-#if defined(sun) || defined(SYSV) || defined(SVR4) || defined(hcx) || defined(WIN32) || (defined(AMOEBA) && defined(CROSS_COMPILE))
-#define FIXUP_CPP_WHITESPACE
-#endif
-#ifdef WIN32
-#define REMOVE_CPP_LEADSPACE
-#define INLINE_SYNTAX
-#define MAGIC_MAKE_VARS
-#endif
-#ifdef __minix_vmd
-#define FIXUP_CPP_WHITESPACE
-#endif
-
-/*
- * Step 4:  USE_CC_E, DEFAULT_CC, DEFAULT_CPP
- *     If you want to use cc -E instead of cpp, define USE_CC_E.
- *     If use cc -E but want a different compiler, define DEFAULT_CC.
- *     If the cpp you need is not in /lib/cpp, define DEFAULT_CPP.
- */
-#ifdef hpux
-#define USE_CC_E
-#endif
-#ifdef WIN32
-#define USE_CC_E
-#define DEFAULT_CC "cl"
-#endif
-#ifdef apollo
-#define DEFAULT_CPP "/usr/lib/cpp"
-#endif
-#if defined(_IBMR2) && !defined(DEFAULT_CPP)
-#define DEFAULT_CPP "/usr/lpp/X11/Xamples/util/cpp/cpp"
-#endif
-#if defined(sun) && defined(SVR4)
-#define DEFAULT_CPP "/usr/ccs/lib/cpp"
-#endif
-#ifdef __bsdi__
-#define DEFAULT_CPP "/usr/bin/cpp"
-#endif
-#ifdef __uxp__
-#define DEFAULT_CPP "/usr/ccs/lib/cpp"
-#endif
-#ifdef __sxg__
-#define DEFAULT_CPP "/usr/lib/cpp"
-#endif
-#ifdef _CRAY
-#define DEFAULT_CPP "/lib/pcpp"
-#endif
-#if defined(__386BSD__) || defined(__NetBSD__) || defined(__FreeBSD__) || defined(__OpenBSD__)
-#define DEFAULT_CPP "/usr/libexec/cpp"
-#endif
-#ifdef	MACH
-#define USE_CC_E
-#endif
-#ifdef __minix_vmd
-#define DEFAULT_CPP "/usr/lib/cpp"
-#endif
-#if defined(__EMX__)
-/* expects cpp in PATH */
-#define DEFAULT_CPP "cpp"
-#endif
-
-/*
- * Step 5:  cpp_argv
- *     The following table contains the flags that should be passed
- *     whenever a Makefile is being generated.  If your preprocessor 
- *     doesn't predefine any unique symbols, choose one and add it to the
- *     end of this table.  Then, do the following:
- * 
- *         a.  Use this symbol in Imake.tmpl when setting MacroFile.
- *         b.  Put this symbol in the definition of BootstrapCFlags in your
- *             <platform>.cf file.
- *         c.  When doing a make World, always add "BOOTSTRAPCFLAGS=-Dsymbol" 
- *             to the end of the command line.
- * 
- *     Note that you may define more than one symbol (useful for platforms 
- *     that support multiple operating systems).
- */
-
-#define	ARGUMENTS 50	/* number of arguments in various arrays */
-char *cpp_argv[ARGUMENTS] = {
-	"cc",		/* replaced by the actual program to exec */
-	"-I.",		/* add current directory to include path */
-#ifdef unix
-	"-Uunix",	/* remove unix symbol so that filename unix.c okay */
-#endif
-#if defined(__386BSD__) || defined(__NetBSD__) || defined(__FreeBSD__) || defined(__OpenBSD__) || defined(MACH)
-# ifdef __i386__
-	"-D__i386__",
-# endif
-# ifdef __x86_64__
-	"-D__x86_64__",
-# endif
-# ifdef __GNUC__
-	"-traditional",
-# endif
-#endif
-#ifdef M4330
-	"-DM4330",	/* Tektronix */
-#endif
-#ifdef M4310
-	"-DM4310",	/* Tektronix */
-#endif
-#if defined(macII) || defined(_AUX_SOURCE)
-	"-DmacII",	/* Apple A/UX */
-#endif
-#ifdef USL
-	"-DUSL",	/* USL */
-#endif
-#ifdef sony
-	"-Dsony",	/* Sony */
-#if !defined(SYSTYPE_SYSV) && !defined(_SYSTYPE_SYSV) && NEWSOS < 42
-	"-Dbsd43",
-#endif
-#endif
-#ifdef _IBMR2
-	"-D_IBMR2",	/* IBM RS-6000 (we ensured that aix is defined above */
-#ifndef aix
-#define aix		/* allow BOOTSTRAPCFLAGS="-D_IBMR2" */
-#endif
-#endif /* _IBMR2 */
-#ifdef aix
-	"-Daix",	/* AIX instead of AOS */
-#ifndef ibm
-#define ibm		/* allow BOOTSTRAPCFLAGS="-Daix" */
-#endif
-#endif /* aix */
-#ifdef ibm
-	"-Dibm",	/* IBM PS/2 and RT under both AOS and AIX */
-#endif
-#ifdef luna
-	"-Dluna",	/* OMRON luna 68K and 88K */
-#ifdef luna1
-	"-Dluna1",
-#endif
-#ifdef luna88k		/* need not on UniOS-Mach Vers. 1.13 */
-	"-traditional", /* for some older version            */
-#endif			/* instead of "-DXCOMM=\\#"          */
-#ifdef uniosb
-	"-Duniosb",
-#endif
-#ifdef uniosu
-	"-Duniosu",
-#endif
-#endif /* luna */
-#ifdef _CRAY		/* Cray */
-	"-Ucray",
-#endif
-#ifdef Mips
-	"-DMips",	/* Define and use Mips for Mips Co. OS/mach. */
-# if defined(SYSTYPE_BSD) || defined(BSD) || defined(BSD43)
-	"-DBSD43",	/* Mips RISCOS supports two environments */
-# else
-	"-DSYSV",	/* System V environment is the default */
-# endif
-#endif /* Mips */
-#ifdef MOTOROLA
-	"-DMOTOROLA",    /* Motorola Delta Systems */
-# ifdef SYSV
-	"-DSYSV", 
-# endif
-# ifdef SVR4
-	"-DSVR4",
-# endif
-#endif /* MOTOROLA */
-#ifdef i386
-	"-Di386",
-# ifdef SVR4
-	"-DSVR4",
-# endif
-# ifdef SYSV
-	"-DSYSV",
-#  ifdef ISC
-	"-DISC",
-#   ifdef ISC40
-	"-DISC40",       /* ISC 4.0 */
-#   else
-#    ifdef ISC202
-	"-DISC202",      /* ISC 2.0.2 */
-#    else
-#     ifdef ISC30
-	"-DISC30",       /* ISC 3.0 */
-#     else
-	"-DISC22",       /* ISC 2.2.1 */
-#     endif
-#    endif
-#   endif
-#  endif
-#  ifdef SCO
-	"-DSCO",
-#   ifdef SCO324
-	"-DSCO324",
-#   endif
-#  endif
-# endif
-# ifdef ESIX
-	"-DESIX",
-# endif
-# ifdef ATT
-	"-DATT",
-# endif
-# ifdef DELL
-	"-DDELL",
-# endif
-#endif
-#ifdef SYSV386           /* System V/386 folks, obsolete */
-	"-Di386",
-# ifdef SVR4
-	"-DSVR4",
-# endif
-# ifdef ISC
-	"-DISC",
-#  ifdef ISC40
-	"-DISC40",       /* ISC 4.0 */
-#  else
-#   ifdef ISC202
-	"-DISC202",      /* ISC 2.0.2 */
-#   else
-#    ifdef ISC30
-	"-DISC30",       /* ISC 3.0 */
-#    else
-	"-DISC22",       /* ISC 2.2.1 */
-#    endif
-#   endif
-#  endif
-# endif
-# ifdef SCO
-	"-DSCO",
-#  ifdef SCO324
-	"-DSCO324",
-#  endif
-# endif
-# ifdef ESIX
-	"-DESIX",
-# endif
-# ifdef ATT
-	"-DATT",
-# endif
-# ifdef DELL
-	"-DDELL",
-# endif
-#endif
-#ifdef __osf__
-	"-D__osf__",
-# ifdef __mips__
-	"-D__mips__",
-# endif
-# ifdef __alpha
-	"-D__alpha",
-# endif
-# ifdef __i386__
-	"-D__i386__",
-# endif
-# ifdef __GNUC__
-	"-traditional",
-# endif
-#endif
-#ifdef Oki
-	"-DOki",
-#endif
-#ifdef sun
-#ifdef SVR4
-	"-DSVR4",
-#endif
-#endif
-#ifdef WIN32
-	"-DWIN32",
-	"-nologo",
-	"-batch",
-	"-D__STDC__",
-#endif
-#ifdef NCR
-	"-DNCR",	/* NCR */
-#endif
-#ifdef linux
-        "-traditional",
-        "-Dlinux",
-#endif
-#ifdef __uxp__
-	"-D__uxp__",
-#endif
-#ifdef __sxg__
-	"-D__sxg__",
-#endif
-#ifdef nec_ews_svr2
-	"-Dnec_ews_svr2",
-#endif
-#ifdef AMOEBA
-	"-DAMOEBA",
-# ifdef CROSS_COMPILE
-	"-DCROSS_COMPILE",
-#  ifdef CROSS_i80386
-	"-Di80386",
-#  endif
-#  ifdef CROSS_sparc
-	"-Dsparc",
-#  endif
-#  ifdef CROSS_mc68000
-	"-Dmc68000",
-#  endif
-# else
-#  ifdef i80386
-	"-Di80386",
-#  endif
-#  ifdef sparc
-	"-Dsparc",
-#  endif
-#  ifdef mc68000
-	"-Dmc68000",
-#  endif
-# endif
-#endif
-#ifdef __minix_vmd
-        "-Dminix",
-#endif
-
-#if defined(__EMX__)
-	"-traditional",
-	"-Demxos2",
-#endif
-
-};
-#else /* else MAKEDEPEND */
-/*
- * Step 6:  predefs
- *     If your compiler and/or preprocessor define any specific symbols, add
- *     them to the the following table.  The definition of struct symtab is
- *     in util/makedepend/def.h.
- */
-#define QUOTEIT(x) #x
-#define QUOTEEXPANSION(x) QUOTEIT(x)
-
-struct symtab	predefs[] = {
-#ifdef apollo
-	{"apollo", "1"},
-#endif
-#ifdef ibm032
-	{"ibm032", "1"},
-#endif
-#ifdef ibm
-	{"ibm", "1"},
-#endif
-#ifdef aix
-	{"aix", "1"},
-#endif
-#ifdef sun
-	{"sun", "1"},
-#endif
-#ifdef sun2
-	{"sun2", "1"},
-#endif
-#ifdef sun3
-	{"sun3", "1"},
-#endif
-#ifdef sun4
-	{"sun4", "1"},
-#endif
-#ifdef sparc
-	{"sparc", "1"},
-#endif
-#ifdef __sparc__
-	{"__sparc__", "1"},
-#endif
-#ifdef hpux
-	{"hpux", "1"},
-#endif
-#ifdef __hpux
-	{"__hpux", "1"},
-#endif
-#ifdef __hp9000s800
-	{"__hp9000s800", "1"},
-#endif
-#ifdef __hp9000s700
-	{"__hp9000s700", "1"},
-#endif
-#ifdef vax
-	{"vax", "1"},
-#endif
-#ifdef VMS
-	{"VMS", "1"},
-#endif
-#ifdef cray
-	{"cray", "1"},
-#endif
-#ifdef CRAY
-	{"CRAY", "1"},
-#endif
-#ifdef _CRAY
-	{"_CRAY", "1"},
-#endif
-#ifdef att
-	{"att", "1"},
-#endif
-#ifdef mips
-	{"mips", "1"},
-#endif
-#ifdef __mips__
-	{"__mips__", "1"},
-#endif
-#ifdef ultrix
-	{"ultrix", "1"},
-#endif
-#ifdef stellar
-	{"stellar", "1"},
-#endif
-#ifdef mc68000
-	{"mc68000", "1"},
-#endif
-#ifdef mc68020
-	{"mc68020", "1"},
-#endif
-#ifdef __GNUC__
-	{"__GNUC__", "1"},
-#endif
-#if __STDC__
-	{"__STDC__", "1"},
-#endif
-#ifdef __HIGHC__
-	{"__HIGHC__", "1"},
-#endif
-#ifdef CMU
-	{"CMU", "1"},
-#endif
-#ifdef luna
-	{"luna", "1"},
-#ifdef luna1
-	{"luna1", "1"},
-#endif
-#ifdef luna2
-	{"luna2", "1"},
-#endif
-#ifdef luna88k
-	{"luna88k", "1"},
-#endif
-#ifdef uniosb
-	{"uniosb", "1"},
-#endif
-#ifdef uniosu
-	{"uniosu", "1"},
-#endif
-#endif
-#ifdef ieeep754
-	{"ieeep754", "1"},
-#endif
-#ifdef is68k
-	{"is68k", "1"},
-#endif
-#ifdef m68k
-        {"m68k", "1"},
-#endif
-#ifdef m88k
-        {"m88k", "1"},
-#endif
-#ifdef __m88k__
-	{"__m88k__", "1"},
-#endif
-#ifdef bsd43
-	{"bsd43", "1"},
-#endif
-#ifdef hcx
-	{"hcx", "1"},
-#endif
-#ifdef sony
-	{"sony", "1"},
-#ifdef SYSTYPE_SYSV
-	{"SYSTYPE_SYSV", "1"},
-#endif
-#ifdef _SYSTYPE_SYSV
-	{"_SYSTYPE_SYSV", "1"},
-#endif
-#endif
-#ifdef __OSF__
-	{"__OSF__", "1"},
-#endif
-#ifdef __osf__
-	{"__osf__", "1"},
-#endif
-#ifdef __alpha
-	{"__alpha", "1"},
-#endif
-#ifdef __DECC
-	{"__DECC",  "1"},
-#endif
-#ifdef __decc
-	{"__decc",  "1"},
-#endif
-#ifdef __uxp__
-	{"__uxp__", "1"},
-#endif
-#ifdef __sxg__
-	{"__sxg__", "1"},
-#endif
-#ifdef _SEQUENT_
-	{"_SEQUENT_", "1"},
-	{"__STDC__", "1"},
-#endif
-#ifdef __bsdi__
-	{"__bsdi__", "1"},
-#endif
-#ifdef nec_ews_svr2
-	{"nec_ews_svr2", "1"},
-#endif
-#ifdef nec_ews_svr4
-	{"nec_ews_svr4", "1"},
-#endif
-#ifdef _nec_ews_svr4
-	{"_nec_ews_svr4", "1"},
-#endif
-#ifdef _nec_up
-	{"_nec_up", "1"},
-#endif
-#ifdef SX
-	{"SX", "1"},
-#endif
-#ifdef nec
-	{"nec", "1"},
-#endif
-#ifdef _nec_ft
-	{"_nec_ft", "1"},
-#endif
-#ifdef PC_UX
-	{"PC_UX", "1"},
-#endif
-#ifdef sgi
-	{"sgi", "1"},
-#endif
-#ifdef __sgi
-	{"__sgi", "1"},
-#endif
-#ifdef __FreeBSD__
-	{"__FreeBSD__", "1"},
-#endif
-#ifdef __NetBSD__
-	{"__NetBSD__", "1"},
-#endif
-#ifdef __OpenBSD__
-	{"__OpenBSD__", "1"},
-#endif
-#ifdef __EMX__
-	{"__EMX__", "1"},
-#endif
-	/* ADDED THE FOLLOWING SYMBOLS FOR WINDOWS */
-#ifdef _WIN32
-	{"_WIN32", QUOTEEXPANSION(_WIN32) },
-#endif
-#ifdef _WIN64
-	{"_WIN64", QUOTEEXPANSION(_WIN64) },
-#endif
-#ifdef _X86
-	{"_X86", QUOTEEXPANSION(_X86) },
-#endif
-#ifdef _X86_
-	{"_X86_", QUOTEEXPANSION(_X86_) },
-#endif
-#ifdef _X86_64
-	{"_X86_64", QUOTEEXPANSION(_X86_64) },
-#endif
-#ifdef _X86_64_
-	{"_X86_64_", QUOTEEXPANSION(_X86_64_) },
-#endif
-#ifdef _DEBUG
-	{"_DEBUG", QUOTEEXPANSION(_DEBUG) },
-#endif
-#ifdef _DLL
-	{"_DLL", QUOTEEXPANSION(_DLL) },
-#endif
-#ifdef _M_IX86
-	{"_M_IX86", QUOTEEXPANSION(_M_IX86) },
-#endif
-#ifdef _M_X64
-	{"_M_X64", QUOTEEXPANSION(_M_X64) },
-#endif
-#ifdef _MSC_FULL_VER
-	{"_MSC_FULL_VER", QUOTEEXPANSION(_MSC_FULL_VER) },
-#endif
-#ifdef _MSC_VER
-	{"_MSC_VER", QUOTEEXPANSION(_MSC_VER) },
-#endif
-#ifdef _MSVC_RUNTIME_CHECKS
-	{"_MSVC_RUNTIME_CHECKS", QUOTEEXPANSION(_MSVC_RUNTIME_CHECKS) },
-#endif
-#ifdef _MT
-	{"_MT", QUOTEEXPANSION(_MT) },
-#endif
-#ifdef _CHAR_UNSIGNED
-	{"_CHAR_UNSIGNED", QUOTEEXPANSION(_CHAR_UNSIGNED) },
-#endif
-	/* add any additional symbols before this line */
-	{NULL, NULL}
-};
-
-#endif /* MAKEDEPEND */
-#endif /* CCIMAKE */
diff --git a/nss/coreconf/mkdepend/include.c b/nss/coreconf/mkdepend/include.c
deleted file mode 100644
index 3b89f26..0000000
--- a/nss/coreconf/mkdepend/include.c
+++ /dev/null
@@ -1,337 +0,0 @@
-/* $Xorg: include.c,v 1.4 2001/02/09 02:03:16 xorgcvs Exp $ */
-/*
-
-Copyright (c) 1993, 1994, 1998 The Open Group
-
-Permission to use, copy, modify, distribute, and sell this software and its
-documentation for any purpose is hereby granted without fee, provided that
-the above copyright notice appear in all copies and that both that
-copyright notice and this permission notice appear in supporting
-documentation.
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
-CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-
-Except as contained in this notice, the name of The Open Group shall not be
-used in advertising or otherwise to promote the sale, use or other dealings
-in this Software without prior written authorization from The Open Group.
-
-*/
-/* $XFree86: xc/config/makedepend/include.c,v 3.7 2001/12/14 19:53:20 dawes Exp $ */
-
-
-#include "def.h"
-
-#ifdef _MSC_VER
-#include <windows.h>
-static int
-does_file_exist(char *file)
-{
-  WIN32_FILE_ATTRIBUTE_DATA data;
-  BOOL b = GetFileAttributesExA(file, GetFileExInfoStandard, &data);
-  if (!b)
-    return 0;
-  return (data.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) == 0;
-}
-#else
-static int
-does_file_exist(char *file)
-{
-  struct stat sb;
-  return stat(file, &sb) == 0 && !S_ISDIR(sb.st_mode);
-}
-#endif
-
-extern struct	inclist	inclist[ MAXFILES ],
-			*inclistp, *inclistnext;
-extern char	*includedirs[ ],
-		**includedirsnext;
-extern char	*notdotdot[ ];
-extern boolean show_where_not;
-extern boolean warn_multiple;
-
-static boolean
-isdot(char *p)
-{
-	if(p && *p++ == '.' && *p++ == '\0')
-		return(TRUE);
-	return(FALSE);
-}
-
-static boolean
-isdotdot(char *p)
-{
-	if(p && *p++ == '.' && *p++ == '.' && *p++ == '\0')
-		return(TRUE);
-	return(FALSE);
-}
-
-static boolean
-issymbolic(char *dir, char *component)
-{
-#ifdef S_IFLNK
-	struct stat	st;
-	char	buf[ BUFSIZ ], **pp;
-
-	sprintf(buf, "%s%s%s", dir, *dir ? "/" : "", component);
-	for (pp=notdotdot; *pp; pp++)
-		if (strcmp(*pp, buf) == 0)
-			return (TRUE);
-	if (lstat(buf, &st) == 0
-	&& (st.st_mode & S_IFMT) == S_IFLNK) {
-		*pp++ = copy(buf);
-		if (pp >= &notdotdot[ MAXDIRS ])
-			fatalerr("out of .. dirs, increase MAXDIRS\n");
-		return(TRUE);
-	}
-#endif
-	return(FALSE);
-}
-
-/*
- * Occasionally, pathnames are created that look like .../x/../y
- * Any of the 'x/..' sequences within the name can be eliminated.
- * (but only if 'x' is not a symbolic link!!)
- */
-static void
-remove_dotdot(char *path)
-{
-	register char	*end, *from, *to, **cp;
-	char		*components[ MAXFILES ],
-			newpath[ BUFSIZ ];
-	boolean		component_copied;
-
-	/*
-	 * slice path up into components.
-	 */
-	to = newpath;
-	if (*path == '/')
-		*to++ = '/';
-	*to = '\0';
-	cp = components;
-	for (from=end=path; *end; end++)
-		if (*end == '/') {
-			while (*end == '/')
-				*end++ = '\0';
-			if (*from)
-				*cp++ = from;
-			from = end;
-		}
-	*cp++ = from;
-	*cp = NULL;
-
-	/*
-	 * Recursively remove all 'x/..' component pairs.
-	 */
-	cp = components;
-	while(*cp) {
-		if (!isdot(*cp) && !isdotdot(*cp) && isdotdot(*(cp+1))
-		    && !issymbolic(newpath, *cp))
-		{
-		    char **fp = cp + 2;
-		    char **tp = cp;
-
-		    do 
-			*tp++ = *fp; /* move all the pointers down */
-		    while (*fp++);
-		    if (cp != components)
-			cp--;	/* go back and check for nested ".." */
-		} else {
-		    cp++;
-		}
-	}
-	/*
-	 * Concatenate the remaining path elements.
-	 */
-	cp = components;
-	component_copied = FALSE;
-	while(*cp) {
-		if (component_copied)
-			*to++ = '/';
-		component_copied = TRUE;
-		for (from = *cp; *from; )
-			*to++ = *from++;
-		*to = '\0';
-		cp++;
-	}
-	*to++ = '\0';
-
-	/*
-	 * copy the reconstituted path back to our pointer.
-	 */
-	strcpy(path, newpath);
-}
-
-/*
- * Add an include file to the list of those included by 'file'.
- */
-struct inclist *
-newinclude(char *newfile, char *incstring)
-{
-	register struct inclist	*ip;
-
-	/*
-	 * First, put this file on the global list of include files.
-	 */
-	ip = inclistp++;
-	if (inclistp == inclist + MAXFILES - 1)
-		fatalerr("out of space: increase MAXFILES\n");
-	ip->i_file = copy(newfile);
-
-	if (incstring == NULL)
-		ip->i_incstring = ip->i_file;
-	else
-		ip->i_incstring = copy(incstring);
-
-	inclistnext = inclistp;
-	return(ip);
-}
-
-void
-included_by(struct inclist *ip, struct inclist *newfile)
-{
-	register int i;
-
-	if (ip == NULL)
-		return;
-	/*
-	 * Put this include file (newfile) on the list of files included
-	 * by 'file'.  If 'file' is NULL, then it is not an include
-	 * file itself (i.e. was probably mentioned on the command line).
-	 * If it is already on the list, don't stick it on again.
-	 */
-	if (ip->i_list == NULL) {
-		ip->i_list = (struct inclist **)
-			malloc(sizeof(struct inclist *) * ++ip->i_listlen);
-		ip->i_merged = (boolean *)
-		    malloc(sizeof(boolean) * ip->i_listlen);
-	} else {
-		for (i=0; i<ip->i_listlen; i++)
-			if (ip->i_list[ i ] == newfile) {
-			    i = strlen(newfile->i_file);
-			    if (!(ip->i_flags & INCLUDED_SYM) &&
-				!(i > 2 &&
-				  newfile->i_file[i-1] == 'c' &&
-				  newfile->i_file[i-2] == '.'))
-			    {
-				/* only bitch if ip has */
-				/* no #include SYMBOL lines  */
-				/* and is not a .c file */
-				if (warn_multiple)
-				{
-					warning("%s includes %s more than once!\n",
-						ip->i_file, newfile->i_file);
-					warning1("Already have\n");
-					for (i=0; i<ip->i_listlen; i++)
-						warning1("\t%s\n", ip->i_list[i]->i_file);
-				}
-			    }
-			    return;
-			}
-		ip->i_list = (struct inclist **) realloc(ip->i_list,
-			sizeof(struct inclist *) * ++ip->i_listlen);
-		ip->i_merged = (boolean *)
-		    realloc(ip->i_merged, sizeof(boolean) * ip->i_listlen);
-	}
-	ip->i_list[ ip->i_listlen-1 ] = newfile;
-	ip->i_merged[ ip->i_listlen-1 ] = FALSE;
-}
-
-void
-inc_clean (void)
-{
-	register struct inclist *ip;
-
-	for (ip = inclist; ip < inclistp; ip++) {
-		ip->i_flags &= ~MARKED;
-	}
-}
-
-struct inclist *
-inc_path(char *file, char *include, int type)
-{
-	static char		path[ BUFSIZ ];
-	register char		**pp, *p;
-	register struct inclist	*ip;
-
-	/*
-	 * Check all previously found include files for a path that
-	 * has already been expanded.
-	 */
-	if ((type == INCLUDE) || (type == INCLUDEDOT))
-		inclistnext = inclist;
-	ip = inclistnext;
-
-	for (; ip->i_file; ip++) {
-		if ((strcmp(ip->i_incstring, include) == 0) &&
-		    !(ip->i_flags & INCLUDED_SYM)) {
-			inclistnext = ip + 1;
-			return ip;
-		}
-	}
-
-	if (inclistnext == inclist) {
-		/*
-		 * If the path was surrounded by "" or is an absolute path,
-		 * then check the exact path provided.
-		 */
-		if ((type == INCLUDEDOT) ||
-		    (type == INCLUDENEXTDOT) ||
-		    (*include == '/')) {
-			if (does_file_exist(include))
-				return newinclude(include, include);
-			if (show_where_not)
-				warning1("\tnot in %s\n", include);
-		}
-
-		/*
-		 * If the path was surrounded by "" see if this include file is
-		 * in the directory of the file being parsed.
-		 */
-		if ((type == INCLUDEDOT) || (type == INCLUDENEXTDOT)) {
-			for (p=file+strlen(file); p>file; p--)
-				if (*p == '/')
-					break;
-			if (p == file) {
-				strcpy(path, include);
-			} else {
-				strncpy(path, file, (p-file) + 1);
-				path[ (p-file) + 1 ] = '\0';
-				strcpy(path + (p-file) + 1, include);
-			}
-			remove_dotdot(path);
-			if (does_file_exist(path))
-				return newinclude(path, include);
-			if (show_where_not)
-				warning1("\tnot in %s\n", path);
-		}
-	}
-
-	/*
-	 * Check the include directories specified.  Standard include dirs
-	 * should be at the end.
-	 */
-	if ((type == INCLUDE) || (type == INCLUDEDOT))
-		includedirsnext = includedirs;
-	pp = includedirsnext;
-
-	for (; *pp; pp++) {
-		sprintf(path, "%s/%s", *pp, include);
-		remove_dotdot(path);
-		if (does_file_exist(path)) {
-			includedirsnext = pp + 1;
-			return newinclude(path, include);
-		}
-		if (show_where_not)
-			warning1("\tnot in %s\n", path);
-	}
-
-	return NULL;
-}
diff --git a/nss/coreconf/mkdepend/main.c b/nss/coreconf/mkdepend/main.c
deleted file mode 100644
index d5485f7..0000000
--- a/nss/coreconf/mkdepend/main.c
+++ /dev/null
@@ -1,870 +0,0 @@
-/* $Xorg: main.c,v 1.5 2001/02/09 02:03:16 xorgcvs Exp $ */
-/*
-
-Copyright (c) 1993, 1994, 1998 The Open Group
-
-Permission to use, copy, modify, distribute, and sell this software and its
-documentation for any purpose is hereby granted without fee, provided that
-the above copyright notice appear in all copies and that both that
-copyright notice and this permission notice appear in supporting
-documentation.
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-THE OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
-CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-
-Except as contained in this notice, the name of The Open Group shall not be
-used in advertising or otherwise to promote the sale, use or other dealings
-in this Software without prior written authorization from The Open Group.
-
-*/
-/* $XFree86: xc/config/makedepend/main.c,v 3.32 2003/03/26 20:43:48 tsi Exp $ */
-
-#include "def.h"
-#ifdef hpux
-#define sigvec sigvector
-#endif /* hpux */
-
-#ifdef X_POSIX_C_SOURCE
-#define _POSIX_C_SOURCE X_POSIX_C_SOURCE
-#include <signal.h>
-#undef _POSIX_C_SOURCE
-#else
-#if defined(X_NOT_POSIX) || defined(_POSIX_SOURCE)
-#include <signal.h>
-#else
-#define _POSIX_SOURCE
-#include <signal.h>
-#undef _POSIX_SOURCE
-#endif
-#endif
-
-#include <stdarg.h>
-#ifdef _WIN32
-#include <io.h>
-#endif
-
-#ifdef MINIX
-#define USE_CHMOD	1
-#endif
-
-#ifdef DEBUG
-int	_debugmask;
-#endif
-
-/* #define DEBUG_DUMP */
-#ifdef DEBUG_DUMP
-#define DBG_PRINT(file, fmt, args)   fprintf(file, fmt, args)
-#else
-#define DBG_PRINT(file, fmt, args)   /* empty */
-#endif
-
-#define DASH_INC_PRE    "#include \""
-#define DASH_INC_POST   "\""
-
-char *ProgramName;
-
-char	*directives[] = {
-	"if",
-	"ifdef",
-	"ifndef",
-	"else",
-	"endif",
-	"define",
-	"undef",
-	"include",
-	"line",
-	"pragma",
-	"error",
-	"ident",
-	"sccs",
-	"elif",
-	"eject",
-	"warning",
-	"include_next",
-	NULL
-};
-
-#define MAKEDEPEND
-#include "imakemdep.h"	/* from config sources */
-#undef MAKEDEPEND
-
-struct	inclist inclist[ MAXFILES ],
-		*inclistp = inclist,
-		*inclistnext = inclist,
-		maininclist;
-
-static char	*filelist[ MAXFILES ];
-char		*includedirs[ MAXDIRS + 1 ],
-		**includedirsnext = includedirs;
-char		*notdotdot[ MAXDIRS ];
-static int	cmdinc_count = 0;
-static char	*cmdinc_list[ 2 * MAXINCFILES ];
-char		*objprefix = "";
-char		*objsuffix = OBJSUFFIX;
-static char	*startat = "# DO NOT DELETE";
-int		width = 78;
-static boolean	append = FALSE;
-boolean		printed = FALSE;
-boolean		verbose = FALSE;
-boolean		show_where_not = FALSE;
-/* Warn on multiple includes of same file */
-boolean 	warn_multiple = FALSE;
-
-static void setfile_cmdinc(struct filepointer *filep, long count, char **list);
-static void redirect(char *line, char *makefile);
-
-static
-#ifdef SIGNALRETURNSINT
-int
-#else
-void
-#endif
-catch (int sig)
-{
-	fflush (stdout);
-	fatalerr ("got signal %d\n", sig);
-}
-
-#if defined(USG) || (defined(i386) && defined(SYSV)) || defined(WIN32) || defined(__UNIXOS2__) || defined(Lynx_22) || defined(__CYGWIN__)
-#define USGISH
-#endif
-
-#ifndef USGISH
-#ifdef X_NOT_POSIX
-#define sigaction sigvec
-#define sa_handler sv_handler
-#define sa_mask sv_mask
-#define sa_flags sv_flags
-#endif
-struct sigaction sig_act;
-#endif /* USGISH */
-
-int
-main(int argc, char *argv[])
-{
-	char	**fp = filelist;
-	char	**incp = includedirs;
-	char	*p;
-	struct inclist	*ip;
-	char	*makefile = NULL;
-	struct filepointer	*filecontent;
-	struct symtab *psymp = predefs;
-	char *endmarker = NULL;
-	char *defincdir = NULL;
-	char **undeflist = NULL;
-	int numundefs = 0, i;
-	register char offset;
-
-	ProgramName = argv[0];
-
-	while (psymp->s_name)
-	{
-	    define2(psymp->s_name, psymp->s_value, &maininclist);
-	    psymp++;
-	}
-	if (argc == 2 && argv[1][0] == '@') {
-	    struct stat ast;
-	    int afd;
-	    char *args;
-	    char **nargv;
-	    int nargc;
-	    char quotechar = '\0';
-
-	    nargc = 1;
-	    if ((afd = open(argv[1]+1, O_RDONLY)) < 0)
-		fatalerr("cannot open \"%s\"\n", argv[1]+1);
-	    fstat(afd, &ast);
-	    args = (char *)malloc(ast.st_size + 1);
-	    if ((ast.st_size = read(afd, args, ast.st_size)) < 0)
-		fatalerr("failed to read %s\n", argv[1]+1);
-	    args[ast.st_size] = '\0';
-	    close(afd);
-	    for (p = args; *p; p++) {
-		if (quotechar) {
-		    if (quotechar == '\\' ||
-			(*p == quotechar && p[-1] != '\\'))
-			quotechar = '\0';
-		    continue;
-		}
-		switch (*p) {
-		case '\\':
-		case '"':
-		case '\'':
-		    quotechar = *p;
-		    break;
-		case ' ':
-		case '\n':
-		    *p = '\0';
-		    if (p > args && p[-1])
-			nargc++;
-		    break;
-		}
-	    }
-	    if (p[-1])
-		nargc++;
-	    nargv = (char **)malloc(nargc * sizeof(char *));
-	    nargv[0] = argv[0];
-	    argc = 1;
-	    for (p = args; argc < nargc; p += strlen(p) + 1)
-		if (*p) nargv[argc++] = p;
-	    argv = nargv;
-	}
-	for(argc--, argv++; argc; argc--, argv++) {
-	    	/* if looking for endmarker then check before parsing */
-		if (endmarker && strcmp (endmarker, *argv) == 0) {
-		    endmarker = NULL;
-		    continue;
-		}
-		if (**argv != '-') {
-			/* treat +thing as an option for C++ */
-			if (endmarker && **argv == '+')
-				continue;
-			*fp++ = argv[0];
-			continue;
-		}
-		switch(argv[0][1]) {
-		case '-':
-			endmarker = &argv[0][2];
-			if (endmarker[0] == '\0') endmarker = "--";
-			break;
-		case 'D':
-			offset = 2;
-			if (argv[0][2] == '\0') {
-				argv++;
-				argc--;
-				offset = 0;
-			}
-			/* offset +1 here since first def letter
-			 * cannot be `=`
-			 */
-			for (p = argv[0] + offset + 1; *p; p++)
-				if (*p == '=') {
-					*p = ' ';
-					break;
-				}
-			define(argv[0] + offset, &maininclist);
-			break;
-		case 'I':
-			if (incp >= includedirs + MAXDIRS)
-			    fatalerr("Too many -I flags.\n");
-			*incp++ = argv[0]+2;
-			if (**(incp-1) == '\0') {
-				*(incp-1) = *(++argv);
-				argc--;
-			}
-			break;
-		case 'U':
-			/* Undef's override all -D's so save them up */
-			numundefs++;
-			if (numundefs == 1)
-			    undeflist = malloc(sizeof(char *));
-			else
-			    undeflist = realloc(undeflist,
-						numundefs * sizeof(char *));
-			offset = 2;
-			if (argv[0][2] == '\0') {
-				argv++;
-				argc--;
-				offset = 0;
-			}
-			undeflist[numundefs - 1] = argv[0] + offset;
-			break;
-		case 'Y':
-			defincdir = argv[0]+2;
-			break;
-		/* do not use if endmarker processing */
-		case 'a':
-			if (endmarker) break;
-			append = TRUE;
-			break;
-		case 'w':
-			if (endmarker) break;
-			if (argv[0][2] == '\0') {
-				argv++;
-				argc--;
-				width = atoi(argv[0]);
-			} else
-				width = atoi(argv[0]+2);
-			break;
-		case 'o':
-			if (endmarker) break;
-			if (argv[0][2] == '\0') {
-				argv++;
-				argc--;
-				objsuffix = argv[0];
-			} else
-				objsuffix = argv[0]+2;
-			break;
-		case 'p':
-			if (endmarker) break;
-			if (argv[0][2] == '\0') {
-				argv++;
-				argc--;
-				objprefix = argv[0];
-			} else
-				objprefix = argv[0]+2;
-			break;
-		case 'v':
-			if (endmarker) break;
-			verbose = TRUE;
-#ifdef DEBUG
-			if (argv[0][2])
-				_debugmask = atoi(argv[0]+2);
-#endif
-			break;
-		case 's':
-			if (endmarker) break;
-			startat = argv[0]+2;
-			if (*startat == '\0') {
-				startat = *(++argv);
-				argc--;
-			}
-			if (*startat != '#')
-				fatalerr("-s flag's value should start %s\n",
-					"with '#'.");
-			break;
-		case 'f':
-			if (endmarker) break;
-			makefile = argv[0]+2;
-			if (*makefile == '\0') {
-				makefile = *(++argv);
-				argc--;
-			}
-			break;
-
-		case 'm':
-			warn_multiple = TRUE;
-			break;
-			
-		/* Ignore -O, -g so we can just pass ${CFLAGS} to
-		   makedepend
-		 */
-		case 'O':
-		case 'g':
-			break;
-		case 'i':
-			if (strcmp(&argv[0][1],"include") == 0) {
-				char *buf;
-				if (argc<2)
-					fatalerr("option -include is a "
-						 "missing its parameter\n");
-				if (cmdinc_count >= MAXINCFILES)
-					fatalerr("Too many -include flags.\n");
-				argc--;
-				argv++;
-				buf = malloc(strlen(DASH_INC_PRE) +
-					     strlen(argv[0]) +
-					     strlen(DASH_INC_POST) + 1);
-                		if(!buf)
-					fatalerr("out of memory at "
-						 "-include string\n");
-				cmdinc_list[2 * cmdinc_count + 0] = argv[0];
-				cmdinc_list[2 * cmdinc_count + 1] = buf;
-				cmdinc_count++;
-				break;
-			}
-			/* intentional fall through */
-		default:
-			if (endmarker) break;
-	/*		fatalerr("unknown opt = %s\n", argv[0]); */
-			warning("ignoring option %s\n", argv[0]);
-		}
-	}
-	/* Now do the undefs from the command line */
-	for (i = 0; i < numundefs; i++)
-	    undefine(undeflist[i], &maininclist);
-	if (numundefs > 0)
-	    free(undeflist);
-
-	if (!defincdir) {
-#ifdef PREINCDIR
-	    if (incp >= includedirs + MAXDIRS)
-		fatalerr("Too many -I flags.\n");
-	    *incp++ = PREINCDIR;
-#endif
-#if defined(__UNIXOS2__) || defined(_MSC_VER)
-	    {
-#if defined(_MSC_VER)
-		char *includepath = getenv("INCLUDE");
-#else
-		char *includepath = getenv("C_INCLUDE_PATH");
-#endif
-		/* can have more than one component */
-		if (includepath) {
-		    char *beg, *end;
-		    beg= (char*)strdup(includepath);
-		    for (;;) {
-			end = (char*)strchr(beg,';');
-			if (end) *end = 0;
-		    	if (incp >= includedirs + MAXDIRS)
-				fatalerr("Too many include dirs\n");
-			*incp++ = beg;
-			if (!end) break;
-			beg = end+1;
-		    }
-		}
-	    }
-#else /* !__UNIXOS2__ && !_MSC_VER, does not use INCLUDEDIR at all */
-	    if (incp >= includedirs + MAXDIRS)
-		fatalerr("Too many -I flags.\n");
-	    *incp++ = INCLUDEDIR;
-#endif
-
-#ifdef EXTRAINCDIR
-	    if (incp >= includedirs + MAXDIRS)
-		fatalerr("Too many -I flags.\n");
-	    *incp++ = EXTRAINCDIR;
-#endif
-
-#ifdef POSTINCDIR
-	    if (incp >= includedirs + MAXDIRS)
-		fatalerr("Too many -I flags.\n");
-	    *incp++ = POSTINCDIR;
-#endif
-	} else if (*defincdir) {
-	    if (incp >= includedirs + MAXDIRS)
-		fatalerr("Too many -I flags.\n");
-	    *incp++ = defincdir;
-	}
-
-	redirect(startat, makefile);
-
-	/*
-	 * catch signals.
-	 */
-#ifdef USGISH
-/*  should really reset SIGINT to SIG_IGN if it was.  */
-#ifdef SIGHUP
-	signal (SIGHUP, catch);
-#endif
-	signal (SIGINT, catch);
-#ifdef SIGQUIT
-	signal (SIGQUIT, catch);
-#endif
-	signal (SIGILL, catch);
-#ifdef SIGBUS
-	signal (SIGBUS, catch);
-#endif
-	signal (SIGSEGV, catch);
-#ifdef SIGSYS
-	signal (SIGSYS, catch);
-#endif
-#else
-	sig_act.sa_handler = catch;
-#if defined(_POSIX_SOURCE) || !defined(X_NOT_POSIX)
-	sigemptyset(&sig_act.sa_mask);
-	sigaddset(&sig_act.sa_mask, SIGINT);
-	sigaddset(&sig_act.sa_mask, SIGQUIT);
-#ifdef SIGBUS
-	sigaddset(&sig_act.sa_mask, SIGBUS);
-#endif
-	sigaddset(&sig_act.sa_mask, SIGILL);
-	sigaddset(&sig_act.sa_mask, SIGSEGV);
-	sigaddset(&sig_act.sa_mask, SIGHUP);
-	sigaddset(&sig_act.sa_mask, SIGPIPE);
-#ifdef SIGSYS
-	sigaddset(&sig_act.sa_mask, SIGSYS);
-#endif
-#else
-	sig_act.sa_mask = ((1<<(SIGINT -1))
-			   |(1<<(SIGQUIT-1))
-#ifdef SIGBUS
-			   |(1<<(SIGBUS-1))
-#endif
-			   |(1<<(SIGILL-1))
-			   |(1<<(SIGSEGV-1))
-			   |(1<<(SIGHUP-1))
-			   |(1<<(SIGPIPE-1))
-#ifdef SIGSYS
-			   |(1<<(SIGSYS-1))
-#endif
-			   );
-#endif /* _POSIX_SOURCE */
-	sig_act.sa_flags = 0;
-	sigaction(SIGHUP, &sig_act, (struct sigaction *)0);
-	sigaction(SIGINT, &sig_act, (struct sigaction *)0);
-	sigaction(SIGQUIT, &sig_act, (struct sigaction *)0);
-	sigaction(SIGILL, &sig_act, (struct sigaction *)0);
-#ifdef SIGBUS
-	sigaction(SIGBUS, &sig_act, (struct sigaction *)0);
-#endif
-	sigaction(SIGSEGV, &sig_act, (struct sigaction *)0);
-#ifdef SIGSYS
-	sigaction(SIGSYS, &sig_act, (struct sigaction *)0);
-#endif
-#endif /* USGISH */
-
-	/*
-	 * now peruse through the list of files.
-	 */
-	for(fp=filelist; *fp; fp++) {
-		DBG_PRINT(stderr,"file: %s\n",*fp);
-		filecontent = getfile(*fp);
-		setfile_cmdinc(filecontent, cmdinc_count, cmdinc_list);
-		ip = newinclude(*fp, (char *)NULL);
-
-		find_includes(filecontent, ip, ip, 0, FALSE);
-		freefile(filecontent);
-		recursive_pr_include(ip, ip->i_file, base_name(*fp));
-		inc_clean();
-	}
-	if (printed)
-		printf("\n");
-	return 0;
-}
-
-#ifdef __UNIXOS2__
-/*
- * eliminate \r chars from file
- */
-static int 
-elim_cr(char *buf, int sz)
-{
-	int i,wp;
-	for (i= wp = 0; i<sz; i++) {
-		if (buf[i] != '\r')
-			buf[wp++] = buf[i];
-	}
-	return wp;
-}
-#endif
-
-struct filepointer *
-getfile(char *file)
-{
-	int	fd;
-	struct filepointer	*content;
-	struct stat	st;
-
-	content = (struct filepointer *)malloc(sizeof(struct filepointer));
-	content->f_name = file;
-	if ((fd = open(file, O_RDONLY)) < 0) {
-		warning("cannot open \"%s\"\n", file);
-		content->f_p = content->f_base = content->f_end = (char *)malloc(1);
-		*content->f_p = '\0';
-		return(content);
-	}
-	fstat(fd, &st);
-	content->f_base = (char *)malloc(st.st_size+1);
-	if (content->f_base == NULL)
-		fatalerr("cannot allocate mem\n");
-	if ((st.st_size = read(fd, content->f_base, st.st_size)) < 0)
-		fatalerr("failed to read %s\n", file);
-#ifdef __UNIXOS2__
-	st.st_size = elim_cr(content->f_base,st.st_size);
-#endif
-	close(fd);
-	content->f_len = st.st_size+1;
-	content->f_p = content->f_base;
-	content->f_end = content->f_base + st.st_size;
-	*content->f_end = '\0';
-	content->f_line = 0;
-	content->cmdinc_count = 0;
-	content->cmdinc_list = NULL;
-	content->cmdinc_line = 0;
-	return(content);
-}
-
-void
-setfile_cmdinc(struct filepointer* filep, long count, char** list)
-{
-	filep->cmdinc_count = count;
-	filep->cmdinc_list = list;
-	filep->cmdinc_line = 0;
-}
-
-void
-freefile(struct filepointer *fp)
-{
-	free(fp->f_base);
-	free(fp);
-}
-
-char *copy(char *str)
-{
-	char	*p = (char *)malloc(strlen(str) + 1);
-
-	strcpy(p, str);
-	return(p);
-}
-
-int
-match(char *str, char **list)
-{
-	int	i;
-
-	for (i=0; *list; i++, list++)
-		if (strcmp(str, *list) == 0)
-			return(i);
-	return(-1);
-}
-
-/*
- * Get the next line.  We only return lines beginning with '#' since that
- * is all this program is ever interested in.
- */
-char *getnextline(struct filepointer *filep)
-{
-	char	*p,	/* walking pointer */
-		*eof,	/* end of file pointer */
-		*bol;	/* beginning of line pointer */
-	int	lineno;	/* line number */
-	boolean whitespace = FALSE;
-
-	/*
-	 * Fake the "-include" line files in form of #include to the
-	 * start of each file.
-	 */
-	if (filep->cmdinc_line < filep->cmdinc_count) {
-		char *inc = filep->cmdinc_list[2 * filep->cmdinc_line + 0];
-		char *buf = filep->cmdinc_list[2 * filep->cmdinc_line + 1];
-		filep->cmdinc_line++;
-		sprintf(buf,"%s%s%s",DASH_INC_PRE,inc,DASH_INC_POST);
-		DBG_PRINT(stderr,"%s\n",buf);
-		return(buf);
-	}
-
-	p = filep->f_p;
-	eof = filep->f_end;
-	if (p >= eof)
-		return((char *)NULL);
-	lineno = filep->f_line;
-
-	for (bol = p--; ++p < eof; ) {
-		if ((bol == p) && ((*p == ' ') || (*p == '\t')))
-		{
-			/* Consume leading white-spaces for this line */
-			while (((p+1) < eof) && ((*p == ' ') || (*p == '\t')))
-			{
-				p++;
-				bol++;
-			}
-			whitespace = TRUE;
-		}
-        
-		if (*p == '/' && (p+1) < eof && *(p+1) == '*') {
-			/* Consume C comments */
-			*(p++) = ' ';
-			*(p++) = ' ';
-			while (p < eof && *p) {
-				if (*p == '*' && (p+1) < eof && *(p+1) == '/') {
-					*(p++) = ' ';
-					*(p++) = ' ';
-					break;
-				}
-				if (*p == '\n')
-					lineno++;
-				*(p++) = ' ';
-			}
-			--p;
-		}
-		else if (*p == '/' && (p+1) < eof && *(p+1) == '/') {
-			/* Consume C++ comments */
-			*(p++) = ' ';
-			*(p++) = ' ';
-			while (p < eof && *p) {
-				if (*p == '\\' && (p+1) < eof &&
-				    *(p+1) == '\n') {
-					*(p++) = ' ';
-					lineno++;
-				}
-				else if (*p == '?' && (p+3) < eof &&
-					 *(p+1) == '?' && 
-					 *(p+2) == '/' &&
-					 *(p+3) == '\n') {
-					*(p++) = ' ';
-					*(p++) = ' ';
-					*(p++) = ' ';
-					lineno++;
-				}
-				else if (*p == '\n')
-					break;	/* to process end of line */
-				*(p++) = ' ';
-			}
-			--p;
-		}
-		else if (*p == '\\' && (p+1) < eof && *(p+1) == '\n') {
-			/* Consume backslash line terminations */
-			*(p++) = ' ';
-			*p = ' ';
-			lineno++;
-		}
-		else if (*p == '?' && (p+3) < eof &&
-			 *(p+1) == '?' && *(p+2) == '/' && *(p+3) == '\n') {
-			/* Consume trigraph'ed backslash line terminations */
-			*(p++) = ' ';
-			*(p++) = ' ';
-			*(p++) = ' ';
-			*p = ' ';
-			lineno++;
-		}
-		else if (*p == '\n') {
-			lineno++;
-			if (*bol == '#') {
-				char *cp;
-
-				*(p++) = '\0';
-				/* punt lines with just # (yacc generated) */
-				for (cp = bol+1; 
-				     *cp && (*cp == ' ' || *cp == '\t'); cp++);
-				if (*cp) goto done;
-				--p;
-			}
-			bol = p+1;
-			whitespace = FALSE;
-		}
-	}
-	if (*bol != '#')
-		bol = NULL;
-done:
-#if !defined(__UNIXOS2__) && !defined(_MSC_VER) && !defined(_WIN32)
-	/* Don't print warnings for system header files */
-	if (bol && whitespace && !strstr(filep->f_name, INCLUDEDIR)) {
-		warning("%s:  non-portable whitespace encountered at line %d\n",
-			filep->f_name, lineno);
-	}
-#endif
-	filep->f_p = p;
-	filep->f_line = lineno;
-#ifdef DEBUG_DUMP
-	if (bol)
-		DBG_PRINT(stderr,"%s\n",bol);
-#endif
-	return(bol);
-}
-
-/*
- * Strip the file name down to what we want to see in the Makefile.
- * It will have objprefix and objsuffix around it.
- */
-char *base_name(char *file)
-{
-	char	*p;
-
-	file = copy(file);
-	for(p=file+strlen(file); p>file && *p != '.'; p--) ;
-
-	if (*p == '.')
-		*p = '\0';
-	return(file);
-}
-
-#if defined(USG) && !defined(CRAY) && !defined(SVR4) && !defined(__UNIXOS2__) && !defined(clipper) && !defined(__clipper__)
-int rename (char *from, char *to)
-{
-    (void) unlink (to);
-    if (link (from, to) == 0) {
-	unlink (from);
-	return 0;
-    } else {
-	return -1;
-    }
-}
-#endif /* USGISH */
-
-void
-redirect(char *line, char *makefile)
-{
-	struct stat	st;
-	FILE	*fdin, *fdout;
-	char	backup[ BUFSIZ ],
-		buf[ BUFSIZ ];
-	boolean	found = FALSE;
-	int	len;
-
-	/*
-	 * if makefile is "-" then let it pour onto stdout.
-	 */
-	if (makefile && *makefile == '-' && *(makefile+1) == '\0') {
-		puts(line);
-		return;
-	}
-
-	/*
-	 * use a default makefile is not specified.
-	 */
-	if (!makefile) {
-		if (stat("Makefile", &st) == 0)
-			makefile = "Makefile";
-		else if (stat("makefile", &st) == 0)
-			makefile = "makefile";
-		else
-			fatalerr("[mM]akefile is not present\n");
-	}
-	else
-	    stat(makefile, &st);
-	if ((fdin = fopen(makefile, "r")) == NULL)
-		fatalerr("cannot open \"%s\"\n", makefile);
-	sprintf(backup, "%s.bak", makefile);
-	unlink(backup);
-#if defined(WIN32) || defined(__UNIXOS2__) || defined(__CYGWIN__)
-	fclose(fdin);
-#endif
-	if (rename(makefile, backup) < 0)
-		fatalerr("cannot rename %s to %s\n", makefile, backup);
-#if defined(WIN32) || defined(__UNIXOS2__) || defined(__CYGWIN__)
-	if ((fdin = fopen(backup, "r")) == NULL)
-		fatalerr("cannot open \"%s\"\n", backup);
-#endif
-	if ((fdout = freopen(makefile, "w", stdout)) == NULL)
-		fatalerr("cannot open \"%s\"\n", backup);
-	len = strlen(line);
-	while (!found && fgets(buf, BUFSIZ, fdin)) {
-		if (*buf == '#' && strncmp(line, buf, len) == 0)
-			found = TRUE;
-		fputs(buf, fdout);
-	}
-	if (!found) {
-		if (verbose)
-		warning("Adding new delimiting line \"%s\" and dependencies...\n",
-			line);
-		puts(line); /* same as fputs(fdout); but with newline */
-	} else if (append) {
-	    while (fgets(buf, BUFSIZ, fdin)) {
-		fputs(buf, fdout);
-	    }
-	}
-	fflush(fdout);
-#if defined(USGISH) || defined(_SEQUENT_) || defined(USE_CHMOD)
-	chmod(makefile, st.st_mode);
-#else
-        fchmod(fileno(fdout), st.st_mode);
-#endif /* USGISH */
-}
-
-void
-fatalerr(char *msg, ...)
-{
-	va_list args;
-	fprintf(stderr, "%s: error:  ", ProgramName);
-	va_start(args, msg);
-	vfprintf(stderr, msg, args);
-	va_end(args);
-	exit (1);
-}
-
-void
-warning(char *msg, ...)
-{
-	va_list args;
-	fprintf(stderr, "%s: warning:  ", ProgramName);
-	va_start(args, msg);
-	vfprintf(stderr, msg, args);
-	va_end(args);
-}
-
-void
-warning1(char *msg, ...)
-{
-	va_list args;
-	va_start(args, msg);
-	vfprintf(stderr, msg, args);
-	va_end(args);
-}
diff --git a/nss/coreconf/mkdepend/mkdepend.man b/nss/coreconf/mkdepend/mkdepend.man
deleted file mode 100644
index 595c87e..0000000
--- a/nss/coreconf/mkdepend/mkdepend.man
+++ /dev/null
@@ -1,382 +0,0 @@
-.\" $Xorg: mkdepend.man,v 1.5 2001/02/09 02:03:16 xorgcvs Exp $
-.\" Copyright (c) 1993, 1994, 1998 The Open Group
-.\" 
-.\" Permission to use, copy, modify, distribute, and sell this software and its
-.\" documentation for any purpose is hereby granted without fee, provided that
-.\" the above copyright notice appear in all copies and that both that
-.\" copyright notice and this permission notice appear in supporting
-.\" documentation.
-.\" 
-.\" The above copyright notice and this permission notice shall be included in
-.\" all copies or substantial portions of the Software.
-.\" 
-.\" THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-.\" IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-.\" FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL 
-.\" THE OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
-.\" WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF 
-.\" OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE 
-.\" SOFTWARE.
-.\" 
-.\" Except as contained in this notice, the name of The Open Group shall not 
-.\" be used in advertising or otherwise to promote the sale, use or other 
-.\" dealing in this Software without prior written authorization from The
-.\" Open Group.
-.\"
-.\" $XFree86: xc/config/makedepend/mkdepend.man,v 1.7 2002/12/14 02:39:45 dawes Exp $
-.\"
-.TH MAKEDEPEND 1 __xorgversion__
-.UC 4
-.SH NAME
-makedepend \- create dependencies in makefiles
-.SH SYNOPSIS
-.B makedepend
-[
-.BI \-D name\fB=\fPdef
-] [
-.BI \-D name
-] [
-.BI \-I includedir
-] [
-.BI \-Y includedir
-] [
-.B \-a
-] [
-.BI \-f makefile
-] [
-.BI \-include \ file
-] [
-.BI \-o objsuffix
-] [
-.BI \-p objprefix
-] [
-.BI \-s string
-] [
-.BI \-w width
-] [
-.B \-v
-] [
-.B \-m
-] [
-\-\^\-
-.I otheroptions
-\-\^\-
-]
-.I sourcefile
-\&.\|.\|.
-.br
-.SH DESCRIPTION
-The
-.B makedepend
-program reads each
-.I sourcefile
-in sequence and parses it like a C-preprocessor,
-processing all
-.I #include,
-.I #define,
-.I #undef,
-.I #ifdef,
-.I #ifndef,
-.I #endif,
-.I #if,
-.I #elif
-and
-.I #else
-directives so that it can correctly tell which
-.I #include,
-directives would be used in a compilation.
-Any
-.I #include,
-directives can reference files having other
-.I #include
-directives, and parsing will occur in these files as well.
-.PP
-Every file that a
-.I sourcefile
-includes,
-directly or indirectly,
-is what
-.B makedepend
-calls a \fIdependency.\fP
-These dependencies are then written to a
-.I makefile
-in such a way that
-.B make(1)
-will know which object files must be recompiled when a dependency has changed.
-.PP
-By default,
-.B makedepend
-places its output in the file named
-.I makefile
-if it exists, otherwise
-.I Makefile.
-An alternate makefile may be specified with the
-.B \-f
-option.
-It first searches the makefile for
-the line
-.sp
-\&    # DO NOT DELETE THIS LINE \-\^\- make depend depends on it.
-.sp
-or one provided with the
-.B \-s
-option,
-as a delimiter for the dependency output.
-If it finds it, it will delete everything
-following this to the end of the makefile
-and put the output after this line.
-If it doesn't find it, the program
-will append the string to the end of the makefile
-and place the output following that.
-For each
-.I sourcefile
-appearing on the command line,
-.B makedepend
-puts lines in the makefile of the form
-.sp
-     sourcefile.o:\0dfile .\|.\|.
-.sp
-Where \fIsourcefile.o\fP is the name from the command
-line with its suffix replaced with ``.o'',
-and \fIdfile\fP is a dependency discovered in a
-.I #include
-directive while parsing
-.I sourcefile
-or one of the files it included.
-.SH EXAMPLE
-Normally,
-.B makedepend
-will be used in a makefile target so that typing ``make depend'' will
-bring the dependencies up to date for the makefile.
-For example,
-.nf
-    SRCS\0=\0file1.c\0file2.c\0.\|.\|.
-    CFLAGS\0=\0\-O\0\-DHACK\0\-I\^.\^.\^/foobar\0\-xyz
-    depend:
-            makedepend\0\-\^\-\0$(CFLAGS)\0\-\^\-\0$(SRCS)
-.fi
-.SH OPTIONS
-The program
-will ignore any option that it does not understand so that you may use
-the same arguments that you would for
-.B cc(1).
-.TP 5
-.B \-D\fIname\fP=\fIdef\fP \fRor\fP \-D\fIname\fP
-Define.
-This places a definition for
-.I name
-in
-.B makedepend's
-symbol table.
-Without 
-.I =def\|
-the symbol becomes defined as ``1''.
-.TP 5
-.B \-I\fIincludedir\fP
-Include directory.
-This option tells
-.B makedepend
-to prepend
-.I includedir
-to its list of directories to search when it encounters
-a
-.I #include
-directive.
-By default,
-.B makedepend
-only searches the standard include directories (usually /usr/include
-and possibly a compiler-dependent directory).
-.TP 5
-.B \-Y\fIincludedir\fP
-Replace all of the standard include directories with the single specified
-include directory; you can omit the
-.I includedir
-to simply prevent searching the standard include directories.
-.TP 5
-.B \-a
-Append the dependencies to the end of the file instead of replacing them. 
-.TP 5
-.B \-f\fImakefile\fP
-Filename.
-This allows you to specify an alternate makefile in which
-.B makedepend
-can place its output.
-Specifying ``\-'' as the file name (i.e., \fB\-f\-\fP) sends the
-output to standard output instead of modifying an existing file.
-.TP 5
-.B \-include \fIfile\fP
-Process file as input, and include all the resulting output
-before processing the regular input file. This has the same
-affect as if the specified file is an include statement that
-appears before the very first line of the regular input file.
-.TP 5
-.B \-o\fIobjsuffix\fP
-Object file suffix.
-Some systems may have object files whose suffix is something other
-than ``.o''.
-This option allows you to specify another suffix, such as
-``.b'' with
-.I \-o.b
-or ``:obj''
-with
-.I \-o:obj
-and so forth.
-.TP 5
-.B \-p\fIobjprefix\fP
-Object file prefix.
-The prefix is prepended to the name of the object file. This is
-usually used to designate a different directory for the object file.
-The default is the empty string.
-.TP 5
-.B \-s\fIstring\fP
-Starting string delimiter.
-This option permits you to specify
-a different string for
-.B makedepend
-to look for in the makefile.
-.TP 5
-.B \-w\fIwidth\fP
-Line width.
-Normally,
-.B makedepend
-will ensure that every output line that it writes will be no wider than
-78 characters for the sake of readability.
-This option enables you to change this width.
-.TP 5
-.B \-v
-Verbose operation.
-This option causes 
-.B makedepend
-to emit the list of files included by each input file.
-.TP 5
-.B \-m
-Warn about multiple inclusion.
-This option causes 
-.B makedepend
-to produce a warning if any input file includes another file more than
-once.  In previous versions of 
-.B makedepend
-this was the default behavior; the default has been changed to better
-match the behavior of the C compiler, which does not consider multiple
-inclusion to be an error.  This option is provided for backward 
-compatibility, and to aid in debugging problems related to multiple
-inclusion.
-.TP 5
-.B "\-\^\- \fIoptions\fP \-\^\-"
-If
-.B makedepend
-encounters a double hyphen (\-\^\-) in the argument list,
-then any unrecognized argument following it
-will be silently ignored; a second double hyphen terminates this
-special treatment.
-In this way,
-.B makedepend
-can be made to safely ignore esoteric compiler arguments that might
-normally be found in a CFLAGS
-.B make
-macro (see the
-.B EXAMPLE
-section above).
-All options that
-.B makedepend
-recognizes and appear between the pair of double hyphens
-are processed normally.
-.SH ALGORITHM
-The approach used in this program enables it to run an order of magnitude
-faster than any other ``dependency generator'' I have ever seen.
-Central to this performance are two assumptions:
-that all files compiled by a single
-makefile will be compiled with roughly the same
-.I \-I
-and
-.I \-D
-options;
-and that most files in a single directory will include largely the
-same files.
-.PP
-Given these assumptions,
-.B makedepend
-expects to be called once for each makefile, with
-all source files that are maintained by the
-makefile appearing on the command line.
-It parses each source and include
-file exactly once, maintaining an internal symbol table
-for each.
-Thus, the first file on the command line will take an amount of time
-proportional to the amount of time that a normal C preprocessor takes.
-But on subsequent files, if it encounters an include file
-that it has already parsed, it does not parse it again.
-.PP
-For example,
-imagine you are compiling two files,
-.I file1.c
-and
-.I file2.c,
-they each include the header file
-.I header.h,
-and the file
-.I header.h
-in turn includes the files
-.I def1.h
-and
-.I def2.h.
-When you run the command
-.sp
-    makedepend\0file1.c\0file2.c
-.sp
-.B makedepend
-will parse
-.I file1.c
-and consequently,
-.I header.h
-and then
-.I def1.h
-and
-.I def2.h.
-It then decides that the dependencies for this file are
-.sp
-    file1.o:\0header.h\0def1.h\0def2.h
-.sp
-But when the program parses
-.I file2.c
-and discovers that it, too, includes
-.I header.h,
-it does not parse the file,
-but simply adds
-.I header.h,
-.I def1.h
-and
-.I def2.h
-to the list of dependencies for
-.I file2.o.
-.SH "SEE ALSO"
-cc(1), make(1)
-.SH BUGS
-.B makedepend
-parses, but does not currently evaluate, the SVR4 #predicate(token-list)
-preprocessor expression; such expressions are simply assumed to be true.
-This may cause the wrong
-.I #include
-directives to be evaluated.
-.PP
-Imagine you are parsing two files,
-say
-.I file1.c
-and
-.I file2.c,
-each includes the file
-.I def.h.
-The list of files that
-.I def.h
-includes might truly be different when
-.I def.h
-is included by
-.I file1.c
-than when it is included by
-.I file2.c.
-But once
-.B makedepend
-arrives at a list of dependencies for a file,
-it is cast in concrete.
-.SH AUTHOR
-Todd Brunhoff, Tektronix, Inc. and MIT Project Athena
diff --git a/nss/coreconf/mkdepend/parse.c b/nss/coreconf/mkdepend/parse.c
deleted file mode 100644
index 5229d66..0000000
--- a/nss/coreconf/mkdepend/parse.c
+++ /dev/null
@@ -1,693 +0,0 @@
-/* $Xorg: parse.c,v 1.6 2001/02/09 02:03:16 xorgcvs Exp $ */
-/*
-
-Copyright (c) 1993, 1994, 1998 The Open Group
-
-Permission to use, copy, modify, distribute, and sell this software and its
-documentation for any purpose is hereby granted without fee, provided that
-the above copyright notice appear in all copies and that both that
-copyright notice and this permission notice appear in supporting
-documentation.
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
-CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-
-Except as contained in this notice, the name of The Open Group shall not be
-used in advertising or otherwise to promote the sale, use or other dealings
-in this Software without prior written authorization from The Open Group.
-
-*/
-/* $XFree86: xc/config/makedepend/parse.c,v 1.12 2002/02/26 05:09:10 tsi Exp $ */
-
-#include "def.h"
-
-extern char	*directives[];
-extern struct inclist	inclist[ MAXFILES ],
-			*inclistnext,
-			maininclist;
-extern char	*includedirs[ ],
-		**includedirsnext;
-
-static int deftype (char *line, struct filepointer *filep,
-		    struct inclist *file_red, struct inclist *file,
-		    int parse_it);
-static int zero_value(char *filename, char *exp, struct filepointer *filep,
-		    struct inclist *file_red);
-static int merge2defines(struct inclist *file1, struct inclist *file2);
-
-static int
-gobble(struct filepointer *filep, struct inclist *file,
-       struct inclist *file_red)
-{
-	char	*line;
-	int	type;
-
-	while ((line = getnextline(filep))) {
-		switch(type = deftype(line, filep, file_red, file, FALSE)) {
-		case IF:
-		case IFFALSE:
-		case IFGUESSFALSE:
-		case IFDEF:
-		case IFNDEF:
-			type = gobble(filep, file, file_red);
-			while ((type == ELIF) || (type == ELIFFALSE) ||
-			       (type == ELIFGUESSFALSE))
-			    type = gobble(filep, file, file_red);
-			if (type == ELSE)
-			        (void)gobble(filep, file, file_red);
-			break;
-		case ELSE:
-		case ENDIF:
-			debug(0,("%s, line %d: #%s\n",
-				file->i_file, filep->f_line,
-				directives[type]));
-			return(type);
-		case DEFINE:
-		case UNDEF:
-		case INCLUDE:
-		case INCLUDEDOT:
-		case PRAGMA:
-		case ERROR:
-		case IDENT:
-		case SCCS:
-		case EJECT:
-		case WARNING:
-		case INCLUDENEXT:
-		case INCLUDENEXTDOT:
-			break;
-		case ELIF:
-		case ELIFFALSE:
-		case ELIFGUESSFALSE:
-			return(type);
-		case -1:
-			warning("%s", file_red->i_file);
-			if (file_red != file)
-				warning1(" (reading %s)", file->i_file);
-			warning1(", line %d: unknown directive == \"%s\"\n",
-				filep->f_line, line);
-			break;
-		}
-	}
-	return(-1);
-}
-
-/*
- * Decide what type of # directive this line is.
- */
-static int 
-deftype (char *line, struct filepointer *filep, 
-	     struct inclist *file_red, struct inclist *file, int parse_it)
-{
-	register char	*p;
-	char	*directive, savechar, *q;
-	register int	ret;
-
-	/*
-	 * Parse the directive...
-	 */
-	directive=line+1;
-	while (*directive == ' ' || *directive == '\t')
-		directive++;
-
-	p = directive;
-	while ((*p == '_') || (*p >= 'a' && *p <= 'z'))
-		p++;
-	savechar = *p;
-	*p = '\0';
-	ret = match(directive, directives);
-	*p = savechar;
-
-	/* If we don't recognize this compiler directive or we happen to just
-	 * be gobbling up text while waiting for an #endif or #elif or #else
-	 * in the case of an #elif we must check the zero_value and return an
-	 * ELIF or an ELIFFALSE.
-	 */
-
-	if (ret == ELIF && !parse_it)
-	{
-	    while (*p == ' ' || *p == '\t')
-		p++;
-	    /*
-	     * parse an expression.
-	     */
-	    debug(0,("%s, line %d: #elif %s ",
-		   file->i_file, filep->f_line, p));
-	    ret = zero_value(file->i_file, p, filep, file_red);
-	    if (ret != IF)
-	    {
-		debug(0,("false...\n"));
-		if (ret == IFFALSE)
-		    return(ELIFFALSE);
-		else
-		    return(ELIFGUESSFALSE);
-	    }
-	    else
-	    {
-		debug(0,("true...\n"));
-		return(ELIF);
-	    }
-	}
-
-	if (ret < 0 || ! parse_it)
-		return(ret);
-
-	/*
-	 * now decide how to parse the directive, and do it.
-	 */
-	while (*p == ' ' || *p == '\t')
-		p++;
-	q = p + strlen(p);
-	do {
-		q--;
-	} while (*q == ' ' || *q == '\t');
-	q[1] = '\0';
-	switch (ret) {
-	case IF:
-		/*
-		 * parse an expression.
-		 */
-		ret = zero_value(file->i_file, p, filep, file_red);
-		debug(0,("%s, line %d: %s #if %s\n",
-			 file->i_file, filep->f_line, ret?"false":"true", p));
-		break;
-	case IFDEF:
-	case IFNDEF:
-		debug(0,("%s, line %d: #%s %s\n",
-			file->i_file, filep->f_line, directives[ret], p));
-	case UNDEF:
-		/*
-		 * separate the name of a single symbol.
-		 */
-		while (isalnum(*p) || *p == '_')
-			*line++ = *p++;
-		*line = '\0';
-		break;
-	case INCLUDE:
-	case INCLUDENEXT:
-		debug(2,("%s, line %d: #include%s %s\n",
-			file->i_file, filep->f_line,
-			(ret == INCLUDE) ? "" : "_next", p));
-
-		/* Support ANSI macro substitution */
-		while (1) {
-			struct symtab **sym;
-
-			if (!*p || *p == '"' || *p == '<')
-				break;
-
-		    	sym = isdefined(p, file_red, NULL);
-			if (!sym)
-				break;
-
-			p = (*sym)->s_value;
-			debug(3,("%s : #includes SYMBOL %s = %s\n",
-			       file->i_incstring,
-			       (*sym) -> s_name,
-			       (*sym) -> s_value));
-			/* mark file as having included a 'soft include' */
-			file->i_flags |= INCLUDED_SYM; 
-		}
-
-		/*
-		 * Separate the name of the include file.
-		 */
-		while (*p && *p != '"' && *p != '<')
-			p++;
-		if (! *p)
-			return(-2);
-		if (*p++ == '"') {
-			if (ret == INCLUDE)
-				ret = INCLUDEDOT;
-			else
-				ret = INCLUDENEXTDOT;
-			while (*p && *p != '"')
-				*line++ = *p++;
-		} else
-			while (*p && *p != '>')
-				*line++ = *p++;
-		*line = '\0';
-		break;
-	case DEFINE:
-		/*
-		 * copy the definition back to the beginning of the line.
-		 */
-		strcpy (line, p);
-		break;
-	case ELSE:
-	case ENDIF:
-	case ELIF:
-	case PRAGMA:
-	case ERROR:
-	case IDENT:
-	case SCCS:
-	case EJECT:
-	case WARNING:
-		debug(0,("%s, line %d: #%s\n",
-			file->i_file, filep->f_line, directives[ret]));
-		/*
-		 * nothing to do.
-		 */
-		break;
-	}
-	return(ret);
-}
-
-struct symtab **
-fdefined(char *symbol, struct inclist *file, struct inclist **srcfile)
-{
-	struct inclist	**ip;
-	struct symtab	**val;
-	int	i;
-	static int	recurse_lvl = 0;
-
-	if (file->i_flags & DEFCHECKED)
-		return(NULL);
-	debug(2,("Looking for %s in %s\n", symbol, file->i_file));
-	file->i_flags |= DEFCHECKED;
-	if ((val = slookup(symbol, file)))
-		debug(1,("%s defined in %s as %s\n",
-			 symbol, file->i_file, (*val)->s_value));
-	if (val == NULL && file->i_list)
-	{
-		for (ip = file->i_list, i=0; i < file->i_listlen; i++, ip++)
-			if (file->i_merged[i]==FALSE) {
-				val = fdefined(symbol, *ip, srcfile);
-				file->i_merged[i]=merge2defines(file,*ip);
-				if (val!=NULL) break;
-			}
-	}
-	else if (val != NULL && srcfile != NULL) *srcfile = file;
-	recurse_lvl--;
-	file->i_flags &= ~DEFCHECKED;
-
-	return(val);
-}
-
-struct symtab **
-isdefined(char *symbol, struct inclist *file, struct inclist **srcfile)
-{
-	struct symtab	**val;
-
-	if ((val = slookup(symbol, &maininclist))) {
-		debug(1,("%s defined on command line\n", symbol));
-		if (srcfile != NULL) *srcfile = &maininclist;
-		return(val);
-	}
-	if ((val = fdefined(symbol, file, srcfile)))
-		return(val);
-	debug(1,("%s not defined in %s\n", symbol, file->i_file));
-	return(NULL);
-}
-
-/*
- * Return type based on if the #if expression evaluates to 0
- */
-static int
-zero_value(char *filename,
-	   char *exp,
-	   struct filepointer *filep,
-	   struct inclist *file_red)
-{
-	if (cppsetup(filename, exp, filep, file_red))
-	    return(IFFALSE);
-	else
-	    return(IF);
-}
-
-void
-define2(char *name, char *val, struct inclist *file)
-{
-    int first, last, below;
-    register struct symtab **sp = NULL, **dest;
-    struct symtab *stab;
-
-    /* Make space if it's needed */
-    if (file->i_defs == NULL)
-    {
-	file->i_defs = (struct symtab **)
-			malloc(sizeof (struct symtab*) * SYMTABINC);
-	file->i_ndefs = 0;
-    }
-    else if (!(file->i_ndefs % SYMTABINC))
-	file->i_defs = (struct symtab **)
-			realloc(file->i_defs,
-			   sizeof(struct symtab*)*(file->i_ndefs+SYMTABINC));
-
-    if (file->i_defs == NULL)
-	fatalerr("malloc()/realloc() failure in insert_defn()\n");
-
-    below = first = 0;
-    last = file->i_ndefs - 1;
-    while (last >= first)
-    {
-	/* Fast inline binary search */
-	register char *s1;
-	register char *s2;
-	register int middle = first + (last - first) / 2;
-
-	/* Fast inline strchr() */
-	s1 = name;
-	s2 = file->i_defs[middle]->s_name;
-	while (*s1++ == *s2++)
-	    if (s2[-1] == '\0') break;
-
-	/* If exact match, set sp and break */
-	if (*--s1 == *--s2) 
-	{
-	    sp = file->i_defs + middle;
-	    break;
-	}
-
-	/* If name > i_defs[middle] ... */
-	if (*s1 > *s2) 
-	{
-	    below = first;
-	    first = middle + 1;
-	}
-	/* else ... */
-	else
-	{
-	    below = last = middle - 1;
-	}
-    }
-
-    /* Search is done.  If we found an exact match to the symbol name,
-       just replace its s_value */
-    if (sp != NULL)
-    {
-	debug(1,("redefining %s from %s to %s in file %s\n",
-		name, (*sp)->s_value, val, file->i_file));
-	free((*sp)->s_value);
-	(*sp)->s_value = copy(val);
-	return;
-    }
-
-    sp = file->i_defs + file->i_ndefs++;
-    dest = file->i_defs + below + 1;
-    while (sp > dest)
-    {
-	*sp = sp[-1];
-	sp--;
-    }
-    stab = (struct symtab *) malloc(sizeof (struct symtab));
-    if (stab == NULL)
-	fatalerr("malloc()/realloc() failure in insert_defn()\n");
-
-    debug(1,("defining %s to %s in file %s\n", name, val, file->i_file));
-    stab->s_name = copy(name);
-    stab->s_value = copy(val);
-    *sp = stab;
-}
-
-void
-define(char *def, struct inclist *file)
-{
-    char *val;
-
-    /* Separate symbol name and its value */
-    val = def;
-    while (isalnum(*val) || *val == '_')
-	val++;
-    if (*val)
-	*val++ = '\0';
-    while (*val == ' ' || *val == '\t')
-	val++;
-
-    if (!*val)
-	val = "1";
-    define2(def, val, file);
-}
-
-struct symtab **
-slookup(char *symbol, struct inclist *file)
-{
-	register int first = 0;
-	register int last;
-
-	if (!file)
-	{
-	    return NULL;
-	}
-
-	last = file->i_ndefs - 1;
-
-	while (last >= first)
-	{
-	    /* Fast inline binary search */
-	    register char *s1;
-	    register char *s2;
-	    register int middle = first + (last - first) / 2;
-
-	    /* Fast inline strchr() */
-	    s1 = symbol;
-	    s2 = file->i_defs[middle]->s_name;
-	    while (*s1++ == *s2++)
-	        if (s2[-1] == '\0') break;
-
-	    /* If exact match, we're done */
-	    if (*--s1 == *--s2) 
-	    {
-	        return file->i_defs + middle;
-	    }
-
-	    /* If symbol > i_defs[middle] ... */
-	    if (*s1 > *s2) 
-	    {
-	        first = middle + 1;
-	    }
-	    /* else ... */
-	    else
-	    {
-	        last = middle - 1;
-	    }
-	}
-	return NULL;
-}
-
-static int 
-merge2defines(struct inclist *file1, struct inclist *file2)
-{
-	int i;
-
-	if ((file1==NULL) || (file2==NULL) ||
-	    !(file2->i_flags & FINISHED))
-		return 0;
-
-	for (i=0; i < file2->i_listlen; i++)
-		if (file2->i_merged[i]==FALSE)
-			return 0;
-
-	{
-		int first1 = 0;
-		int last1 = file1->i_ndefs - 1;
-
-		int first2 = 0;
-		int last2 = file2->i_ndefs - 1;
-
-                int first=0;
-                struct symtab** i_defs = NULL;
-		int deflen=file1->i_ndefs+file2->i_ndefs;
-
-		debug(2,("merging %s into %s\n",
-			file2->i_file, file1->i_file));
-
-                if (deflen>0)
-                { 
-                	/* make sure deflen % SYMTABINC == 0 is still true */
-                	deflen += (SYMTABINC - deflen % SYMTABINC) % SYMTABINC;
-                	i_defs=(struct symtab**)
-			    malloc(deflen*sizeof(struct symtab*));
-                	if (i_defs==NULL) return 0;
-        	}
-
-        	while ((last1 >= first1) && (last2 >= first2))
-        	{
-	    		char *s1=file1->i_defs[first1]->s_name;
-	    		char *s2=file2->i_defs[first2]->s_name;
-
-     			if (strcmp(s1,s2) < 0)
-                        	i_defs[first++]=file1->i_defs[first1++];
-     			else if (strcmp(s1,s2) > 0)
-                        	i_defs[first++]=file2->i_defs[first2++];
-                        else /* equal */
-                        {
-                        	i_defs[first++]=file2->i_defs[first2++];
-                                first1++;
-                        }
-        	}
-        	while (last1 >= first1)
-        	{
-                        i_defs[first++]=file1->i_defs[first1++];
-        	}
-        	while (last2 >= first2)
-        	{
-                        i_defs[first++]=file2->i_defs[first2++];
-        	}
-
-                if (file1->i_defs) free(file1->i_defs);
-                file1->i_defs=i_defs;
-                file1->i_ndefs=first;
-                
-		return 1;
-  	}
-}
-
-void
-undefine(char *symbol, struct inclist *file)
-{
-	register struct symtab **ptr;
-	struct inclist *srcfile;
-	while ((ptr = isdefined(symbol, file, &srcfile)) != NULL)
-	{
-	    srcfile->i_ndefs--;
-	    for (; ptr < srcfile->i_defs + srcfile->i_ndefs; ptr++)
-		*ptr = ptr[1];
-	}
-}
-
-int
-find_includes(struct filepointer *filep, struct inclist *file, 
-	      struct inclist *file_red, int recursion, boolean failOK)
-{
-	struct inclist	*inclistp;
-	char		**includedirsp;
-	register char	*line;
-	register int	type;
-	boolean recfailOK;
-
-	while ((line = getnextline(filep))) {
-		switch(type = deftype(line, filep, file_red, file, TRUE)) {
-		case IF:
-		doif:
-			type = find_includes(filep, file,
-				file_red, recursion+1, failOK);
-			while ((type == ELIF) || (type == ELIFFALSE) ||
-			       (type == ELIFGUESSFALSE))
-				type = gobble(filep, file, file_red);
-			if (type == ELSE)
-				gobble(filep, file, file_red);
-			break;
-		case IFFALSE:
-		case IFGUESSFALSE:
-		    doiffalse:
-			if (type == IFGUESSFALSE || type == ELIFGUESSFALSE)
-			    recfailOK = TRUE;
-			else
-			    recfailOK = failOK;
-			type = gobble(filep, file, file_red);
-			if (type == ELSE)
-			    find_includes(filep, file,
-					  file_red, recursion+1, recfailOK);
-			else
-			if (type == ELIF)
-			    goto doif;
-			else
-			if ((type == ELIFFALSE) || (type == ELIFGUESSFALSE))
-			    goto doiffalse;
-			break;
-		case IFDEF:
-		case IFNDEF:
-			if ((type == IFDEF && isdefined(line, file_red, NULL))
-			 || (type == IFNDEF && !isdefined(line, file_red, NULL))) {
-				debug(1,(type == IFNDEF ?
-				    "line %d: %s !def'd in %s via %s%s\n" : "",
-				    filep->f_line, line,
-				    file->i_file, file_red->i_file, ": doit"));
-				type = find_includes(filep, file,
-					file_red, recursion+1, failOK);
-				while (type == ELIF || type == ELIFFALSE || type == ELIFGUESSFALSE)
-					type = gobble(filep, file, file_red);
-				if (type == ELSE)
-					gobble(filep, file, file_red);
-			}
-			else {
-				debug(1,(type == IFDEF ?
-				    "line %d: %s !def'd in %s via %s%s\n" : "",
-				    filep->f_line, line,
-				    file->i_file, file_red->i_file, ": gobble"));
-				type = gobble(filep, file, file_red);
-				if (type == ELSE)
-					find_includes(filep, file,
-						file_red, recursion+1, failOK);
-				else if (type == ELIF)
-				    	goto doif;
-				else if (type == ELIFFALSE || type == ELIFGUESSFALSE)
-				    	goto doiffalse;
-			}
-			break;
-		case ELSE:
-		case ELIFFALSE:
-		case ELIFGUESSFALSE:
-		case ELIF:
-			if (!recursion)
-				gobble(filep, file, file_red);
-		case ENDIF:
-			if (recursion)
-				return(type);
-		case DEFINE:
-			define(line, file);
-			break;
-		case UNDEF:
-			if (!*line) {
-			    warning("%s", file_red->i_file);
-			    if (file_red != file)
-				warning1(" (reading %s)", file->i_file);
-			    warning1(", line %d: incomplete undef == \"%s\"\n",
-				filep->f_line, line);
-			    break;
-			}
-			undefine(line, file_red);
-			break;
-		case INCLUDE:
-		case INCLUDEDOT:
-		case INCLUDENEXT:
-		case INCLUDENEXTDOT:
-			inclistp = inclistnext;
-			includedirsp = includedirsnext;
-			debug(2,("%s, reading %s, includes %s\n",
-				file_red->i_file, file->i_file, line));
-			add_include(filep, file, file_red, line, type, failOK);
-			inclistnext = inclistp;
-			includedirsnext = includedirsp;
-			break;
-		case ERROR:
-		case WARNING:
-		    	warning("%s", file_red->i_file);
-			if (file_red != file)
-				warning1(" (reading %s)", file->i_file);
-			warning1(", line %d: %s\n",
-				 filep->f_line, line);
-		    	break;
-		    
-		case PRAGMA:
-		case IDENT:
-		case SCCS:
-		case EJECT:
-			break;
-		case -1:
-			warning("%s", file_red->i_file);
-			if (file_red != file)
-			    warning1(" (reading %s)", file->i_file);
-			warning1(", line %d: unknown directive == \"%s\"\n",
-				 filep->f_line, line);
-			break;
-		case -2:
-			warning("%s", file_red->i_file);
-			if (file_red != file)
-			    warning1(" (reading %s)", file->i_file);
-			warning1(", line %d: incomplete include == \"%s\"\n",
-				 filep->f_line, line);
-			break;
-		}
-	}
-	file->i_flags |= FINISHED;
-	debug(2,("finished with %s\n", file->i_file));
-	return(-1);
-}
diff --git a/nss/coreconf/mkdepend/pr.c b/nss/coreconf/mkdepend/pr.c
deleted file mode 100644
index e864793..0000000
--- a/nss/coreconf/mkdepend/pr.c
+++ /dev/null
@@ -1,124 +0,0 @@
-/* $Xorg: pr.c,v 1.4 2001/02/09 02:03:16 xorgcvs Exp $ */
-/*
-
-Copyright (c) 1993, 1994, 1998 The Open Group
-
-Permission to use, copy, modify, distribute, and sell this software and its
-documentation for any purpose is hereby granted without fee, provided that
-the above copyright notice appear in all copies and that both that
-copyright notice and this permission notice appear in supporting
-documentation.
-
-The above copyright notice and this permission notice shall be included in
-all copies or substantial portions of the Software.
-
-THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
-OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
-AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
-CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-
-Except as contained in this notice, the name of The Open Group shall not be
-used in advertising or otherwise to promote the sale, use or other dealings
-in this Software without prior written authorization from The Open Group.
-
-*/
-/* $XFree86: xc/config/makedepend/pr.c,v 1.5 2001/12/14 19:53:21 dawes Exp $ */
-
-#include "def.h"
-
-extern struct	inclist	inclist[ MAXFILES ],
-			*inclistp;
-extern char	*objprefix;
-extern char	*objsuffix;
-extern int	width;
-extern boolean	printed;
-extern boolean	verbose;
-extern boolean	show_where_not;
-
-void
-add_include(struct filepointer *filep, struct inclist *file, 
-	    struct inclist *file_red, char *include, int type,
-	    boolean failOK)
-{
-	register struct inclist	*newfile;
-	register struct filepointer	*content;
-
-	/*
-	 * First decide what the pathname of this include file really is.
-	 */
-	newfile = inc_path(file->i_file, include, type);
-	if (newfile == NULL) {
-		if (failOK)
-		    return;
-		if (file != file_red)
-			warning("%s (reading %s, line %d): ",
-				file_red->i_file, file->i_file, filep->f_line);
-		else
-			warning("%s, line %d: ", file->i_file, filep->f_line);
-		warning1("cannot find include file \"%s\"\n", include);
-		show_where_not = TRUE;
-		newfile = inc_path(file->i_file, include, type);
-		show_where_not = FALSE;
-	}
-
-	if (newfile) {
-		included_by(file, newfile);
-		if (!(newfile->i_flags & SEARCHED)) {
-			newfile->i_flags |= SEARCHED;
-			content = getfile(newfile->i_file);
-			find_includes(content, newfile, file_red, 0, failOK);
-			freefile(content);
-		}
-	}
-}
-
-static void
-pr(struct inclist *ip, char *file, char *base)
-{
-	static char	*lastfile;
-	static int	current_len;
-	register int	len, i;
-	char	buf[ BUFSIZ ];
-
-	printed = TRUE;
-	len = strlen(ip->i_file)+1;
-	if (current_len + len > width || file != lastfile) {
-		lastfile = file;
-		sprintf(buf, "\n%s%s%s: %s", objprefix, base, objsuffix,
-			ip->i_file);
-		len = current_len = strlen(buf);
-	}
-	else {
-		buf[0] = ' ';
-		strcpy(buf+1, ip->i_file);
-		current_len += len;
-	}
-	fwrite(buf, len, 1, stdout);
-
-	/*
-	 * If verbose is set, then print out what this file includes.
-	 */
-	if (! verbose || ip->i_list == NULL || ip->i_flags & NOTIFIED)
-		return;
-	ip->i_flags |= NOTIFIED;
-	lastfile = NULL;
-	printf("\n# %s includes:", ip->i_file);
-	for (i=0; i<ip->i_listlen; i++)
-		printf("\n#\t%s", ip->i_list[ i ]->i_incstring);
-}
-
-void
-recursive_pr_include(struct inclist *head, char *file, char *base)
-{
-	int	i;
-
-	if (head->i_flags & MARKED)
-		return;
-	head->i_flags |= MARKED;
-	if (head->i_file != file)
-		pr(head, file, base);
-	for (i=0; i<head->i_listlen; i++)
-		recursive_pr_include(head->i_list[ i ], file, base);
-}
diff --git a/nss/coreconf/module.mk b/nss/coreconf/module.mk
index 5f6d2cc..f9ddf6a 100644
--- a/nss/coreconf/module.mk
+++ b/nss/coreconf/module.mk
@@ -14,10 +14,6 @@
 #  always be identified for compiling/linking purposes
 #
 
-ifndef JAVA_SOURCE_COMPONENT
-    JAVA_SOURCE_COMPONENT = java
-endif
-
 ifndef NETLIB_SOURCE_COMPONENT
     NETLIB_SOURCE_COMPONENT = netlib
 endif
diff --git a/nss/coreconf/outofdate.pl b/nss/coreconf/outofdate.pl
deleted file mode 100755
index 33d80bb..0000000
--- a/nss/coreconf/outofdate.pl
+++ /dev/null
@@ -1,39 +0,0 @@
-#!/usr/local/bin/perl
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#Input: [-d dir] foo1.java foo2.java
-#Compares with: foo1.class foo2.class (if -d specified, checks in 'dir', 
-#  otherwise assumes .class files in same directory as .java files)
-#Returns: list of input arguments which are newer than corresponding class
-#files (non-existent class files are considered to be real old :-)
-
-$found = 1;
-
-if ($ARGV[0] eq '-d') {
-    $classdir = $ARGV[1];
-    $classdir .= "/";
-    shift;
-    shift;
-} else {
-    $classdir = "./";
-}
-
-foreach $filename (@ARGV) {
-    $classfilename = $classdir;
-    $classfilename .= $filename;
-    $classfilename =~ s/.java$/.class/;
-    ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size,$atime,$mtime,
-     $ctime,$blksize,$blocks) = stat($filename);
-    ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size,$atime,$classmtime,
-     $ctime,$blksize,$blocks) = stat($classfilename);
-#    print $filename, " ", $mtime, ", ", $classfilename, " ", $classmtime, "\n";
-    if ($mtime > $classmtime) {
-        print $filename, " ";
-        $found = 0;
-    }
-}
-
-print "\n";
diff --git a/nss/coreconf/release.pl b/nss/coreconf/release.pl
deleted file mode 100755
index 7cde19d..0000000
--- a/nss/coreconf/release.pl
+++ /dev/null
@@ -1,112 +0,0 @@
-#! /usr/local/bin/perl
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-
-require('coreconf.pl');
-
-#######-- read in variables on command line into %var
-
-$use_jar = 1;
-$ZIP     = "$ENV{JAVA_HOME}/bin/jar";
-
-if ( $ENV{JAVA_HOME} eq "" ) {
-    $ZIP      = "zip";
-    $use_jar  = 0;
-}
-
-
-&parse_argv;
-
- 
-######-- Do the packaging of jars.
-
-foreach $jarfile (split(/ /,$var{FILES}) ) {
-    print STDERR "---------------------------------------------\n";
-    print STDERR "Packaging jar file $jarfile....\n";
-
-    $jarinfo = $var{$jarfile};
-
-    ($jardir,$jaropts) = split(/\|/,$jarinfo);
-
-    if ( $use_jar ) {
-        $zipoptions = "-cvf";
-    } else {
-        $zipoptions = "-T -r";
-        if ($jaropts =~ /a/) {
-            if ($var{OS_ARCH} eq 'WINNT') {
-                $zipoptions .= ' -ll';
-            }
-        }
-    }
-
-# just in case the directory ends in a /, remove it
-    if ($jardir =~ /\/$/) {
-	chop $jardir;
-    }
-
-    $dirdepth --;
-    
-    print STDERR "jardir = $jardir\n";
-    system("ls $jardir");
-
-    if (-d $jardir) {
-
-
-# count the number of slashes
-
-	$slashes =0;
-	
-	foreach $i (split(//,$jardir)) {
-	    if ($i =~ /\//) {
-		$slashes++;
-	    }
-	}
-
-	$dotdots =0;
-	
-	foreach $i (split(m|/|,$jardir)) {
-	    if ($i eq '..') {
-		$dotdots ++;
-	    }
-	}
-
-	$dirdepth = ($slashes +1) - (2*$dotdots);
-
-	print STDERR "changing dir $jardir\n";
-	chdir($jardir);
-	print STDERR "making dir META-INF\n";
-	mkdir("META-INF",0755);
-
-	$filelist = "";
-	opendir(DIR,".");
-	while ($_ = readdir(DIR)) {
-	    if (! ( ($_ eq '.') || ($_ eq '..'))) {
-		if ( $jaropts =~ /i/) {
-		    if (! /^include$/) {
-			$filelist .= "$_ ";
-		    }
-		}
-		else {
-		    $filelist .= "$_ ";
-		}
-	    }
-	}
-	closedir(DIR);	
-
-	print STDERR "$ZIP $zipoptions $jarfile $filelist\n";
-	system("$ZIP $zipoptions $jarfile $filelist");
-	rmdir("META-INF");
-	    for $i (1 .. $dirdepth) {
-	    chdir("..");
-	    print STDERR "chdir ..\n";
-	}
-    }
-    else {
-        print STDERR "Directory $jardir doesn't exist\n";
-    }
-
-}
-
diff --git a/nss/coreconf/rules.mk b/nss/coreconf/rules.mk
index 35bb406..a3061ee 100644
--- a/nss/coreconf/rules.mk
+++ b/nss/coreconf/rules.mk
@@ -39,44 +39,10 @@ $(DIRS):
 endif
 endif
 
-#
-# IMPORTS will always be associated with a component.  Therefore,
-# the "import" rule will always change directory to the top-level
-# of a component, and traverse the IMPORTS keyword from the
-# "manifest.mn" file located at this level only.
-#
-# note: if there is a trailing slash, the component will be appended
-#       (see import.pl - only used for xpheader.jar)
-
-import:
-	@echo "== import.pl =="
-	@$(PERL) -I$(CORE_DEPTH)/coreconf $(CORE_DEPTH)/coreconf/import.pl \
-		"RELEASE_TREE=$(RELEASE_TREE)"   \
-		"IMPORTS=$(IMPORTS)"             \
-		"VERSION=$(VERSION)" \
-		"OS_ARCH=$(OS_ARCH)"             \
-		"PLATFORM=$(PLATFORM)" \
-		"OVERRIDE_IMPORT_CHECK=$(OVERRIDE_IMPORT_CHECK)"   \
-		"ALLOW_VERSION_OVERRIDE=$(ALLOW_VERSION_OVERRIDE)" \
-		"SOURCE_RELEASE_PREFIX=$(SOURCE_RELEASE_XP_DIR)"   \
-		"SOURCE_MD_DIR=$(SOURCE_MD_DIR)"      \
-		"SOURCE_XP_DIR=$(SOURCE_XP_DIR)"      \
-		"FILES=$(IMPORT_XPCLASS_JAR) $(XPHEADER_JAR) $(MDHEADER_JAR) $(MDBINARY_JAR)" \
-		"$(IMPORT_XPCLASS_JAR)=$(IMPORT_XP_DIR)|$(IMPORT_XPCLASS_DIR)|"    \
-		"$(XPHEADER_JAR)=$(IMPORT_XP_DIR)|$(SOURCE_XP_DIR)/public/|v" \
-		"$(MDHEADER_JAR)=$(IMPORT_MD_DIR)|$(SOURCE_MD_DIR)/include|"        \
-		"$(MDBINARY_JAR)=$(IMPORT_MD_DIR)|$(SOURCE_MD_DIR)|"
-# On Mac OS X ranlib needs to be rerun after static libs are moved.
-ifeq ($(OS_TARGET),Darwin)
-	find $(SOURCE_MD_DIR)/lib -name "*.a" -exec $(RANLIB) {} \;
-endif
-
 export: $(DIRS) private_export
 
 release_export: $(DIRS)
 
-release_classes: $(DIRS)
-
 libs program install: $(DIRS) $(TARGETS)
 
 check: $(DIRS)
@@ -90,90 +56,7 @@ realclean clobber_all: $(DIRS)
 release_clean:
 	rm -rf $(SOURCE_XP_DIR)/release/$(RELEASE_MD_DIR)
 
-release: release_clean release_export release_classes release_policy release_md release_jars release_cpdistdir
-
-release_cpdistdir:
-	@echo "== cpdist.pl =="
-	@$(PERL) -I$(CORE_DEPTH)/coreconf $(CORE_DEPTH)/coreconf/cpdist.pl \
-		"RELEASE_TREE=$(RELEASE_TREE)" \
-		"CORE_DEPTH=$(CORE_DEPTH)" \
-		"MODULE=${MODULE}" \
-		"OS_ARCH=$(OS_ARCH)" \
-		"RELEASE=$(RELEASE)" \
-		"PLATFORM=$(PLATFORM)" \
-		"RELEASE_VERSION=$(RELEASE_VERSION)" \
-		"SOURCE_RELEASE_PREFIX=$(SOURCE_RELEASE_XP_DIR)" \
-		"RELEASE_XP_DIR=$(RELEASE_XP_DIR)" \
-		"RELEASE_MD_DIR=$(RELEASE_MD_DIR)" \
-		"FILES=$(XPCLASS_JAR) $(XPCLASS_DBG_JAR) $(XPHEADER_JAR) $(MDHEADER_JAR) $(MDBINARY_JAR) XP_FILES MD_FILES" \
-		"$(XPCLASS_JAR)=$(SOURCE_RELEASE_CLASSES_DIR)|x"\
-		"$(XPCLASS_DBG_JAR)=$(SOURCE_RELEASE_CLASSES_DBG_DIR)|x"\
-		"$(XPHEADER_JAR)=$(SOURCE_RELEASE_XPHEADERS_DIR)|x" \
-		"$(MDHEADER_JAR)=$(SOURCE_RELEASE_MDHEADERS_DIR)|m" \
-		"$(MDBINARY_JAR)=$(SOURCE_RELEASE_MD_DIR)|m" \
-		"XP_FILES=$(XP_FILES)|xf" \
-		"MD_FILES=$(MD_FILES)|mf"
-
-
-# $(SOURCE_RELEASE_xxx_JAR) is a name like yyy.jar
-# $(SOURCE_RELEASE_xx_DIR)  is a name like 
-
-release_jars:
-	@echo "== release.pl =="
-	@$(PERL) -I$(CORE_DEPTH)/coreconf $(CORE_DEPTH)/coreconf/release.pl \
-		"RELEASE_TREE=$(RELEASE_TREE)" \
-		"PLATFORM=$(PLATFORM)" \
-		"OS_ARCH=$(OS_ARCH)" \
-		"RELEASE_VERSION=$(RELEASE_VERSION)" \
-		"SOURCE_RELEASE_DIR=$(SOURCE_RELEASE_DIR)" \
-		"FILES=$(XPCLASS_JAR) $(XPCLASS_DBG_JAR) $(XPHEADER_JAR) $(MDHEADER_JAR) $(MDBINARY_JAR)" \
-		"$(XPCLASS_JAR)=$(SOURCE_RELEASE_PREFIX)/$(SOURCE_RELEASE_CLASSES_DIR)|b"\
-		"$(XPCLASS_DBG_JAR)=$(SOURCE_RELEASE_PREFIX)/$(SOURCE_RELEASE_CLASSES_DBG_DIR)|b"\
-		"$(XPHEADER_JAR)=$(SOURCE_RELEASE_PREFIX)/$(SOURCE_RELEASE_XPHEADERS_DIR)|a" \
-		"$(MDHEADER_JAR)=$(SOURCE_RELEASE_PREFIX)/$(SOURCE_RELEASE_MDHEADERS_DIR)|a" \
-		"$(MDBINARY_JAR)=$(SOURCE_RELEASE_PREFIX)/$(SOURCE_RELEASE_MD_DIR)|bi"
-
-# Rules for releasing classes.
-# We have to do some REALLY gross stuff to deal with multiple classes in one
-# file, as well as nested classes, which have a filename of the form
-# ContainingClass$NestedClass.class.
-# RELEASE_CLASSES simply performs a required patsubst on CLASSES
-# RELEASE_CLASS_PATH is RELEASE_CLASSES with the path (in ns/dist) prepended
-# RELEASE_NESTED is all the nested classes in RELEASE_CLASS_PATH.  We use a
-#   foreach and wildcard to get all the files that start out like one of the
-#   class files, then have a $.  So, for each class file, we look for file$*
-# RELEASE_FILES is the combination of RELEASE_NESTED and the class files
-#   specified by RELEASE_CLASSES which have .class appended to them.  Note that
-#   the RELEASE_NESTED don't need to have .class appended because they were
-#   read in from the wildcard as complete filenames.
-#
-# The _DBG versions are the debuggable ones.
-ifneq ($(CLASSES),)
-
-RELEASE_CLASSES := $(patsubst %,%,$(CLASSES))
-
-ifdef BUILD_OPT
-	RELEASE_CLASS_PATH := $(patsubst %,$(SOURCE_CLASSES_DIR)/$(PACKAGE)/%, $(RELEASE_CLASSES))
-	RELEASE_NESTED := $(foreach file,$(RELEASE_CLASS_PATH),$(wildcard $(file)$$*))
-	RELEASE_FILES := $(patsubst %,%.class,$(RELEASE_CLASS_PATH)) $(RELEASE_NESTED)
-else
-	RELEASE_DBG_CLASS_PATH:= $(patsubst %,$(SOURCE_CLASSES_DBG_DIR)/$(PACKAGE)/%, $(RELEASE_CLASSES))
-	RELEASE_DBG_NESTED := $(foreach file,$(RELEASE_DBG_CLASS_PATH),$(wildcard $(file)$$*))
-	RELEASE_DBG_FILES := $(patsubst %,%.class,$(RELEASE_DBG_CLASS_PATH)) $(RELEASE_DBG_NESTED)
-endif
-
-# Substitute \$ for $ so the shell doesn't choke
-ifdef BUILD_OPT
-release_classes:
-	$(INSTALL) -m 444 $(subst $$,\$$,$(RELEASE_FILES)) $(SOURCE_RELEASE_PREFIX)/$(SOURCE_RELEASE_CLASSES_DIR)/$(PACKAGE)
-else
-release_classes:
-	$(INSTALL) -m 444 $(subst $$,\$$,$(RELEASE_DBG_FILES)) $(SOURCE_RELEASE_PREFIX)/$(SOURCE_RELEASE_CLASSES_DBG_DIR)/$(PACKAGE)
-endif
-
-endif
-
-release_policy: $(DIRS)
+release: release_clean release_export release_md
 
 ifndef NO_MD_RELEASE
     ifdef LIBRARY
@@ -206,6 +89,10 @@ alltags:
 	find . -name dist -prune -o \( -name '*.[hc]' -o -name '*.cp' -o -name '*.cpp' \) -print | xargs etags -a
 	find . -name dist -prune -o \( -name '*.[hc]' -o -name '*.cp' -o -name '*.cpp' \) -print | xargs ctags -a
 
+.SECONDEXPANSION:
+%/d:
+	@$(MAKE_OBJDIR)
+
 define PROGRAM_template
 
 ifndef $(1)_OBJS
@@ -220,8 +107,7 @@ ifndef $(1)_OBJS
 endif
 endif
 
-$(1): $$($(1)_OBJS) $$(EXTRA_LIBS)
-	@$$(MAKE_OBJDIR)
+$(1): $$($(1)_OBJS) $$(EXTRA_LIBS) | $$$$(@D)/d
 	rm -f $$@
 ifeq (,$$(filter-out _WIN%,$$(NS_USE_GCC)_$$(OS_TARGET)))
 	$$(MKPROG) $$($(1)_OBJS) -Fe$$@ -link $$(LDFLAGS) $$(XLDFLAGS) $$(EXTRA_LIBS) $$(EXTRA_SHARED_LIBS) $$(OS_LIBS)
@@ -254,8 +140,7 @@ endif
 get_objs:
 	@echo $(OBJS)
 
-$(LIBRARY): $(OBJS)
-	@$(MAKE_OBJDIR)
+$(LIBRARY): $(OBJS) | $$(@D)/d
 	rm -f $@
 ifeq (,$(filter-out _WIN%,$(NS_USE_GCC)_$(OS_TARGET)))
 	$(AR) $(OBJS)
@@ -285,8 +170,7 @@ SUB_SHLOBJS = $(foreach dir,$(SHARED_LIBRARY_DIRS),$(addprefix $(dir)/,$(shell $
 endif
 endif
 
-$(SHARED_LIBRARY): $(OBJS) $(RES) $(MAPFILE) $(SUB_SHLOBJS)
-	@$(MAKE_OBJDIR)
+$(SHARED_LIBRARY): $(OBJS) $(RES) $(MAPFILE) $(SUB_SHLOBJS) | $$(@D)/d
 	rm -f $@
 ifeq ($(OS_TARGET)$(OS_RELEASE), AIX4.1)
 	echo "#!" > $(OBJDIR)/lib$(LIBRARY_NAME)_syms
@@ -322,8 +206,7 @@ endif
 endif
 
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
-$(RES): $(RESNAME)
-	@$(MAKE_OBJDIR)
+$(RES): $(RESNAME) | $$(@D)/d
 # The resource compiler does not understand the -U option.
 ifdef NS_USE_GCC
 	$(RC) $(filter-out -U%,$(DEFINES)) $(INCLUDES:-I%=--include-dir %) -o $@ $<
@@ -333,8 +216,7 @@ endif
 	@echo $(RES) finished
 endif
 
-$(MAPFILE): $(MAPFILE_SOURCE)
-	@$(MAKE_OBJDIR)
+$(MAPFILE): $(MAPFILE_SOURCE) | $$(@D)/d
 	$(PROCESS_MAP_FILE)
 
 WCCFLAGS1 := $(subst /,\\,$(CFLAGS))
@@ -377,8 +259,7 @@ endif
 # The quotes allow absolute paths to contain spaces.
 core_abspath = '$(if $(findstring :,$(1)),$(1),$(if $(filter /%,$(1)),$(1),$(PWD)/$(1)))'
 
-$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.c
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.c | $$(@D)/d
 ifdef USE_NT_C_SYNTAX
 	$(CC) -Fo$@ -c $(CFLAGS) $(call core_abspath,$<)
 else
@@ -389,7 +270,7 @@ else
 endif
 endif
 
-$(PROG_PREFIX)%$(OBJ_SUFFIX): %.c
+$(PROG_PREFIX)%$(OBJ_SUFFIX): %.c | $$(@D)/d
 ifdef USE_NT_C_SYNTAX
 	$(CC) -Fo$@ -c $(CFLAGS) $(call core_abspath,$<)
 else
@@ -401,21 +282,17 @@ endif
 endif
 
 ifneq (,$(filter-out _WIN%,$(NS_USE_GCC)_$(OS_TARGET)))
-$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.s
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.s | $$(@D)/d
 	$(AS) -o $@ $(ASFLAGS) -c $<
 endif
 
-$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.asm
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.asm | $$(@D)/d
 	$(AS) -Fo$@ $(ASFLAGS) -c $<
 
-$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.S
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.S | $$(@D)/d
 	$(AS) -o $@ $(ASFLAGS) -c $<
 
-$(OBJDIR)/$(PROG_PREFIX)%: %.cpp
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/$(PROG_PREFIX)%: %.cpp | $$(@D)/d
 ifdef USE_NT_C_SYNTAX
 	$(CCC) -Fo$@ -c $(CFLAGS) $(CXXFLAGS) $(call core_abspath,$<)
 else
@@ -426,44 +303,28 @@ else
 endif
 endif
 
-#
-# Please keep the next two rules in sync.
-#
-$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.cc
-	$(MAKE_OBJDIR)
-ifdef STRICT_CPLUSPLUS_SUFFIX
-	echo "#line 1 \"$<\"" | cat - $< > $(OBJDIR)/t_$*.cc
-	$(CCC) -o $@ -c $(CFLAGS) $(CXXFLAGS) $(OBJDIR)/t_$*.cc
-	rm -f $(OBJDIR)/t_$*.cc
-else
-ifdef USE_NT_C_SYNTAX
-	$(CCC) -Fo$@ -c $(CFLAGS) $(CXXFLAGS) $(call core_abspath,$<)
-else
-ifdef NEED_ABSOLUTE_PATH
-	$(CCC) -o $@ -c $(CFLAGS) $(CXXFLAGS) $(call core_abspath,$<)
-else
-	$(CCC) -o $@ -c $(CFLAGS) $(CXXFLAGS) $<
-endif
-endif
-endif #STRICT_CPLUSPLUS_SUFFIX
+define compile_ccc_pattern_RULE
 
-$(OBJDIR)/$(PROG_PREFIX)%$(OBJ_SUFFIX): %.cpp
-	@$(MAKE_OBJDIR)
+$$(OBJDIR)/$$(PROG_PREFIX)%$$(OBJ_SUFFIX): %.$(1) | $$$$(@D)/d
 ifdef STRICT_CPLUSPLUS_SUFFIX
-	echo "#line 1 \"$<\"" | cat - $< > $(OBJDIR)/t_$*.cc
-	$(CCC) -o $@ -c $(CFLAGS) $(CXXFLAGS) $(OBJDIR)/t_$*.cc
-	rm -f $(OBJDIR)/t_$*.cc
+	echo "#line 1 \"$$<\"" | cat - $$< > $$(OBJDIR)/t_$$*.cc
+	$$(CCC) -o $$@ -c $$(CFLAGS) $$(CXXFLAGS) $$(OBJDIR)/t_$$*.cc
+	rm -f $$(OBJDIR)/t_$$*.cc
 else
 ifdef USE_NT_C_SYNTAX
-	$(CCC) -Fo$@ -c $(CFLAGS) $(CXXFLAGS) $(call core_abspath,$<)
+	$$(CCC) -Fo$$@ -c $$(CFLAGS) $$(CXXFLAGS) $$(call core_abspath,$$<)
 else
 ifdef NEED_ABSOLUTE_PATH
-	$(CCC) -o $@ -c $(CFLAGS) $(CXXFLAGS) $(call core_abspath,$<)
+	$$(CCC) -o $$@ -c $$(CFLAGS) $$(CXXFLAGS) $$(call core_abspath,$$<)
 else
-	$(CCC) -o $@ -c $(CFLAGS) $(CXXFLAGS) $<
+	$$(CCC) -o $$@ -c $$(CFLAGS) $$(CXXFLAGS) $$<
 endif
 endif
 endif #STRICT_CPLUSPLUS_SUFFIX
+endef # compile_ccc_pattern_RULE
+
+$(eval $(call compile_ccc_pattern_RULE,cc))
+$(eval $(call compile_ccc_pattern_RULE,cpp))
 
 %.i: %.cpp
 	$(CCC) -C -E $(CFLAGS) $(CXXFLAGS) $< > $@
@@ -486,296 +347,24 @@ endif
 %: %.sh
 	rm -f $@; cp $< $@; chmod +x $@
 
-################################################################################
-# Bunch of things that extend the 'export' rule (in order):
-################################################################################
-
-$(JAVA_DESTPATH) $(JAVA_DESTPATH)/$(PACKAGE) $(JMCSRCDIR):
-	@if test ! -d $@; then	    \
-		echo Creating $@;   \
-		rm -rf $@;	    \
-		$(NSINSTALL) -D $@; \
-	fi
-
-################################################################################
-## IDL_GEN
-
-ifneq ($(IDL_GEN),)
-
-#export:
-#	$(IDL2JAVA) $(IDL_GEN)
-
-#all: export
-
-#clobber:
-#	rm -f $(IDL_GEN:.idl=.class)	# XXX wrong!
-
-endif
-
-################################################################################
-### JSRCS -- for compiling java files
-###
-###          NOTE:  For backwards compatibility, if $(NETLIBDEPTH) is defined,
-###                 replace $(CORE_DEPTH) with $(NETLIBDEPTH).
-###
-
-ifneq ($(JSRCS),)
-ifneq ($(JAVAC),)
-ifdef NETLIBDEPTH
-	CORE_DEPTH := $(NETLIBDEPTH)
-endif
-
-JAVA_EXPORT_SRCS=$(shell $(PERL) $(CORE_DEPTH)/coreconf/outofdate.pl $(PERLARG)	-d $(JAVA_DESTPATH)/$(PACKAGE) $(JSRCS) $(PRIVATE_JSRCS))
-
-export: $(JAVA_DESTPATH) $(JAVA_DESTPATH)/$(PACKAGE)
-ifneq ($(JAVA_EXPORT_SRCS),)
-	$(JAVAC) $(JAVA_EXPORT_SRCS)
-endif
-
-all: export
-
-clobber:
-	rm -f $(SOURCE_XP_DIR)/classes/$(PACKAGE)/*.class
-
-endif
-endif
-
-#
-# JDIRS -- like JSRCS, except you can give a list of directories and it will
-# compile all the out-of-date java files in those directories.
-#
-# NOTE: recursing through these can speed things up, but they also cause
-# some builds to run out of memory
-#
-# NOTE:  For backwards compatibility, if $(NETLIBDEPTH) is defined,
-#        replace $(CORE_DEPTH) with $(NETLIBDEPTH).
-#
-ifdef JDIRS
-ifneq ($(JAVAC),)
-ifdef NETLIBDEPTH
-	CORE_DEPTH := $(NETLIBDEPTH)
-endif
-
-# !!!!! THIS WILL CRASH SHMSDOS.EXE !!!!!
-# shmsdos does not support shell variables. It will crash when it tries
-# to parse the '=' character. A solution is to rewrite outofdate.pl so it
-# takes the Javac command as an argument and executes the command itself,
-# instead of returning a list of files.
-export: $(JAVA_DESTPATH) $(JAVA_DESTPATH)/$(PACKAGE)
-	@echo "!!! THIS COMMAND IS BROKEN ON WINDOWS--SEE rules.mk FOR DETAILS !!!"
-	return -1
-	@for d in $(JDIRS); do							\
-		if test -d $$d; then						\
-			set $(EXIT_ON_ERROR);					\
-			files=`echo $$d/*.java`;				\
-			list=`$(PERL) $(CORE_DEPTH)/coreconf/outofdate.pl $(PERLARG)	\
-				    -d $(JAVA_DESTPATH)/$(PACKAGE) $$files`;	\
-			if test "$${list}x" != "x"; then			\
-			    echo Building all java files in $$d;		\
-			    echo $(JAVAC) $$list;				\
-			    $(JAVAC) $$list;					\
-			fi;							\
-			set +e;							\
-		else								\
-			echo "Skipping non-directory $$d...";			\
-		fi;								\
-		$(CLICK_STOPWATCH);						\
-	done
-endif
-endif
-
-#
-# JDK_GEN -- for generating "old style" native methods 
-#
-# Generate JDK Headers and Stubs into the '_gen' and '_stubs' directory
-#
-# NOTE:  For backwards compatibility, if $(NETLIBDEPTH) is defined,
-#        replace $(CORE_DEPTH) with $(NETLIBDEPTH).
-#
-ifneq ($(JDK_GEN),)
-ifneq ($(JAVAH),)
-ifdef NSBUILDROOT
-	INCLUDES += -I$(JDK_GEN_DIR) -I$(SOURCE_XP_DIR)
-else
-	INCLUDES += -I$(JDK_GEN_DIR)
-endif
-
-ifdef NETLIBDEPTH
-	CORE_DEPTH := $(NETLIBDEPTH)
-endif
-
-JDK_PACKAGE_CLASSES	:= $(JDK_GEN)
-JDK_PATH_CLASSES	:= $(subst .,/,$(JDK_PACKAGE_CLASSES))
-JDK_HEADER_CLASSFILES	:= $(patsubst %,$(JAVA_DESTPATH)/%.class,$(JDK_PATH_CLASSES))
-JDK_STUB_CLASSFILES	:= $(patsubst %,$(JAVA_DESTPATH)/%.class,$(JDK_PATH_CLASSES))
-JDK_HEADER_CFILES	:= $(patsubst %,$(JDK_GEN_DIR)/%.h,$(JDK_GEN))
-JDK_STUB_CFILES		:= $(patsubst %,$(JDK_STUB_DIR)/%.c,$(JDK_GEN))
-
-$(JDK_HEADER_CFILES): $(JDK_HEADER_CLASSFILES)
-$(JDK_STUB_CFILES): $(JDK_STUB_CLASSFILES)
+define copy_varlist_into_dir_RULE
+ifdef $(2)
+ifneq (,$$(strip $$($(2))))
+$(3)/%: %
+	$$(INSTALL) -m 444 $$^ $(3)
 
-export:
-	@echo Generating/Updating JDK headers 
-	$(JAVAH) -d $(JDK_GEN_DIR) $(JDK_PACKAGE_CLASSES)
-	@echo Generating/Updating JDK stubs
-	$(JAVAH) -stubs -d $(JDK_STUB_DIR) $(JDK_PACKAGE_CLASSES)
-ifndef NO_MAC_JAVA_SHIT
-	@if test ! -d $(CORE_DEPTH)/lib/mac/Java/; then						\
-		echo "!!! You need to have a ns/lib/mac/Java directory checked out.";		\
-		echo "!!! This allows us to automatically update generated files for the mac.";	\
-		echo "!!! If you see any modified files there, please check them in.";		\
-	fi
-	@echo Generating/Updating JDK headers for the Mac
-	$(JAVAH) -mac -d $(CORE_DEPTH)/lib/mac/Java/_gen $(JDK_PACKAGE_CLASSES)
-	@echo Generating/Updating JDK stubs for the Mac
-	$(JAVAH) -mac -stubs -d $(CORE_DEPTH)/lib/mac/Java/_stubs $(JDK_PACKAGE_CLASSES)
-endif
-endif
+$(1): $$(addprefix $(3)/,$$($(2))) | $(3)/d
 endif
-
-#
-# JRI_GEN -- for generating "old style" JRI native methods
-#
-# Generate JRI Headers and Stubs into the 'jri' directory
-#
-# NOTE:  For backwards compatibility, if $(NETLIBDEPTH) is defined,
-#        replace $(CORE_DEPTH) with $(NETLIBDEPTH).
-#
-ifneq ($(JRI_GEN),)
-ifneq ($(JAVAH),)
-ifdef NSBUILDROOT
-	INCLUDES += -I$(JRI_GEN_DIR) -I$(SOURCE_XP_DIR)
 else
-	INCLUDES += -I$(JRI_GEN_DIR)
+$(1):
 endif
+endef # copy_varlist_into_dir_RULE
 
-ifdef NETLIBDEPTH
-	CORE_DEPTH := $(NETLIBDEPTH)
-endif
-
-JRI_PACKAGE_CLASSES	:= $(JRI_GEN)
-JRI_PATH_CLASSES	:= $(subst .,/,$(JRI_PACKAGE_CLASSES))
-JRI_HEADER_CLASSFILES	:= $(patsubst %,$(JAVA_DESTPATH)/%.class,$(JRI_PATH_CLASSES))
-JRI_STUB_CLASSFILES	:= $(patsubst %,$(JAVA_DESTPATH)/%.class,$(JRI_PATH_CLASSES))
-JRI_HEADER_CFILES	:= $(patsubst %,$(JRI_GEN_DIR)/%.h,$(JRI_GEN))
-JRI_STUB_CFILES		:= $(patsubst %,$(JRI_GEN_DIR)/%.c,$(JRI_GEN))
+# export rule
+$(eval $(call copy_varlist_into_dir_RULE,export,EXPORTS,$(SOURCE_XPHEADERS_DIR)))
 
-$(JRI_HEADER_CFILES): $(JRI_HEADER_CLASSFILES)
-$(JRI_STUB_CFILES): $(JRI_STUB_CLASSFILES)
-
-export:
-	@echo Generating/Updating JRI headers 
-	$(JAVAH) -jri -d $(JRI_GEN_DIR) $(JRI_PACKAGE_CLASSES)
-	@echo Generating/Updating JRI stubs
-	$(JAVAH) -jri -stubs -d $(JRI_GEN_DIR) $(JRI_PACKAGE_CLASSES)
-ifndef NO_MAC_JAVA_SHIT
-	@if test ! -d $(CORE_DEPTH)/lib/mac/Java/; then						\
-		echo "!!! You need to have a ns/lib/mac/Java directory checked out.";		\
-		echo "!!! This allows us to automatically update generated files for the mac.";	\
-		echo "!!! If you see any modified files there, please check them in.";		\
-	fi
-	@echo Generating/Updating JRI headers for the Mac
-	$(JAVAH) -jri -mac -d $(CORE_DEPTH)/lib/mac/Java/_jri $(JRI_PACKAGE_CLASSES)
-	@echo Generating/Updating JRI stubs for the Mac
-	$(JAVAH) -jri -mac -stubs -d $(CORE_DEPTH)/lib/mac/Java/_jri $(JRI_PACKAGE_CLASSES)
-endif
-endif
-endif
-
-#
-# JNI_GEN -- for generating JNI native methods
-#
-# Generate JNI Headers into the 'jni' directory
-#
-ifneq ($(JNI_GEN),)
-ifneq ($(JAVAH),)
-JNI_HEADERS		:= $(patsubst %,$(JNI_GEN_DIR)/%.h,$(JNI_GEN))
-
-export:
-	@if test ! -d $(JNI_GEN_DIR); then						\
-		echo $(JAVAH) -jni -d $(JNI_GEN_DIR) $(JNI_GEN);			\
-		$(JAVAH) -jni -d $(JNI_GEN_DIR) $(JNI_GEN);				\
-	else										\
-		echo "Checking for out of date header files" ;                          \
-		$(PERL) $(CORE_DEPTH)/coreconf/jniregen.pl $(PERLARG)			\
-		 -d $(JAVA_DESTPATH) -j "$(JAVAH) -jni -d $(JNI_GEN_DIR)" $(JNI_GEN);\
-	fi
-endif
-endif
-
-#
-# JMC_EXPORT -- for declaring which java classes are to be exported for jmc
-#
-ifneq ($(JMC_EXPORT),)
-JMC_EXPORT_PATHS	:= $(subst .,/,$(JMC_EXPORT))
-JMC_EXPORT_FILES	:= $(patsubst %,$(JAVA_DESTPATH)/$(PACKAGE)/%.class,$(JMC_EXPORT_PATHS))
-
-#
-# We're doing NSINSTALL -t here (copy mode) because calling INSTALL will pick up 
-# your NSDISTMODE and make links relative to the current directory. This is a
-# problem because the source isn't in the current directory:
-#
-export: $(JMC_EXPORT_FILES) $(JMCSRCDIR)
-	$(NSINSTALL) -t -m 444 $(JMC_EXPORT_FILES) $(JMCSRCDIR)
-endif
-
-#
-# JMC_GEN -- for generating java modules
-#
-# Provide default export & install rules when using JMC_GEN
-#
-ifneq ($(JMC_GEN),)
-ifneq ($(JMC),)
-	INCLUDES    += -I$(JMC_GEN_DIR) -I.
-	JMC_HEADERS := $(patsubst %,$(JMC_GEN_DIR)/%.h,$(JMC_GEN))
-	JMC_STUBS   := $(patsubst %,$(JMC_GEN_DIR)/%.c,$(JMC_GEN))
-	JMC_OBJS    := $(patsubst %,$(OBJDIR)/%$(OBJ_SUFFIX),$(JMC_GEN))
-
-$(JMC_GEN_DIR)/M%.h: $(JMCSRCDIR)/%.class
-	$(JMC) -d $(JMC_GEN_DIR) -interface $(JMC_GEN_FLAGS) $(?F:.class=)
-
-$(JMC_GEN_DIR)/M%.c: $(JMCSRCDIR)/%.class
-	$(JMC) -d $(JMC_GEN_DIR) -module $(JMC_GEN_FLAGS) $(?F:.class=)
-
-$(OBJDIR)/M%$(OBJ_SUFFIX): $(JMC_GEN_DIR)/M%.c $(JMC_GEN_DIR)/M%.h
-	@$(MAKE_OBJDIR)
-	$(CC) -o $@ -c $(CFLAGS) $<
-
-export: $(JMC_HEADERS) $(JMC_STUBS)
-endif
-endif
-
-#
-# Copy each element of EXPORTS to $(SOURCE_XP_DIR)/public/$(MODULE)/
-#
-PUBLIC_EXPORT_DIR = $(SOURCE_XP_DIR)/public/$(MODULE)
-
-ifneq ($(EXPORTS),)
-$(PUBLIC_EXPORT_DIR)/d:
-	@$(MAKE_OBJDIR)
-
-$(PUBLIC_EXPORT_DIR)/%: %
-	$(INSTALL) -m 444 $^ $(PUBLIC_EXPORT_DIR)
-
-export: $(addprefix $(PUBLIC_EXPORT_DIR)/,$(EXPORTS)) | $(PUBLIC_EXPORT_DIR)/d
-endif
-
-# Duplicate export rule for private exports, with different directories
-
-PRIVATE_EXPORT_DIR = $(SOURCE_XP_DIR)/private/$(MODULE)
-
-ifneq ($(PRIVATE_EXPORTS),)
-$(PRIVATE_EXPORT_DIR)/d:
-	@$(MAKE_OBJDIR)
-
-$(PRIVATE_EXPORT_DIR)/%: %
-	$(INSTALL) -m 444 $^ $(PRIVATE_EXPORT_DIR)
-
-private_export: $(addprefix $(PRIVATE_EXPORT_DIR)/,$(PRIVATE_EXPORTS)) | $(PRIVATE_EXPORT_DIR)/d
-else
-private_export:
-	@echo "There are no private exports."
-endif
+# private_export rule
+$(eval $(call copy_varlist_into_dir_RULE,private_export,PRIVATE_EXPORTS,$(SOURCE_XPPRIVATE_DIR)))
 
 ##########################################################################
 ###   RULES FOR RUNNING REGRESSION SUITE TESTS
@@ -791,13 +380,9 @@ ifneq ($(BUILD_OPT),)
 REGDATE = $(subst \ ,, $(shell $(PERL)  $(CORE_DEPTH)/$(MODULE)/scripts/now))
 endif
 
-check: $(REGRESSION_SPEC)
+check: $(REGRESSION_SPEC) | $(TESTS_DIR)/d
 	cd $(PLATFORM); \
-	../$(SOURCE_MD_DIR)/bin/regress$(PROG_SUFFIX) specfile=../$(REGRESSION_SPEC) progress $(EXTRA_REGRESS_OPTIONS); \
-	if test ! -d $(TESTS_DIR); then \
-		echo Creating $(TESTS_DIR);   \
-		$(NSINSTALL) -D $(TESTS_DIR); \
-	fi
+	../$(SOURCE_MD_DIR)/bin/regress$(PROG_SUFFIX) specfile=../$(REGRESSION_SPEC) progress $(EXTRA_REGRESS_OPTIONS)
 ifneq ($(BUILD_OPT),)
 	$(NSINSTALL) -m 664 $(PLATFORM)/$(REGDATE).sum $(TESTS_DIR); \
 	$(NSINSTALL) -m 664 $(PLATFORM)/$(REGDATE).htm $(TESTS_DIR); \
@@ -809,100 +394,8 @@ check:
 	@echo "Error: you didn't specify REGRESSION_SPEC in your manifest.mn file!"
 endif
 
-
-# Duplicate export rule for releases, with different directories
-
-ifneq ($(EXPORTS),)
-$(SOURCE_RELEASE_XP_DIR)/include:
-	@if test ! -d $@; then	    \
-		echo Creating $@;   \
-		$(NSINSTALL) -D $@; \
-	fi
-
-release_export: $(SOURCE_RELEASE_XP_DIR)/include
-
-release_export: $(EXPORTS)
-	$(INSTALL) -m 444 $^ $(SOURCE_RELEASE_XP_DIR)/include
-endif
-
-
-
-
-################################################################################
-
-ifeq ($(MAKECMDGOALS),clean)
--include $(DEPENDENCIES)
-
-ifneq (,$(filter-out OS2 WIN%,$(OS_TARGET)))
-# Can't use sed because of its 4000-char line length limit, so resort to perl
-PERL_DEPENDENCIES_PROGRAM =                                                   \
-	    open(MD, "< $(DEPENDENCIES)");                                    \
-	    while (<MD>) {                                                    \
-		if (m@ \.*/*$< @) {                                           \
-		    $$found = 1;                                              \
-		    last;                                                     \
-		}                                                             \
-	    }                                                                 \
-	    if ($$found) {                                                    \
-		print "Removing stale dependency $< from $(DEPENDENCIES)\n";  \
-		seek(MD, 0, 0);                                               \
-		$$tmpname = "$(OBJDIR)/fix.md" . $$$$;                        \
-		open(TMD, "> " . $$tmpname);                                  \
-		while (<MD>) {                                                \
-		    s@ \.*/*$< @ @;                                           \
-		    if (!print TMD "$$_") {                                   \
-			unlink(($$tmpname));                                  \
-			exit(1);                                              \
-		    }                                                         \
-		}                                                             \
-		close(TMD);                                                   \
-		if (!rename($$tmpname, "$(DEPENDENCIES)")) {                  \
-		    unlink(($$tmpname));                                      \
-		}                                                             \
-	    } elsif ("$<" ne "$(DEPENDENCIES)") {                             \
-		print "$(MAKE): *** No rule to make target $<.  Stop.\n";     \
-		exit(1);                                                      \
-	    }
-
-.DEFAULT:
-	@$(PERL) -e '$(PERL_DEPENDENCIES_PROGRAM)'
-endif
-
-#############################################################################
-# X dependency system
-#############################################################################
-
-ifdef MKDEPENDENCIES
-
-# For Windows, $(MKDEPENDENCIES) must be -included before including rules.mk
-
-$(MKDEPENDENCIES):
-	@$(MAKE_OBJDIR)
-	touch $(MKDEPENDENCIES) 
-	chmod u+w $(MKDEPENDENCIES) 
-#on NT, the preceding touch command creates a read-only file !?!?!
-#which is why we have to explicitly chmod it.
-	$(MKDEPEND) -p$(OBJDIR_NAME)/ -o'$(OBJ_SUFFIX)' -f$(MKDEPENDENCIES) \
-$(NOMD_CFLAGS) $(YOPT) $(CSRCS) $(CPPSRCS) $(ASFILES)
-
-$(MKDEPEND): $(MKDEPEND_DIR)/*.c $(MKDEPEND_DIR)/*.h
-	$(MAKE) -C $(MKDEPEND_DIR)
-
-ifdef OBJS
-depend: $(DIRS) $(MKDEPEND) $(MKDEPENDENCIES)
-else
-depend: $(DIRS)
-endif
-
-dependclean: $(DIRS)
-	rm -f $(MKDEPENDENCIES)
-
-#-include $(NSINSTALL_DIR)/$(OBJDIR)/depend.mk
-
-else
-depend:
-endif
-endif
+# release_export rule
+$(eval $(call copy_varlist_into_dir_RULE,release_export,EXPORTS,$(SOURCE_RELEASE_XP_DIR)/include))
 
 #
 # HACK ALERT
@@ -936,12 +429,7 @@ $(filter $(OBJDIR)/%$(OBJ_SUFFIX),$(OBJS)): $(OBJDIR)/%$(OBJ_SUFFIX): $(DUMMY_DE
 # hundreds of built-in suffix rules for stuff we don't need.
 #
 .SUFFIXES:
-.SUFFIXES: .out .a .ln .o .obj .c .cc .C .cpp .y .l .s .S .h .sh .i .pl .class .java .html .asm .dep
-
-#
-# Don't delete these files if we get killed.
-#
-.PRECIOUS: .java $(JDK_HEADERS) $(JDK_STUBS) $(JRI_HEADERS) $(JRI_STUBS) $(JMC_HEADERS) $(JMC_STUBS) $(JNI_HEADERS)
+.SUFFIXES: .out .a .ln .o .obj .c .cc .C .cpp .y .l .s .S .h .sh .i .pl .html .asm .dep
 
 #
 # Fake targets.  Always run these rules, even if a file/directory with that
diff --git a/nss/coreconf/ruleset.mk b/nss/coreconf/ruleset.mk
index 43ea718..01207cd 100644
--- a/nss/coreconf/ruleset.mk
+++ b/nss/coreconf/ruleset.mk
@@ -22,29 +22,6 @@
 # e)                                                                  #
 #	LIBRARY	-- the target library name to create from $OBJS       #
 #			($OBJDIR automatically prepended to it)       #
-# f)                                                                  #
-#	JSRCS	-- java source files to compile into class files      #
-#			(if you don't specify this it will default    #
-#			 to *.java)                                   #
-# g)                                                                  #
-#	PACKAGE	-- the package to put the .class files into           #
-#			(e.g. netscape/applet)                        #
-#			(NOTE: the default definition for this may be #
-#                              overridden if "jdk.mk" is included)    #
-# h)                                                                  #
-#	JMC_EXPORT -- java files to be exported for use by JMC_GEN    #
-#			(this is a list of Class names)               #
-# i)                                                                  #
-#	JRI_GEN	-- files to run through javah to generate headers     #
-#                  and stubs                                          #
-#			(output goes into the _jri sub-dir)           #
-# j)                                                                  #
-#	JMC_GEN	-- files to run through jmc to generate headers       #
-#                  and stubs                                          #
-#			(output goes into the _jmc sub-dir)           #
-# k)                                                                  #
-#	JNI_GEN	-- files to run through javah to generate headers     #
-#			(output goes into the _jni sub-dir)           #
 #                                                                     #
 #######################################################################
 
@@ -79,20 +56,54 @@ endif
 # - (3) IMPORT_LIBRARY: an import library, defined in $(OS_TARGET).mk
 # - (4) PROGRAM: an executable binary
 #
-# NOTE:  The names of libraries can be generated by simply specifying
-# LIBRARY_NAME (and LIBRARY_VERSION in the case of non-static libraries).
-# LIBRARY and SHARED_LIBRARY may be defined differently in $(OS_TARGET).mk
+# A library is build by specifying the LIBRARY_NAME variable.
+# If you want to build only a static library, set SHARED_LIBRARY = $(NULL)
+# If you want to build only a shared library, set LIBRARY = $(NULL)
+# You can specify the shared library major version via LIBRARY_VERSION.
 #
+# Normally you want to link to the shared library. In this case you must
+# provide an export script, like:
+#   MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def.
+# Unfortunatly this variable is needed by the ARCH setup, so you have to set
+# it explicitly in the manifest.mn.
+#
+# Per default, it's assumed the shared library provides resource specification
+# in the file RES. You can set it to $(NULL), if that is not true.
+#
+# If you have an unversioned SHARED_LIBRARY, you must explicitly change or
+# disable the static LIBRARY, as these normally clash on Windows.
 
 ifdef LIBRARY_NAME
     ifndef LIBRARY
-	LIBRARY        = $(OBJDIR)/$(LIB_PREFIX)$(LIBRARY_NAME).$(LIB_SUFFIX)
+	LIBRARY := $(OBJDIR)/$(LIB_PREFIX)$(LIBRARY_NAME).$(LIB_SUFFIX)
     endif
     ifndef SHARED_LIBRARY
-	SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(JDK_DEBUG_SUFFIX).$(DLL_SUFFIX)
+	SHARED_LIBRARY := $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
+    endif
+
+    ifneq ($(SHARED_LIBRARY),)
+
+    ifdef IMPORT_LIB_SUFFIX
+    ifdef MAPFILE
+    ifndef IMPORT_LIBRARY
+	IMPORT_LIBRARY := $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
+    endif
     endif
+    endif
+
     ifndef MAPFILE_SOURCE
-	MAPFILE_SOURCE = $(LIBRARY_NAME).def
+	MAPFILE_SOURCE := $(LIBRARY_NAME).def
+    endif
+
+    ifeq (,$(filter-out WIN%,$(OS_TARGET)))
+    ifndef RES
+	RES := $(OBJDIR)/$(LIBRARY_NAME).res
+    endif
+    ifndef RESNAME
+	RESNAME := $(LIBRARY_NAME).rc
+    endif
+    endif
+
     endif
 endif
 
@@ -101,11 +112,11 @@ endif
 #
 
 ifdef PROGRAM
-    PROGRAM := $(addprefix $(OBJDIR)/, $(PROGRAM)$(JDK_DEBUG_SUFFIX)$(PROG_SUFFIX))
+    PROGRAM := $(addprefix $(OBJDIR)/, $(PROGRAM)$(PROG_SUFFIX))
 endif
 
 ifdef PROGRAMS
-    PROGRAMS := $(addprefix $(OBJDIR)/, $(PROGRAMS:%=%$(JDK_DEBUG_SUFFIX)$(PROG_SUFFIX)))
+    PROGRAMS := $(addprefix $(OBJDIR)/, $(PROGRAMS:%=%$(PROG_SUFFIX)))
 endif
 
 ifndef TARGETS
@@ -117,8 +128,7 @@ CPPSRCS1 = $(CPPSRCS:.cpp=$(OBJ_SUFFIX))
 CPPSRCS2 = $(CPPSRCS1:.cc=$(OBJ_SUFFIX))
 
 ifndef OBJS
-    SIMPLE_OBJS = $(JRI_STUB_CFILES) \
-		$(addsuffix $(OBJ_SUFFIX), $(JMC_GEN)) \
+    SIMPLE_OBJS = \
 		$(CSRCS:.c=$(OBJ_SUFFIX)) \
 		$(CPPSRCS2) \
 		$(ASFILES:$(ASM_SUFFIX)=$(OBJ_SUFFIX)) \
@@ -139,46 +149,9 @@ if test ! -d $(@D); then $(NSINSTALL) -D $(@D); fi
 endef
 endif
 
-ifndef PACKAGE
-    PACKAGE = .
-endif
-
-ifdef NSBUILDROOT
-    JDK_GEN_DIR  = $(SOURCE_XP_DIR)/_gen
-    JMC_GEN_DIR  = $(SOURCE_XP_DIR)/_jmc
-    JNI_GEN_DIR  = $(SOURCE_XP_DIR)/_jni
-    JRI_GEN_DIR  = $(SOURCE_XP_DIR)/_jri
-    JDK_STUB_DIR = $(SOURCE_XP_DIR)/_stubs
-else
-    JDK_GEN_DIR  = _gen
-    JMC_GEN_DIR  = _jmc
-    JNI_GEN_DIR  = _jni
-    JRI_GEN_DIR  = _jri
-    JDK_STUB_DIR = _stubs
-endif
-
 ALL_TRASH =	$(TARGETS) $(OBJS) $(OBJDIR) LOGS TAGS $(GARBAGE) \
 		so_locations $(BUILT_SRCS) $(NOSUCHFILE)
 
-ifdef NS_USE_JDK
-    ALL_TRASH += $(JDK_HEADER_CFILES) $(JDK_STUB_CFILES) \
-		 $(JMC_HEADERS) $(JMC_STUBS) $(JMC_EXPORT_FILES) \
-		 $(JNI_HEADERS) \
-		 $(JRI_HEADER_CFILES) $(JRI_STUB_CFILES) \
-		 $(JDK_GEN_DIR) $(JMC_GEN_DIR) $(JNI_GEN_DIR) \
-		 $(JRI_GEN_DIR) $(JDK_STUB_DIR)
-
-ifdef JAVA_DESTPATH
-    ALL_TRASH += $(wildcard $(JAVA_DESTPATH)/$(PACKAGE)/*.class)
-ifdef JDIRS
-    ALL_TRASH += $(addprefix $(JAVA_DESTPATH)/,$(JDIRS))
-endif
-else # !JAVA_DESTPATH
-    ALL_TRASH += $(wildcard $(PACKAGE)/*.class) $(JDIRS)
-endif
-
-endif #NS_USE_JDK
-
 ifdef NSS_BUILD_CONTINUE_ON_ERROR
 # Try to build everything. I.e., don't exit on errors.
     EXIT_ON_ERROR		= +e
diff --git a/nss/coreconf/source.mk b/nss/coreconf/source.mk
index 14bb510..94c383e 100644
--- a/nss/coreconf/source.mk
+++ b/nss/coreconf/source.mk
@@ -31,17 +31,9 @@ endif
 # <user_source_tree> cross-platform (xp) import/export directories
 #
 
-SOURCE_CLASSES_DIR     = $(SOURCE_XP_DIR)/classes
-SOURCE_CLASSES_DBG_DIR = $(SOURCE_XP_DIR)/classes_DBG
 SOURCE_XPHEADERS_DIR   = $(SOURCE_XP_DIR)/public/$(MODULE)
 SOURCE_XPPRIVATE_DIR   = $(SOURCE_XP_DIR)/private/$(MODULE)
 
-ifdef BUILD_OPT
-    IMPORT_XPCLASS_DIR = $(SOURCE_CLASSES_DIR)
-else
-    IMPORT_XPCLASS_DIR = $(SOURCE_CLASSES_DBG_DIR)
-endif
-
 #
 # <user_source_tree> machine-dependent (md) master import/export directory
 #
@@ -110,26 +102,8 @@ SOURCE_RELEASE_XP_DIR = $(SOURCE_RELEASE_PREFIX)
 # <user_source_tree> cross-platform (xp) source-side release directories
 #
 
-SOURCE_RELEASE_CLASSES_DIR     = classes
-SOURCE_RELEASE_CLASSES_DBG_DIR = classes_DBG
 SOURCE_RELEASE_XPHEADERS_DIR   = include
 
-#
-# <user_source_tree> cross-platform (xp) JAR source-side release files
-#
-
-XPCLASS_JAR     = xpclass.jar
-XPCLASS_DBG_JAR = xpclass_dbg.jar
-XPHEADER_JAR    = xpheader.jar
-
-ifdef BUILD_OPT
-    SOURCE_RELEASE_XP_CLASSES_DIR = $(SOURCE_RELEASE_CLASSES_DIR)
-    IMPORT_XPCLASS_JAR = $(XPCLASS_JAR)
-else
-    SOURCE_RELEASE_XP_CLASSES_DIR = $(SOURCE_RELEASE_CLASSES_DBG_DIR)
-    IMPORT_XPCLASS_JAR = $(XPCLASS_DBG_JAR)
-endif
-
 #
 # <user_source_tree> machine-dependent (md) source-side master release directory
 #
@@ -145,14 +119,6 @@ SOURCE_RELEASE_LIB_DIR       = $(PLATFORM)/lib
 SOURCE_RELEASE_MDHEADERS_DIR = $(PLATFORM)/include
 SOURCE_RELEASE_SPEC_DIR      = $(SOURCE_RELEASE_MD_DIR)
 
-#
-# <user_source_tree> machine-dependent (md) JAR/tar source-side release files
-#
-
-MDBINARY_JAR = mdbinary.jar
-MDHEADER_JAR = mdheader.jar
-
-
 # Where to put the results
 
 ifneq ($(RESULTS_DIR),)
diff --git a/nss/coreconf/suffix.mk b/nss/coreconf/suffix.mk
index 584bdf5..8050e4a 100644
--- a/nss/coreconf/suffix.mk
+++ b/nss/coreconf/suffix.mk
@@ -40,11 +40,6 @@ ifndef DYNAMIC_LIB_SUFFIX
     DYNAMIC_LIB_SUFFIX = .$(DLL_SUFFIX)
 endif
 
-# WIN% overridese this
-ifndef IMPORT_LIB_SUFFIX
-    IMPORT_LIB_SUFFIX = 
-endif
-
 
 ifndef STATIC_LIB_SUFFIX_FOR_LINKING
     STATIC_LIB_SUFFIX_FOR_LINKING = $(STATIC_LIB_SUFFIX)
diff --git a/nss/coreconf/version.mk b/nss/coreconf/version.mk
index c3e559c..5e2964e 100644
--- a/nss/coreconf/version.mk
+++ b/nss/coreconf/version.mk
@@ -54,10 +54,6 @@ endif
 # Set <component>-specific versions for compiliation and linkage.
 #
 
-ifndef JAVA_VERSION
-    JAVA_VERSION = $(CURRENT_VERSION_SYMLINK)
-endif
-
 ifndef NETLIB_VERSION
     NETLIB_VERSION = $(CURRENT_VERSION_SYMLINK)
 endif
diff --git a/nss/cpputil/Makefile b/nss/cpputil/Makefile
index 7adfc61..28e0f61 100644
--- a/nss/cpputil/Makefile
+++ b/nss/cpputil/Makefile
@@ -30,8 +30,6 @@ endif
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/cpputil/config.mk b/nss/cpputil/config.mk
deleted file mode 100644
index b8c03de..0000000
--- a/nss/cpputil/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/cpputil/manifest.mn b/nss/cpputil/manifest.mn
index caa859b..9bd68e0 100644
--- a/nss/cpputil/manifest.mn
+++ b/nss/cpputil/manifest.mn
@@ -6,7 +6,9 @@ CORE_DEPTH = ..
 DEPTH      = ..
 
 MODULE = nss
+
 LIBRARY_NAME = cpputil
+SHARED_LIBRARY = $(NULL)
 
 ifeq ($(NSS_BUILD_UTIL_ONLY),1)
 CPPSRCS = \
diff --git a/nss/gtests/common/Makefile b/nss/gtests/common/Makefile
index 1476e45..59c5194 100644
--- a/nss/gtests/common/Makefile
+++ b/nss/gtests/common/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-SHARED_LIBRARY = $(NULL)
-IMPORT_LIBRARY = $(NULL)
 
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
diff --git a/nss/gtests/common/manifest.mn b/nss/gtests/common/manifest.mn
index 5d36c26..2514c9f 100644
--- a/nss/gtests/common/manifest.mn
+++ b/nss/gtests/common/manifest.mn
@@ -7,6 +7,7 @@ DEPTH      = ../..
 MODULE = nss
 
 LIBRARY_NAME = gtestutil
+SHARED_LIBRARY = $(NULL)
 
 ifeq ($(NSS_BUILD_UTIL_ONLY),1)
 CPPSRCS = gtests-util.cc
diff --git a/nss/gtests/google_test/Makefile b/nss/gtests/google_test/Makefile
index f801ba1..0d547e0 100644
--- a/nss/gtests/google_test/Makefile
+++ b/nss/gtests/google_test/Makefile
@@ -20,8 +20,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (3) Include "component" configuration information. (OPTIONAL)       #
 #######################################################################
 
-SHARED_LIBRARY = $(NULL)
-IMPORT_LIBRARY = $(NULL)
 
 #######################################################################
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
diff --git a/nss/gtests/google_test/manifest.mn b/nss/gtests/google_test/manifest.mn
index 2858dc7..7c60f11 100644
--- a/nss/gtests/google_test/manifest.mn
+++ b/nss/gtests/google_test/manifest.mn
@@ -8,6 +8,7 @@ DEPTH = ../..
 MODULE = gtest
 
 LIBRARY_NAME = gtest
+SHARED_LIBRARY = $(NULL)
 
 INCLUDES += -Igtest/include/ -Igtest
 
diff --git a/nss/lib/base/Makefile b/nss/lib/base/Makefile
index ca709f6..3f49eaa 100644
--- a/nss/lib/base/Makefile
+++ b/nss/lib/base/Makefile
@@ -4,7 +4,11 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 include manifest.mn
+
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
-include $(CORE_DEPTH)/coreconf/rules.mk
 
+ifdef BUILD_IDG
+DEFINES += -DNSSDEBUG
+endif
+
+include $(CORE_DEPTH)/coreconf/rules.mk
diff --git a/nss/lib/base/config.mk b/nss/lib/base/config.mk
deleted file mode 100644
index 2676cd5..0000000
--- a/nss/lib/base/config.mk
+++ /dev/null
@@ -1,19 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-ifdef BUILD_IDG
-DEFINES += -DNSSDEBUG
-endif
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/base/manifest.mn b/nss/lib/base/manifest.mn
index da3a0f3..6c4b2db 100644
--- a/nss/lib/base/manifest.mn
+++ b/nss/lib/base/manifest.mn
@@ -33,6 +33,7 @@ CSRCS =		   \
 REQUIRES = nspr
 
 LIBRARY_NAME = nssb
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/certdb/Makefile b/nss/lib/certdb/Makefile
index c3cb5ef..bb88772 100644
--- a/nss/lib/certdb/Makefile
+++ b/nss/lib/certdb/Makefile
@@ -26,8 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/lib/certdb/config.mk b/nss/lib/certdb/config.mk
deleted file mode 100644
index b8c03de..0000000
--- a/nss/lib/certdb/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/certdb/manifest.mn b/nss/lib/certdb/manifest.mn
index 28548f4..4a8c5c4 100644
--- a/nss/lib/certdb/manifest.mn
+++ b/nss/lib/certdb/manifest.mn
@@ -35,6 +35,7 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = certdb
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/certhigh/Makefile b/nss/lib/certhigh/Makefile
index 0f71b1a..bb88772 100644
--- a/nss/lib/certhigh/Makefile
+++ b/nss/lib/certhigh/Makefile
@@ -26,8 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
--include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/lib/certhigh/config.mk b/nss/lib/certhigh/config.mk
deleted file mode 100644
index b8c03de..0000000
--- a/nss/lib/certhigh/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/certhigh/manifest.mn b/nss/lib/certhigh/manifest.mn
index ed9b910..b843e06 100644
--- a/nss/lib/certhigh/manifest.mn
+++ b/nss/lib/certhigh/manifest.mn
@@ -29,6 +29,7 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = certhi
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/ckfw/Makefile b/nss/lib/ckfw/Makefile
index 82c9b8b..effa9ab 100644
--- a/nss/lib/ckfw/Makefile
+++ b/nss/lib/ckfw/Makefile
@@ -4,8 +4,12 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 include manifest.mn
+
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
+
+ifdef BUILD_IDG
+DEFINES += -DNSSDEBUG
+endif
 
 ifdef NOTDEF # was ifdef MOZILLA_CLIENT
 NSS_BUILD_CAPI = 1
diff --git a/nss/lib/ckfw/builtins/Makefile b/nss/lib/ckfw/builtins/Makefile
index 22726e2..fc82d77 100644
--- a/nss/lib/ckfw/builtins/Makefile
+++ b/nss/lib/ckfw/builtins/Makefile
@@ -5,7 +5,24 @@
 
 include manifest.mn
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
+
+ifdef BUILD_IDG
+    DEFINES += -DNSSDEBUG
+endif
+
+# Needed for compilation of $(OBJDIR)/certdata.c
+INCLUDES += -I.
+
+#
+# To create a loadable module on Darwin, we must use -bundle.
+#
+ifeq ($(OS_TARGET),Darwin)
+DSO_LDOPTS = -bundle
+endif
+
+ifdef USE_GCOV
+DSO_LDOPTS += --coverage
+endif
 
 EXTRA_LIBS = \
 	$(DIST)/lib/$(LIB_PREFIX)nssckfw.$(LIB_SUFFIX) \
@@ -49,6 +66,5 @@ ifndef NSS_CERTDATA_TXT
 NSS_CERTDATA_TXT = certdata.txt
 endif
 
-$(OBJDIR)/certdata.c: $(NSS_CERTDATA_TXT) certdata.perl
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/certdata.c: $(NSS_CERTDATA_TXT) certdata.perl | $$(@D)/d
 	$(PERL) certdata.perl $(NSS_CERTDATA_TXT) $@
diff --git a/nss/lib/ckfw/builtins/config.mk b/nss/lib/ckfw/builtins/config.mk
deleted file mode 100644
index 6bd62f1..0000000
--- a/nss/lib/ckfw/builtins/config.mk
+++ /dev/null
@@ -1,38 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only shared libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(SHARED_LIBRARY)
-LIBRARY        =
-IMPORT_LIBRARY =
-PROGRAM        =
-
-ifeq (,$(filter-out WIN%,$(OS_TARGET)))
-    SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-    RES = $(OBJDIR)/$(LIBRARY_NAME).res
-    RESNAME = $(LIBRARY_NAME).rc
-endif
-
-ifdef BUILD_IDG
-    DEFINES += -DNSSDEBUG
-endif
-
-# Needed for compilation of $(OBJDIR)/certdata.c
-INCLUDES += -I.
-
-#
-# To create a loadable module on Darwin, we must use -bundle.
-#
-ifeq ($(OS_TARGET),Darwin)
-DSO_LDOPTS = -bundle
-endif
-
-ifdef USE_GCOV
-DSO_LDOPTS += --coverage
-endif
diff --git a/nss/lib/ckfw/builtins/manifest.mn b/nss/lib/ckfw/builtins/manifest.mn
index 5e6740f..88e5237 100644
--- a/nss/lib/ckfw/builtins/manifest.mn
+++ b/nss/lib/ckfw/builtins/manifest.mn
@@ -8,7 +8,6 @@ CORE_DEPTH = ../../..
 DIRS = testlib
 
 MODULE = nss
-MAPFILE = $(OBJDIR)/nssckbi.def
 
 EXPORTS =		\
 	nssckbi.h	\
@@ -30,3 +29,6 @@ CSRCS =			\
 REQUIRES = nspr
 
 LIBRARY_NAME = nssckbi
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
+LIBRARY = $(NULL)
+IMPORT_LIBRARY = $(NULL)
diff --git a/nss/lib/ckfw/builtins/testlib/Makefile b/nss/lib/ckfw/builtins/testlib/Makefile
index 0d85e2f..8bd6014 100644
--- a/nss/lib/ckfw/builtins/testlib/Makefile
+++ b/nss/lib/ckfw/builtins/testlib/Makefile
@@ -4,8 +4,26 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 include manifest.mn
+
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
+
+ifdef BUILD_IDG
+DEFINES += -DNSSDEBUG
+endif
+
+# Needed for compilation of $(OBJDIR)/certdata.c
+INCLUDES += -I.
+
+#
+# To create a loadable module on Darwin, we must use -bundle.
+#
+ifeq ($(OS_TARGET),Darwin)
+DSO_LDOPTS = -bundle
+endif
+
+ifdef USE_GCOV
+DSO_LDOPTS += --coverage
+endif
 
 EXTRA_LIBS =                                       \
 	$(DIST)/lib/$(LIB_PREFIX)nssckfw.$(LIB_SUFFIX) \
@@ -47,6 +65,5 @@ ifndef NSS_CERTDATA-TESTLIB_TXT
 NSS_CERTDATA-TESTLIB_TXT = certdata-testlib.txt
 endif
 
-$(OBJDIR)/certdata-testlib.c: $(NSS_CERTDATA-TESTLIB_TXT)
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/certdata-testlib.c: $(NSS_CERTDATA-TESTLIB_TXT) | $$(@D)/d
 	$(PERL) ../certdata.perl $(NSS_CERTDATA-TESTLIB_TXT) $@
diff --git a/nss/lib/ckfw/builtins/testlib/config.mk b/nss/lib/ckfw/builtins/testlib/config.mk
deleted file mode 100644
index 39a39da..0000000
--- a/nss/lib/ckfw/builtins/testlib/config.mk
+++ /dev/null
@@ -1,38 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only shared libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(SHARED_LIBRARY)
-LIBRARY        =
-IMPORT_LIBRARY =
-PROGRAM        =
-
-ifeq (,$(filter-out WIN%,$(OS_TARGET)))
-	SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-	RES = $(OBJDIR)/$(LIBRARY_NAME).res
-	RESNAME = $(LIBRARY_NAME).rc
-endif
-
-ifdef BUILD_IDG
-	DEFINES += -DNSSDEBUG
-endif
-
-# Needed for compilation of $(OBJDIR)/certdata.c
-INCLUDES += -I.
-
-#
-# To create a loadable module on Darwin, we must use -bundle.
-#
-ifeq ($(OS_TARGET),Darwin)
-DSO_LDOPTS = -bundle
-endif
-
-ifdef USE_GCOV
-DSO_LDOPTS += --coverage
-endif
diff --git a/nss/lib/ckfw/builtins/testlib/manifest.mn b/nss/lib/ckfw/builtins/testlib/manifest.mn
index 4500a90..e840a88 100644
--- a/nss/lib/ckfw/builtins/testlib/manifest.mn
+++ b/nss/lib/ckfw/builtins/testlib/manifest.mn
@@ -23,3 +23,4 @@ CSRCS =			\
 REQUIRES = nspr
 
 LIBRARY_NAME = nssckbi-testlib
+LIBRARY = $(NULL)
diff --git a/nss/lib/ckfw/capi/Makefile b/nss/lib/ckfw/capi/Makefile
index 81780d2..3949d18 100644
--- a/nss/lib/ckfw/capi/Makefile
+++ b/nss/lib/ckfw/capi/Makefile
@@ -5,7 +5,17 @@
 
 include manifest.mn
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
+
+ifdef BUILD_IDG
+DEFINES += -DNSSDEBUG
+endif
+
+#
+# To create a loadable module on Darwin, we must use -bundle.
+#
+ifeq ($(OS_TARGET),Darwin)
+DSO_LDOPTS = -bundle
+endif
 
 EXTRA_LIBS = \
 	$(DIST)/lib/$(LIB_PREFIX)nssckfw.$(LIB_SUFFIX) \
@@ -60,8 +70,7 @@ DSO_LDOPTS              = -bM:SRE -bh:4 -bnoentry
 EXTRA_DSO_LDOPTS        = -lc
 MKSHLIB                 = xlC $(DSO_LDOPTS)
 
-$(SHARED_LIBRARY): $(OBJS)
-	@$(MAKE_OBJDIR)
+$(SHARED_LIBRARY): $(OBJS) | $$(@D)/d
 	rm -f $@
 	$(MKSHLIB) -o $@ $(OBJS) $(EXTRA_LIBS) $(EXTRA_DSO_LDOPTS)
 	chmod +x $@
@@ -71,5 +80,3 @@ endif
 ifeq ($(OS_TARGET)$(OS_RELEASE), AIX4.2)
 LD      += -G
 endif 
-
-
diff --git a/nss/lib/ckfw/capi/config.mk b/nss/lib/ckfw/capi/config.mk
deleted file mode 100644
index ec0a862..0000000
--- a/nss/lib/ckfw/capi/config.mk
+++ /dev/null
@@ -1,31 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only shared libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(SHARED_LIBRARY)
-LIBRARY        =
-IMPORT_LIBRARY =
-PROGRAM        =
-
-ifeq (,$(filter-out WIN%,$(OS_TARGET)))
-    SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-    RES = $(OBJDIR)/$(LIBRARY_NAME).res
-    RESNAME = $(LIBRARY_NAME).rc
-endif
-
-ifdef BUILD_IDG
-    DEFINES += -DNSSDEBUG
-endif
-
-#
-# To create a loadable module on Darwin, we must use -bundle.
-#
-ifeq ($(OS_TARGET),Darwin)
-DSO_LDOPTS = -bundle
-endif
diff --git a/nss/lib/ckfw/capi/manifest.mn b/nss/lib/ckfw/capi/manifest.mn
index 38effd7..745ebe7 100644
--- a/nss/lib/ckfw/capi/manifest.mn
+++ b/nss/lib/ckfw/capi/manifest.mn
@@ -6,7 +6,6 @@
 CORE_DEPTH = ../../../..
 
 MODULE = nss
-MAPFILE = $(OBJDIR)/nsscapi.def
 
 EXPORTS =		\
 	nsscapi.h	\
@@ -29,5 +28,8 @@ CSRCS =			\
 REQUIRES = nspr
 
 LIBRARY_NAME = nsscapi
+LIBRARY = $(NULL)
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
+IMPORT_LIBRARY = $(NULL)
 
 #EXTRA_SHARED_LIBS = -L$(DIST)/lib -lnssckfw -lnssb -lplc4 -lplds4
diff --git a/nss/lib/ckfw/config.mk b/nss/lib/ckfw/config.mk
deleted file mode 100644
index a3ed5ae..0000000
--- a/nss/lib/ckfw/config.mk
+++ /dev/null
@@ -1,25 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-ifdef BUILD_IDG
-DEFINES += -DNSSDEBUG
-endif
-
-#
-# Hack to see if everything still builds
-#
-
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
-
diff --git a/nss/lib/ckfw/manifest.mn b/nss/lib/ckfw/manifest.mn
index 4f798ad..8991495 100644
--- a/nss/lib/ckfw/manifest.mn
+++ b/nss/lib/ckfw/manifest.mn
@@ -48,6 +48,7 @@ CSRCS =		   \
 REQUIRES = nspr
 
 LIBRARY_NAME = nssckfw
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/crmf/Makefile b/nss/lib/crmf/Makefile
index 142bacf..609d4ad 100644
--- a/nss/lib/crmf/Makefile
+++ b/nss/lib/crmf/Makefile
@@ -27,8 +27,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/lib/crmf/config.mk b/nss/lib/crmf/config.mk
deleted file mode 100644
index dc39ee4..0000000
--- a/nss/lib/crmf/config.mk
+++ /dev/null
@@ -1,16 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/crmf/manifest.mn b/nss/lib/crmf/manifest.mn
index 9f177b9..8c687ea 100644
--- a/nss/lib/crmf/manifest.mn
+++ b/nss/lib/crmf/manifest.mn
@@ -41,6 +41,7 @@ CSRCS = crmfenc.c	\
 	$(NULL)
 
 LIBRARY_NAME = crmf
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/cryptohi/Makefile b/nss/lib/cryptohi/Makefile
index c3bb95f..aae54b1 100644
--- a/nss/lib/cryptohi/Makefile
+++ b/nss/lib/cryptohi/Makefile
@@ -26,8 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
--include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/lib/cryptohi/config.mk b/nss/lib/cryptohi/config.mk
deleted file mode 100644
index b8c03de..0000000
--- a/nss/lib/cryptohi/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/cryptohi/manifest.mn b/nss/lib/cryptohi/manifest.mn
index 896c7ad..6b1a546 100644
--- a/nss/lib/cryptohi/manifest.mn
+++ b/nss/lib/cryptohi/manifest.mn
@@ -9,6 +9,7 @@ MODULE = nss
 REQUIRES = nssutil
 
 LIBRARY_NAME = cryptohi
+SHARED_LIBRARY = $(NULL)
 
 EXPORTS = \
 	cryptohi.h \
diff --git a/nss/lib/dbm/src/config.mk b/nss/lib/dbm/src/config.mk
index eab1805..7ce86f8 100644
--- a/nss/lib/dbm/src/config.mk
+++ b/nss/lib/dbm/src/config.mk
@@ -11,12 +11,6 @@ DEFINES += -DMEMMOVE -D__DBINTERFACE_PRIVATE
 #  are specifed as dependencies within rules.mk.
 #
 
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PURE_LIBRARY   =
-PROGRAM        =
-
 ifdef SHARED_LIBRARY
 	ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 		DLLBASE=/BASE:0x30000000
diff --git a/nss/lib/dbm/src/manifest.mn b/nss/lib/dbm/src/manifest.mn
index 1190444..8b1ad69 100644
--- a/nss/lib/dbm/src/manifest.mn
+++ b/nss/lib/dbm/src/manifest.mn
@@ -26,3 +26,4 @@ CSRCS = db.c	   \
 	$(NULL)
 
 LIBRARY_NAME = dbm
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/dev/Makefile b/nss/lib/dev/Makefile
index b5951dc..f413334 100644
--- a/nss/lib/dev/Makefile
+++ b/nss/lib/dev/Makefile
@@ -4,8 +4,13 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 include manifest.mn
+
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
+
+ifdef BUILD_IDG
+DEFINES += -DNSSDEBUG
+endif
+
 include $(CORE_DEPTH)/coreconf/rules.mk
 
 # On AIX 4.3, IBM xlC_r compiler (version 3.6.6) cannot compile
@@ -14,8 +19,7 @@ include $(CORE_DEPTH)/coreconf/rules.mk
 ifeq ($(OS_TARGET)$(OS_RELEASE),AIX4.3)
 ifeq ($(USE_64),1)
 ifndef BUILD_OPT
-$(OBJDIR)/ckhelper.o: ckhelper.c
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/ckhelper.o: ckhelper.c | $$(@D)/d
 	$(CC) -o $@ -c -O2 $(CFLAGS) $<
 endif
 endif
diff --git a/nss/lib/dev/config.mk b/nss/lib/dev/config.mk
deleted file mode 100644
index 2676cd5..0000000
--- a/nss/lib/dev/config.mk
+++ /dev/null
@@ -1,19 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-ifdef BUILD_IDG
-DEFINES += -DNSSDEBUG
-endif
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/dev/manifest.mn b/nss/lib/dev/manifest.mn
index 4a5b812..449ae58 100644
--- a/nss/lib/dev/manifest.mn
+++ b/nss/lib/dev/manifest.mn
@@ -27,6 +27,7 @@ CSRCS =		        \
 REQUIRES = nspr
 
 LIBRARY_NAME = nssdev
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/freebl/Makefile b/nss/lib/freebl/Makefile
index 08f1a80..c35bdc1 100644
--- a/nss/lib/freebl/Makefile
+++ b/nss/lib/freebl/Makefile
@@ -623,12 +623,10 @@ $(OBJDIR)/ldvector$(OBJ_SUFFIX) $(OBJDIR)/loader$(OBJ_SUFFIX) : loader.h
 
 ifeq ($(SYSV_SPARC),1)
 
-$(OBJDIR)/mpv_sparcv8.o $(OBJDIR)/mpv_sparcv8x.o $(OBJDIR)/montmulfv8.o : $(OBJDIR)/%.o : %.s
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/mpv_sparcv8.o $(OBJDIR)/mpv_sparcv8x.o $(OBJDIR)/montmulfv8.o : $(OBJDIR)/%.o : %.s | $$(@D)/d
 	$(SOLARIS_AS) -o $@ $(SOLARIS_AS_FLAGS) $<
 
-$(OBJDIR)/mpv_sparcv9.o $(OBJDIR)/montmulfv9.o : $(OBJDIR)/%.o : %.s
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/mpv_sparcv9.o $(OBJDIR)/montmulfv9.o : $(OBJDIR)/%.o : %.s | $$(@D)/d
 	$(SOLARIS_AS) -o $@ $(SOLARIS_AS_FLAGS) $<
 
 $(OBJDIR)/mpmontg.o: mpmontg.c montmulf.h
@@ -639,118 +637,35 @@ ifndef FREEBL_CHILD_BUILD
 
 # Parent build. This is where we decide which shared libraries to build
 
-ifdef FREEBL_BUILD_SINGLE_SHLIB
+# too suppress the SINGLE_SHLIB override warning
+FREEBL_OBJDIRS :=
 
-################### Single shared lib stuff #########################
-SINGLE_SHLIB_DIR = $(OBJDIR)/$(OS_TARGET)_SINGLE_SHLIB
-ALL_TRASH += $(SINGLE_SHLIB_DIR) 
+define target_freebl_SHLIB
+ifdef $(2)
+$(1)_DIR = $$(OBJDIR)/$$(OS_TARGET)_$(1)
+ALL_TRASH += $$($(1)_DIR)
 
-$(SINGLE_SHLIB_DIR):
-	-mkdir -p $(SINGLE_SHLIB_DIR)
-
-release_md:: freebl_single_shlib
-libs: freebl_single_shlib
-freebl_single_shlib: | $(SINGLE_SHLIB_DIR)
-	$(MAKE) FREEBL_CHILD_BUILD=1 \
- OBJDIR=$(SINGLE_SHLIB_DIR) libs
-######################## common stuff #########################
-
-endif
-
-ifdef NEED_STUB_BUILD
-SINGLE_SHLIB_DIR = $(OBJDIR)/$(OS_TARGET)_SINGLE_SHLIB
-ALL_TRASH += $(SINGLE_SHLIB_DIR) 
-
-$(SINGLE_SHLIB_DIR):
-	-mkdir $(SINGLE_SHLIB_DIR)
-
-release_md:: freebl_stub_build
-libs: freebl_stub_build
-freebl_stub_build: | $(SINGLE_SHLIB_DIR)
-	$(MAKE) FREEBL_CHILD_BUILD=1 USE_STUB_BUILD=1 \
- OBJDIR=$(SINGLE_SHLIB_DIR) libs
-endif
-
-# multiple shared libraries
-
-######################## ABI32_FPU stuff #########################
-ifdef HAVE_ABI32_FPU
-ABI32_FPU_DIR = $(OBJDIR)/$(OS_TARGET)_ABI32_FPU
-ALL_TRASH += $(ABI32_FPU_DIR) 
-
-$(ABI32_FPU_DIR):
-	-mkdir $(ABI32_FPU_DIR)
-
-release_md:: freebl_ABI32_FPU
-libs: freebl_ABI32_FPU
-freebl_ABI32_FPU: | $(ABI32_FPU_DIR)
-	$(MAKE) FREEBL_CHILD_BUILD=1 USE_ABI32_FPU=1 \
- OBJDIR=$(ABI32_FPU_DIR) libs
-endif
-
-######################## ABI32_INT32 stuff #########################
-ifdef HAVE_ABI32_INT32
-ABI32_INT32_DIR = $(OBJDIR)/$(OS_TARGET)_ABI32_INT32
-ALL_TRASH += $(ABI32_INT32_DIR) 
-
-$(ABI32_INT32_DIR):
-	-mkdir $(ABI32_INT32_DIR)
-
-release_md:: freebl_ABI32_INT32
-libs: freebl_ABI32_INT32
-freebl_ABI32_INT32: | $(ABI32_INT32_DIR)
-	$(MAKE) FREEBL_CHILD_BUILD=1 USE_ABI32_INT32=1 \
- OBJDIR=$(ABI32_INT32_DIR) libs
-endif
-
-######################## ABI32_INT64 stuff #########################
-ifdef HAVE_ABI32_INT64
-ABI32_INT64_DIR = $(OBJDIR)/$(OS_TARGET)_ABI32_INT64
-ALL_TRASH += $(ABI32_INT64_DIR) 
-
-$(ABI32_INT64_DIR):
-	-mkdir $(ABI32_INT64_DIR)
-
-release_md:: freebl_ABI32_INT64
-libs: freebl_ABI32_INT64
-freebl_ABI32_INT64: | $(ABI32_INT64_DIR)
-	$(MAKE) FREEBL_CHILD_BUILD=1 USE_ABI32_INT64=1\
- OBJDIR=$(ABI32_INT64_DIR) libs
+ifeq (,$$(filter $$($(1)_DIR)/d,$$(FREEBL_OBJDIRS)))
+FREEBL_OBJDIRS += $$($(1)_DIR)/d
 endif
 
-######################## END of 32-bit stuff #########################
-
-# above is 32-bit builds, below is 64-bit builds
-
-######################## ABI64_FPU stuff #########################
-ifdef HAVE_ABI64_FPU
-ABI64_FPU_DIR = $(OBJDIR)/$(OS_TARGET)_ABI64_FPU
-ALL_TRASH += $(ABI64_FPU_DIR) 
-
-$(ABI64_FPU_DIR):
-	-mkdir $(ABI64_FPU_DIR)
-
-release_md:: freebl_ABI64_FPU
-libs: freebl_ABI64_FPU
-freebl_ABI64_FPU: | $(ABI64_FPU_DIR)
-	$(MAKE) FREEBL_CHILD_BUILD=1 USE_ABI64_FPU=1 \
- OBJDIR=$(ABI64_FPU_DIR) libs
+release_md:: freebl_$(2)
+libs: freebl_$(2)
+freebl_$(2): | $$($(1)_DIR)/d
+	$$(MAKE) FREEBL_CHILD_BUILD=1 $(3)=1 OBJDIR=$$($(1)_DIR) libs
 endif
+endef # target_freebl_SHLIB
 
-######################## ABI64_INT stuff #########################
-ifdef HAVE_ABI64_INT
-ABI64_INT_DIR = $(OBJDIR)/$(OS_TARGET)_ABI64_INT
-ALL_TRASH += $(ABI64_INT_DIR) 
+target_freebl_ABI = $(call target_freebl_SHLIB,$(1),HAVE_$(1),USE_$(1))
 
-$(ABI64_INT_DIR):
-	-mkdir $(ABI64_INT_DIR)
+$(eval $(call target_freebl_SHLIB,SINGLE_SHLIB,FREEBL_BUILD_SINGLE_SHLIB,NEEDED_DUMMY))
+$(eval $(call target_freebl_SHLIB,SINGLE_SHLIB,NEED_STUB_BUILD,USE_STUB_BUILD))
 
-release_md:: freebl_ABI64_INT
-libs: freebl_ABI64_INT
-freebl_ABI64_INT: | $(ABI64_INT_DIR)
-	$(MAKE) FREEBL_CHILD_BUILD=1 USE_ABI64_INT=1 \
- OBJDIR=$(ABI64_INT_DIR) libs
-endif
+$(eval $(call target_freebl_ABI,ABI32_FPU))
+$(eval $(call target_freebl_ABI,ABI32_INT32))
+$(eval $(call target_freebl_ABI,ABI32_INT64))
+$(eval $(call target_freebl_ABI,ABI64_FPU))
+$(eval $(call target_freebl_ABI,ABI64_INT))
 
 endif  # FREEBL_CHILD_BUILD
 
@@ -759,8 +674,7 @@ endif  # FREEBL_CHILD_BUILD
 # ANSI C's strict aliasing rules.
 ifeq ($(OS_TARGET),Linux)
 ifneq ($(CPU_ARCH),x86)
-$(OBJDIR)/$(PROG_PREFIX)desblapi$(OBJ_SUFFIX): desblapi.c
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/$(PROG_PREFIX)desblapi$(OBJ_SUFFIX): desblapi.c | $$(@D)/d
 ifdef NEED_ABSOLUTE_PATH
 	$(CC) -o $@ -c $(CFLAGS) -fno-strict-aliasing $(call core_abspath,$<)
 else
diff --git a/nss/lib/freebl/config.mk b/nss/lib/freebl/config.mk
index 7ac50db..4a889ff 100644
--- a/nss/lib/freebl/config.mk
+++ b/nss/lib/freebl/config.mk
@@ -47,10 +47,6 @@ endif
 
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-
-RES     = $(OBJDIR)/$(LIBRARY_NAME).res
 RESNAME = freebl.rc
 
 ifdef NS_USE_GCC
diff --git a/nss/lib/jar/Makefile b/nss/lib/jar/Makefile
index 245c127..650c2ae 100644
--- a/nss/lib/jar/Makefile
+++ b/nss/lib/jar/Makefile
@@ -5,7 +5,19 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 include manifest.mn
+
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
-include $(CORE_DEPTH)/coreconf/rules.mk
 
+# NSS_X86 means the target is a 32-bits x86 CPU architecture
+# NSS_X64 means the target is a 64-bits x64 CPU architecture
+# NSS_X86_OR_X64 means the target is either x86 or x64
+ifeq (,$(filter-out i386 x386 x86 x86_64,$(CPU_ARCH)))
+        DEFINES += -DNSS_X86_OR_X64
+ifdef USE_64
+        DEFINES += -DNSS_X64
+else
+        DEFINES += -DNSS_X86
+endif
+endif
+
+include $(CORE_DEPTH)/coreconf/rules.mk
diff --git a/nss/lib/jar/config.mk b/nss/lib/jar/config.mk
deleted file mode 100644
index 1412dcc..0000000
--- a/nss/lib/jar/config.mk
+++ /dev/null
@@ -1,26 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
-# NSS_X86 means the target is a 32-bits x86 CPU architecture
-# NSS_X64 means the target is a 64-bits x64 CPU architecture
-# NSS_X86_OR_X64 means the target is either x86 or x64
-ifeq (,$(filter-out i386 x386 x86 x86_64,$(CPU_ARCH)))
-        DEFINES += -DNSS_X86_OR_X64
-ifdef USE_64
-        DEFINES += -DNSS_X64
-else
-        DEFINES += -DNSS_X86
-endif
-endif
diff --git a/nss/lib/jar/manifest.mn b/nss/lib/jar/manifest.mn
index 5b51688..bcfff57 100644
--- a/nss/lib/jar/manifest.mn
+++ b/nss/lib/jar/manifest.mn
@@ -5,6 +5,7 @@
 MODULE = nss
 
 LIBRARY_NAME = jar
+SHARED_LIBRARY = $(NULL)
 
 CORE_DEPTH = ../..
 
diff --git a/nss/lib/libpkix/Makefile b/nss/lib/libpkix/Makefile
index c3cb5ef..bb88772 100755
--- a/nss/lib/libpkix/Makefile
+++ b/nss/lib/libpkix/Makefile
@@ -26,8 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/lib/libpkix/config.mk b/nss/lib/libpkix/config.mk
deleted file mode 100755
index 5d75e1c..0000000
--- a/nss/lib/libpkix/config.mk
+++ /dev/null
@@ -1,16 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-#  DEFINES+=-DPKIX_LISTDEBUG Can be used to turn on debug compilation
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/include/Makefile b/nss/lib/libpkix/include/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/include/Makefile
+++ b/nss/lib/libpkix/include/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/include/config.mk b/nss/lib/libpkix/include/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/include/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/Makefile b/nss/lib/libpkix/pkix/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/Makefile
+++ b/nss/lib/libpkix/pkix/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/certsel/Makefile b/nss/lib/libpkix/pkix/certsel/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/certsel/Makefile
+++ b/nss/lib/libpkix/pkix/certsel/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/certsel/config.mk b/nss/lib/libpkix/pkix/certsel/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/certsel/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/certsel/manifest.mn b/nss/lib/libpkix/pkix/certsel/manifest.mn
index 8e28df5..eb434bd 100755
--- a/nss/lib/libpkix/pkix/certsel/manifest.mn
+++ b/nss/lib/libpkix/pkix/certsel/manifest.mn
@@ -17,4 +17,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixcertsel
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix/checker/Makefile b/nss/lib/libpkix/pkix/checker/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/checker/Makefile
+++ b/nss/lib/libpkix/pkix/checker/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/checker/config.mk b/nss/lib/libpkix/pkix/checker/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/checker/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/checker/manifest.mn b/nss/lib/libpkix/pkix/checker/manifest.mn
index da99416..84a372c 100755
--- a/nss/lib/libpkix/pkix/checker/manifest.mn
+++ b/nss/lib/libpkix/pkix/checker/manifest.mn
@@ -39,4 +39,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixchecker
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix/config.mk b/nss/lib/libpkix/pkix/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/crlsel/Makefile b/nss/lib/libpkix/pkix/crlsel/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/crlsel/Makefile
+++ b/nss/lib/libpkix/pkix/crlsel/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/crlsel/config.mk b/nss/lib/libpkix/pkix/crlsel/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/crlsel/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/crlsel/manifest.mn b/nss/lib/libpkix/pkix/crlsel/manifest.mn
index 0ad8105..fe84a2d 100755
--- a/nss/lib/libpkix/pkix/crlsel/manifest.mn
+++ b/nss/lib/libpkix/pkix/crlsel/manifest.mn
@@ -17,4 +17,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixcrlsel
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix/params/Makefile b/nss/lib/libpkix/pkix/params/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/params/Makefile
+++ b/nss/lib/libpkix/pkix/params/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/params/config.mk b/nss/lib/libpkix/pkix/params/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/params/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/params/manifest.mn b/nss/lib/libpkix/pkix/params/manifest.mn
index 604f21f..2a77bf0 100755
--- a/nss/lib/libpkix/pkix/params/manifest.mn
+++ b/nss/lib/libpkix/pkix/params/manifest.mn
@@ -21,4 +21,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixparams
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix/results/Makefile b/nss/lib/libpkix/pkix/results/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/results/Makefile
+++ b/nss/lib/libpkix/pkix/results/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/results/config.mk b/nss/lib/libpkix/pkix/results/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/results/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/results/manifest.mn b/nss/lib/libpkix/pkix/results/manifest.mn
index 07bb22e..bec0270 100755
--- a/nss/lib/libpkix/pkix/results/manifest.mn
+++ b/nss/lib/libpkix/pkix/results/manifest.mn
@@ -21,4 +21,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixresults
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix/store/Makefile b/nss/lib/libpkix/pkix/store/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/store/Makefile
+++ b/nss/lib/libpkix/pkix/store/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/store/config.mk b/nss/lib/libpkix/pkix/store/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/store/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/store/manifest.mn b/nss/lib/libpkix/pkix/store/manifest.mn
index cb64455..53a54d6 100755
--- a/nss/lib/libpkix/pkix/store/manifest.mn
+++ b/nss/lib/libpkix/pkix/store/manifest.mn
@@ -15,4 +15,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixstore
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix/top/Makefile b/nss/lib/libpkix/pkix/top/Makefile
index c3cb5ef..d714361 100755
--- a/nss/lib/libpkix/pkix/top/Makefile
+++ b/nss/lib/libpkix/pkix/top/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/top/config.mk b/nss/lib/libpkix/pkix/top/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/top/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/top/manifest.mn b/nss/lib/libpkix/pkix/top/manifest.mn
index 8ba169d..5bdd3f3 100755
--- a/nss/lib/libpkix/pkix/top/manifest.mn
+++ b/nss/lib/libpkix/pkix/top/manifest.mn
@@ -19,4 +19,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixtop
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix/util/Makefile b/nss/lib/libpkix/pkix/util/Makefile
index 1b75ee7..2b54925 100755
--- a/nss/lib/libpkix/pkix/util/Makefile
+++ b/nss/lib/libpkix/pkix/util/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix/util/config.mk b/nss/lib/libpkix/pkix/util/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix/util/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix/util/manifest.mn b/nss/lib/libpkix/pkix/util/manifest.mn
index f18d94b..e7d9f97 100755
--- a/nss/lib/libpkix/pkix/util/manifest.mn
+++ b/nss/lib/libpkix/pkix/util/manifest.mn
@@ -22,4 +22,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixutil
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix_pl_nss/Makefile b/nss/lib/libpkix/pkix_pl_nss/Makefile
index 1b75ee7..2b54925 100755
--- a/nss/lib/libpkix/pkix_pl_nss/Makefile
+++ b/nss/lib/libpkix/pkix_pl_nss/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix_pl_nss/config.mk b/nss/lib/libpkix/pkix_pl_nss/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix_pl_nss/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix_pl_nss/module/Makefile b/nss/lib/libpkix/pkix_pl_nss/module/Makefile
index c3cb5ef..e97ad8e 100755
--- a/nss/lib/libpkix/pkix_pl_nss/module/Makefile
+++ b/nss/lib/libpkix/pkix_pl_nss/module/Makefile
@@ -26,7 +26,26 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
+ifdef NSS_PKIX_NO_LDAP
+LDAP_HEADERS =
+LDAP_CSRCS =
+else
+LDAP_HEADERS = \
+	pkix_pl_ldapt.h \
+	pkix_pl_ldapcertstore.h \
+	pkix_pl_ldapresponse.h \
+	pkix_pl_ldaprequest.h \
+	pkix_pl_ldapdefaultclient.h \
+ 	$(NULL)
+ 
+LDAP_CSRCS = \
+	pkix_pl_ldaptemplates.c \
+	pkix_pl_ldapcertstore.c \
+	pkix_pl_ldapresponse.c \
+	pkix_pl_ldaprequest.c \
+	pkix_pl_ldapdefaultclient.c \
+ 	$(NULL)
+endif
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix_pl_nss/module/config.mk b/nss/lib/libpkix/pkix_pl_nss/module/config.mk
deleted file mode 100755
index 2926747..0000000
--- a/nss/lib/libpkix/pkix_pl_nss/module/config.mk
+++ /dev/null
@@ -1,35 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
-ifdef NSS_PKIX_NO_LDAP
-LDAP_HEADERS =
-LDAP_CSRCS =
-else
-LDAP_HEADERS = \
-	pkix_pl_ldapt.h \
-	pkix_pl_ldapcertstore.h \
-	pkix_pl_ldapresponse.h \
-	pkix_pl_ldaprequest.h \
-	pkix_pl_ldapdefaultclient.h \
- 	$(NULL)
- 
-LDAP_CSRCS = \
-	pkix_pl_ldaptemplates.c \
-	pkix_pl_ldapcertstore.c \
-	pkix_pl_ldapresponse.c \
-	pkix_pl_ldaprequest.c \
-	pkix_pl_ldapdefaultclient.c \
- 	$(NULL)
-endif
diff --git a/nss/lib/libpkix/pkix_pl_nss/module/manifest.mn b/nss/lib/libpkix/pkix_pl_nss/module/manifest.mn
index 9ae4d91..31231e4 100755
--- a/nss/lib/libpkix/pkix_pl_nss/module/manifest.mn
+++ b/nss/lib/libpkix/pkix_pl_nss/module/manifest.mn
@@ -31,4 +31,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixmodule
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix_pl_nss/pki/Makefile b/nss/lib/libpkix/pkix_pl_nss/pki/Makefile
index a9cebcf..2b4b157 100755
--- a/nss/lib/libpkix/pkix_pl_nss/pki/Makefile
+++ b/nss/lib/libpkix/pkix_pl_nss/pki/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix_pl_nss/pki/config.mk b/nss/lib/libpkix/pkix_pl_nss/pki/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix_pl_nss/pki/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix_pl_nss/pki/manifest.mn b/nss/lib/libpkix/pkix_pl_nss/pki/manifest.mn
index 7e105e7..aba1367 100755
--- a/nss/lib/libpkix/pkix_pl_nss/pki/manifest.mn
+++ b/nss/lib/libpkix/pkix_pl_nss/pki/manifest.mn
@@ -47,4 +47,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixpki
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/libpkix/pkix_pl_nss/system/Makefile b/nss/lib/libpkix/pkix_pl_nss/system/Makefile
index a9cebcf..2b4b157 100755
--- a/nss/lib/libpkix/pkix_pl_nss/system/Makefile
+++ b/nss/lib/libpkix/pkix_pl_nss/system/Makefile
@@ -26,7 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/libpkix/pkix_pl_nss/system/config.mk b/nss/lib/libpkix/pkix_pl_nss/system/config.mk
deleted file mode 100755
index b8c03de..0000000
--- a/nss/lib/libpkix/pkix_pl_nss/system/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/libpkix/pkix_pl_nss/system/manifest.mn b/nss/lib/libpkix/pkix_pl_nss/system/manifest.mn
index 16cb6d0..a143a03 100755
--- a/nss/lib/libpkix/pkix_pl_nss/system/manifest.mn
+++ b/nss/lib/libpkix/pkix_pl_nss/system/manifest.mn
@@ -40,4 +40,4 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkixsystem
-
+SHARED_LIBRARY = $(NULL)
diff --git a/nss/lib/nss/config.mk b/nss/lib/nss/config.mk
index a17f3ef..3716721 100644
--- a/nss/lib/nss/config.mk
+++ b/nss/lib/nss/config.mk
@@ -6,13 +6,6 @@
 # can't do this in manifest.mn because OS_TARGET isn't defined there.
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-RES = $(OBJDIR)/$(LIBRARY_NAME).res
-RESNAME = $(LIBRARY_NAME).rc
-
 ifdef NS_USE_GCC
 EXTRA_SHARED_LIBS += \
 	-L$(DIST)/lib \
diff --git a/nss/lib/nss/manifest.mn b/nss/lib/nss/manifest.mn
index 54bed49..312aa53 100644
--- a/nss/lib/nss/manifest.mn
+++ b/nss/lib/nss/manifest.mn
@@ -22,10 +22,9 @@ CSRCS = \
 	utilwrap.c \
 	$(NULL)
 
-MAPFILE = $(OBJDIR)/nss.def
-
 LIBRARY_NAME = nss
 LIBRARY_VERSION = 3
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/pk11wrap/Makefile b/nss/lib/pk11wrap/Makefile
index 4f0c5cd..9d27595 100644
--- a/nss/lib/pk11wrap/Makefile
+++ b/nss/lib/pk11wrap/Makefile
@@ -26,8 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
--include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
@@ -53,8 +51,7 @@ $(OBJDIR)/pk11load$(OBJ_SUFFIX): debug_module.c
 ifeq ($(OS_TARGET)$(OS_RELEASE),AIX4.3)
 ifeq ($(USE_64),1)
 ifndef BUILD_OPT
-$(OBJDIR)/pk11slot.o: pk11slot.c
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/pk11slot.o: pk11slot.c | $$(@D)/d
 	$(CC) -o $@ -c -O2 $(CFLAGS) $<
 endif
 endif
diff --git a/nss/lib/pk11wrap/config.mk b/nss/lib/pk11wrap/config.mk
deleted file mode 100644
index b8c03de..0000000
--- a/nss/lib/pk11wrap/config.mk
+++ /dev/null
@@ -1,15 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/pk11wrap/manifest.mn b/nss/lib/pk11wrap/manifest.mn
index 1a2d244..707fee2 100644
--- a/nss/lib/pk11wrap/manifest.mn
+++ b/nss/lib/pk11wrap/manifest.mn
@@ -47,11 +47,12 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pk11wrap
+SHARED_LIBRARY = $(NULL)
 
-LIBRARY_VERSION = 3
+NSS_LIBRARY_VERSION = 3
 SOFTOKEN_LIBRARY_VERSION = 3
 DEFINES += -DSHLIB_SUFFIX=\"$(DLL_SUFFIX)\" -DSHLIB_PREFIX=\"$(DLL_PREFIX)\" \
-        -DSHLIB_VERSION=\"$(LIBRARY_VERSION)\" \
+        -DNSS_SHLIB_VERSION=\"$(NSS_LIBRARY_VERSION)\" \
         -DSOFTOKEN_SHLIB_VERSION=\"$(SOFTOKEN_LIBRARY_VERSION)\"
 
 # only add module debugging in opt builds if DEBUG_PKCS11 is set
diff --git a/nss/lib/pk11wrap/pk11load.c b/nss/lib/pk11wrap/pk11load.c
index a840701..564c895 100644
--- a/nss/lib/pk11wrap/pk11load.c
+++ b/nss/lib/pk11wrap/pk11load.c
@@ -355,7 +355,7 @@ SECMOD_SetRootCerts(PK11SlotInfo *slot, SECMODModule *mod)
 
 #ifndef NSS_STATIC_SOFTOKEN
 static const char *my_shlib_name =
-    SHLIB_PREFIX "nss" SHLIB_VERSION "." SHLIB_SUFFIX;
+    SHLIB_PREFIX "nss" NSS_SHLIB_VERSION "." SHLIB_SUFFIX;
 static const char *softoken_shlib_name =
     SHLIB_PREFIX "softokn" SOFTOKEN_SHLIB_VERSION "." SHLIB_SUFFIX;
 static const PRCallOnceType pristineCallOnce;
diff --git a/nss/lib/pk11wrap/pk11wrap.gyp b/nss/lib/pk11wrap/pk11wrap.gyp
index 17de8ad..65d690f 100644
--- a/nss/lib/pk11wrap/pk11wrap.gyp
+++ b/nss/lib/pk11wrap/pk11wrap.gyp
@@ -60,7 +60,7 @@
     'defines': [
       'SHLIB_SUFFIX=\"<(dll_suffix)\"',
       'SHLIB_PREFIX=\"<(dll_prefix)\"',
-      'SHLIB_VERSION=\"3\"',
+      'NSS_SHLIB_VERSION=\"3\"',
       'SOFTOKEN_SHLIB_VERSION=\"3\"'
     ]
   },
diff --git a/nss/lib/pkcs12/Makefile b/nss/lib/pkcs12/Makefile
index 8149184..3fd2f50 100644
--- a/nss/lib/pkcs12/Makefile
+++ b/nss/lib/pkcs12/Makefile
@@ -27,8 +27,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/lib/pkcs12/config.mk b/nss/lib/pkcs12/config.mk
deleted file mode 100644
index dc39ee4..0000000
--- a/nss/lib/pkcs12/config.mk
+++ /dev/null
@@ -1,16 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/pkcs12/manifest.mn b/nss/lib/pkcs12/manifest.mn
index 26166ec..ab54bec 100644
--- a/nss/lib/pkcs12/manifest.mn
+++ b/nss/lib/pkcs12/manifest.mn
@@ -26,6 +26,7 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkcs12
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/pkcs7/Makefile b/nss/lib/pkcs7/Makefile
index a9cebcf..aae54b1 100644
--- a/nss/lib/pkcs7/Makefile
+++ b/nss/lib/pkcs7/Makefile
@@ -26,8 +26,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
-
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
 #######################################################################
diff --git a/nss/lib/pkcs7/config.mk b/nss/lib/pkcs7/config.mk
deleted file mode 100644
index 36f063f..0000000
--- a/nss/lib/pkcs7/config.mk
+++ /dev/null
@@ -1,14 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
diff --git a/nss/lib/pkcs7/manifest.mn b/nss/lib/pkcs7/manifest.mn
index 1a6cad0..9ca2d4d 100644
--- a/nss/lib/pkcs7/manifest.mn
+++ b/nss/lib/pkcs7/manifest.mn
@@ -28,6 +28,7 @@ CSRCS = \
 	$(NULL)
 
 LIBRARY_NAME = pkcs7
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/pki/Makefile b/nss/lib/pki/Makefile
index ca709f6..3f49eaa 100644
--- a/nss/lib/pki/Makefile
+++ b/nss/lib/pki/Makefile
@@ -4,7 +4,11 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 include manifest.mn
+
 include $(CORE_DEPTH)/coreconf/config.mk
-include config.mk
-include $(CORE_DEPTH)/coreconf/rules.mk
 
+ifdef BUILD_IDG
+DEFINES += -DNSSDEBUG
+endif
+
+include $(CORE_DEPTH)/coreconf/rules.mk
diff --git a/nss/lib/pki/config.mk b/nss/lib/pki/config.mk
deleted file mode 100644
index 2676cd5..0000000
--- a/nss/lib/pki/config.mk
+++ /dev/null
@@ -1,19 +0,0 @@
-# 
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-ifdef BUILD_IDG
-DEFINES += -DNSSDEBUG
-endif
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
diff --git a/nss/lib/pki/manifest.mn b/nss/lib/pki/manifest.mn
index 77226b1..98af6b8 100644
--- a/nss/lib/pki/manifest.mn
+++ b/nss/lib/pki/manifest.mn
@@ -36,7 +36,7 @@ CSRCS =		        \
 REQUIRES = nspr
 
 LIBRARY_NAME = nsspki
-LIBRARY_VERSION = 3
+SHARED_LIBRARY = $(NULL)
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/smime/config.mk b/nss/lib/smime/config.mk
index 85d39e8..76aab75 100644
--- a/nss/lib/smime/config.mk
+++ b/nss/lib/smime/config.mk
@@ -7,13 +7,6 @@ RELEASE_LIBS = $(TARGETS)
 
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-RES = $(OBJDIR)/smime.res
-RESNAME = smime.rc
-
 ifdef NS_USE_GCC
 EXTRA_SHARED_LIBS += \
 	-L$(DIST)/lib \
diff --git a/nss/lib/smime/manifest.mn b/nss/lib/smime/manifest.mn
index e049d88..f453d25 100644
--- a/nss/lib/smime/manifest.mn
+++ b/nss/lib/smime/manifest.mn
@@ -17,7 +17,6 @@ PRIVATE_EXPORTS = \
 	$(NULL)
 
 MODULE = nss
-MAPFILE = $(OBJDIR)/smime.def
 
 CSRCS = \
 	cmsarray.c \
@@ -46,6 +45,7 @@ CSRCS = \
 
 LIBRARY_NAME = smime
 LIBRARY_VERSION = 3
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/softoken/Makefile b/nss/lib/softoken/Makefile
index e5fb2d4..68ad057 100644
--- a/nss/lib/softoken/Makefile
+++ b/nss/lib/softoken/Makefile
@@ -66,11 +66,10 @@ $(SHARED_LIBRARY): $(CRYPTOLIB)
 ifeq ($(OS_TARGET)$(OS_RELEASE),AIX4.3)
 ifeq ($(USE_64),1)
 ifndef BUILD_OPT
-$(OBJDIR)/pkcs11.o: pkcs11.c
-	@$(MAKE_OBJDIR)
+$(OBJDIR)/pkcs11.o: pkcs11.c | $$(@D)/d
 	$(CC) -o $@ -c -O2 $(CFLAGS) $<
-$(OBJDIR)/pkcs11c.o: pkcs11c.c
-	@$(MAKE_OBJDIR)
+
+$(OBJDIR)/pkcs11c.o: pkcs11c.c | $$(@D)/d
 	$(CC) -o $@ -c -O2 $(CFLAGS) $<
 endif
 endif
diff --git a/nss/lib/softoken/config.mk b/nss/lib/softoken/config.mk
index 2924b24..14ea5d6 100644
--- a/nss/lib/softoken/config.mk
+++ b/nss/lib/softoken/config.mk
@@ -13,13 +13,6 @@ EXTRA_LIBS += \
 # can't do this in manifest.mn because OS_TARGET isn't defined there.
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-RES = $(OBJDIR)/$(LIBRARY_NAME).res
-RESNAME = $(LIBRARY_NAME).rc
-
 ifdef NS_USE_GCC
 EXTRA_SHARED_LIBS += \
 	-L$(SQLITE_LIB_DIR) \
diff --git a/nss/lib/softoken/legacydb/config.mk b/nss/lib/softoken/legacydb/config.mk
index ac7240e..54a23c3 100644
--- a/nss/lib/softoken/legacydb/config.mk
+++ b/nss/lib/softoken/legacydb/config.mk
@@ -14,13 +14,6 @@ EXTRA_LIBS += \
 # can't do this in manifest.mn because OS_TARGET isn't defined there.
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-RES = $(OBJDIR)/$(LIBRARY_NAME).res
-RESNAME = $(LIBRARY_NAME).rc
-
 ifdef NS_USE_GCC
 EXTRA_SHARED_LIBS += \
 	-L$(DIST)/lib \
diff --git a/nss/lib/softoken/legacydb/manifest.mn b/nss/lib/softoken/legacydb/manifest.mn
index 9cce849..caac524 100644
--- a/nss/lib/softoken/legacydb/manifest.mn
+++ b/nss/lib/softoken/legacydb/manifest.mn
@@ -10,7 +10,7 @@ REQUIRES = dbm
 
 LIBRARY_NAME = nssdbm
 LIBRARY_VERSION = 3
-MAPFILE = $(OBJDIR)/nssdbm.def
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
 
 DEFINES += -DSHLIB_SUFFIX=\"$(DLL_SUFFIX)\" -DSHLIB_PREFIX=\"$(DLL_PREFIX)\" -DLG_LIB_NAME=\"$(notdir $(SHARED_LIBRARY))\"
 
diff --git a/nss/lib/softoken/manifest.mn b/nss/lib/softoken/manifest.mn
index f25b977..5525cc7 100644
--- a/nss/lib/softoken/manifest.mn
+++ b/nss/lib/softoken/manifest.mn
@@ -9,7 +9,7 @@ DIRS = legacydb
 
 LIBRARY_NAME = softokn
 LIBRARY_VERSION = 3
-MAPFILE = $(OBJDIR)/softokn.def
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
 
 DEFINES += -DSHLIB_SUFFIX=\"$(DLL_SUFFIX)\" -DSHLIB_PREFIX=\"$(DLL_PREFIX)\" -DSOFTOKEN_LIB_NAME=\"$(notdir $(SHARED_LIBRARY))\" -DSHLIB_VERSION=\"$(LIBRARY_VERSION)\"
 
diff --git a/nss/lib/sqlite/Makefile b/nss/lib/sqlite/Makefile
index 592adb6..960482d 100644
--- a/nss/lib/sqlite/Makefile
+++ b/nss/lib/sqlite/Makefile
@@ -27,7 +27,7 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
--include config.mk
+include config.mk
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/sqlite/config.mk b/nss/lib/sqlite/config.mk
index b0e9390..a3b52bd 100644
--- a/nss/lib/sqlite/config.mk
+++ b/nss/lib/sqlite/config.mk
@@ -3,18 +3,6 @@
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
-
-# can't do this in manifest.mn because OS_TARGET isn't defined there.
-ifeq (,$(filter-out WIN%,$(OS_TARGET)))
-
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-#RES = $(OBJDIR)/$(LIBRARY_NAME).res
-#RESNAME = $(LIBRARY_NAME).rc
-endif
-
 ifeq ($(OS_TARGET),AIX)
 EXTRA_LIBS += -lpthreads
 ifdef BUILD_OPT
diff --git a/nss/lib/sqlite/manifest.mn b/nss/lib/sqlite/manifest.mn
index be411a6..44422af 100644
--- a/nss/lib/sqlite/manifest.mn
+++ b/nss/lib/sqlite/manifest.mn
@@ -8,7 +8,9 @@ MODULE = nss
 
 LIBRARY_NAME = sqlite
 LIBRARY_VERSION = 3
-MAPFILE = $(OBJDIR)/sqlite.def
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
+RES = $(NULL)
+
 DEFINES += -DSQLITE_THREADSAFE=1
 
 PRIVATE_EXPORTS = \
diff --git a/nss/lib/ssl/config.mk b/nss/lib/ssl/config.mk
index b901a88..b25b36b 100644
--- a/nss/lib/ssl/config.mk
+++ b/nss/lib/ssl/config.mk
@@ -9,13 +9,6 @@ endif
 
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-RES = $(OBJDIR)/ssl.res
-RESNAME = ssl.rc
-
 ifdef NS_USE_GCC
 EXTRA_SHARED_LIBS += \
 	-L$(DIST)/lib \
diff --git a/nss/lib/ssl/manifest.mn b/nss/lib/ssl/manifest.mn
index 83df8c0..12a1747 100644
--- a/nss/lib/ssl/manifest.mn
+++ b/nss/lib/ssl/manifest.mn
@@ -15,7 +15,6 @@ EXPORTS = \
         $(NULL)
 
 MODULE = nss
-MAPFILE = $(OBJDIR)/ssl.def
 
 CSRCS = \
         dtlscon.c \
@@ -62,6 +61,7 @@ CSRCS = \
 
 LIBRARY_NAME = ssl
 LIBRARY_VERSION = 3
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/sysinit/Makefile b/nss/lib/sysinit/Makefile
index fe59954..3803142 100644
--- a/nss/lib/sysinit/Makefile
+++ b/nss/lib/sysinit/Makefile
@@ -24,7 +24,6 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-#include ../platlibs.mk
 include config.mk
 
 #######################################################################
@@ -43,6 +42,3 @@ include $(CORE_DEPTH)/coreconf/rules.mk
 # (7) Execute "local" rules. (OPTIONAL).                              #
 #######################################################################
 
-
-#include ../platrules.mk
-
diff --git a/nss/lib/sysinit/config.mk b/nss/lib/sysinit/config.mk
index 037641b..33ef6e8 100644
--- a/nss/lib/sysinit/config.mk
+++ b/nss/lib/sysinit/config.mk
@@ -11,13 +11,6 @@
 # can't do this in manifest.mn because OS_TARGET isn't defined there.
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-RES = $(OBJDIR)/$(LIBRARY_NAME).res
-RESNAME = $(LIBRARY_NAME).rc
-
 ifdef NS_USE_GCC
 EXTRA_SHARED_LIBS += \
 	-L$(DIST)/lib \
diff --git a/nss/lib/sysinit/manifest.mn b/nss/lib/sysinit/manifest.mn
index 40a119e..d188b0a 100644
--- a/nss/lib/sysinit/manifest.mn
+++ b/nss/lib/sysinit/manifest.mn
@@ -11,7 +11,7 @@ CSRCS = \
       $(NULL)
 
 LIBRARY_NAME = nsssysinit
-MAPFILE = $(OBJDIR)/nsssysinit.def
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/util/Makefile b/nss/lib/util/Makefile
index 9b51d18..c3cb5ef 100644
--- a/nss/lib/util/Makefile
+++ b/nss/lib/util/Makefile
@@ -14,8 +14,6 @@ include manifest.mn
 # (2) Include "global" configuration information. (OPTIONAL)          #
 #######################################################################
 
-# include $(CORE_DEPTH)/coreconf/arch.mk
-
 include $(CORE_DEPTH)/coreconf/config.mk
 
 #######################################################################
diff --git a/nss/lib/util/config.mk b/nss/lib/util/config.mk
index a3e7202..af42a2e 100644
--- a/nss/lib/util/config.mk
+++ b/nss/lib/util/config.mk
@@ -6,13 +6,6 @@
 # can't do this in manifest.mn because OS_TARGET isn't defined there.
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
 
-# don't want the 32 in the shared library name
-SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION).$(DLL_SUFFIX)
-IMPORT_LIBRARY = $(OBJDIR)/$(IMPORT_LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(IMPORT_LIB_SUFFIX)
-
-RES = $(OBJDIR)/$(LIBRARY_NAME).res
-RESNAME = $(LIBRARY_NAME).rc
-
 ifdef NS_USE_GCC
 EXTRA_SHARED_LIBS += \
 	-L$(DIST)/lib \
diff --git a/nss/lib/util/manifest.mn b/nss/lib/util/manifest.mn
index b33a204..43eead6 100644
--- a/nss/lib/util/manifest.mn
+++ b/nss/lib/util/manifest.mn
@@ -82,11 +82,9 @@ CSRCS = \
 
 MODULE = nss
 
-# don't duplicate module name in REQUIRES
-MAPFILE = $(OBJDIR)/nssutil.def
-
 LIBRARY_NAME = nssutil
 LIBRARY_VERSION = 3
+MAPFILE = $(OBJDIR)/$(LIBRARY_NAME).def
 
 # This part of the code, including all sub-dirs, can be optimized for size
 export ALLOW_OPT_CODE_SIZE = 1
diff --git a/nss/lib/zlib/Makefile b/nss/lib/zlib/Makefile
index 812c38f..0aa8a85 100644
--- a/nss/lib/zlib/Makefile
+++ b/nss/lib/zlib/Makefile
@@ -25,7 +25,12 @@ include $(CORE_DEPTH)/coreconf/config.mk
 # (4) Include "local" platform-dependent assignments (OPTIONAL).      #
 #######################################################################
 
-include config.mk
+EXTRA_LIBS = $(LIBRARY)
+
+ifneq ($(OS_ARCH),WINNT)
+DEFINES += -DHAVE_UNISTD_H
+endif
+DEFINES += -DHAVE_STDARG_H
 
 #######################################################################
 # (5) Execute "global" rules. (OPTIONAL)                              #
diff --git a/nss/lib/zlib/config.mk b/nss/lib/zlib/config.mk
deleted file mode 100644
index 696be5d..0000000
--- a/nss/lib/zlib/config.mk
+++ /dev/null
@@ -1,20 +0,0 @@
-#
-# This Source Code Form is subject to the terms of the Mozilla Public
-# License, v. 2.0. If a copy of the MPL was not distributed with this
-# file, You can obtain one at http://mozilla.org/MPL/2.0/.
-
-#
-#  Override TARGETS variable so that only static libraries
-#  are specifed as dependencies within rules.mk.
-#
-
-TARGETS        = $(LIBRARY) $(PROGRAMS)
-SHARED_LIBRARY =
-IMPORT_LIBRARY =
-PROGRAM        =
-
-EXTRA_LIBS     = $(LIBRARY)
-
-ifeq ($(OS_TARGET),Linux)
-DEFINES += -DHAVE_UNISTD_H
-endif
diff --git a/nss/lib/zlib/manifest.mn b/nss/lib/zlib/manifest.mn
index 2118f8d..f6a5d3d 100644
--- a/nss/lib/zlib/manifest.mn
+++ b/nss/lib/zlib/manifest.mn
@@ -29,8 +29,7 @@ CSRCS =	adler32.c 	\
 LIBRARY_NAME = zlib
 
 PROGRAMS = example minigzip
-
-# REQUIRES = nss
+SHARED_LIBRARY = $(NULL)
 
 # Define verbose as -1 to turn off all zlib trace messages in
 # debug builds.
-- 
2.20.1

